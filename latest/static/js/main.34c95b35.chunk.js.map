{"version":3,"sources":["app/Analytics.js","app/Constants.js","app/OpeningTreeSerializer.js","pres/loader/Common.js","app/util.js","pres/loader/Filters.js","pres/loader/Actions.js","app/iterator/IteratorUtils.js","app/iterator/BaseUrlIterator.js","app/iterator/LichessIterator.js","app/iterator/ChessComIterator.js","app/iterator/PGNFileIterator.js","app/iterator/PGNUrlIterator.js","app/iterator/NotablePlayerIterator.js","app/PGNReader.js","pres/loader/TimeControlLabels.js","pres/loader/FilterLabels.js","pres/loader/AdvancedFilters.js","app/Common.js","app/OpeningGraph.js","app/OpeningManager.js","pres/Navigator.js","pres/GlobalHeader.js","pres/loader/Source.js","pres/loader/Dropzone.js","pres/loader/NotableChessGames.js","pres/loader/User.js","pres/loader/PGNLoader.js","pres/Settings.js","pres/ReportControls.js","pres/MovesList.js","pres/ControlsContainer.js","pres/StateManagement.js","pres/SnackbarContentWrapper.js","pres/MainContainer.js","index.js","app/SitePolicy.js","app/PGNParser.js"],"names":["trackPageView","ReactGA","pageview","window","location","pathname","trackEvent","category","action","label","value","event","initialize","TIME_CONTROL_ULTRA_BULLET","TIME_CONTROL_BULLET","TIME_CONTROL_BLITZ","TIME_CONTROL_RAPID","TIME_CONTROL_CLASSICAL","TIME_CONTROL_CORRESPONDENCE","TIME_CONTROL_DAILY","FILTER_NAME_RATED","FILTER_NAME_SELECTED_TIMEFRAME","FILTER_NAME_DOWNLOAD_LIMIT","FILTER_NAME_ELO_RANGE","SITE_LICHESS","SITE_CHESS_DOT_COM","SITE_PGN_FILE","SITE_EVENT_DB","SITE_PLAYER_DB","SITE_OPENING_TREE_FILE","MAX_DOWNLOAD_LIMIT","MAX_ELO_RATING","EVENT_CATEGORY_PGN_LOADER","EVENT_CATEGORY_MOVES_LIST","EVENT_CATEGORY_CONTROLS","EVENT_CATEGORY_NAVIGATOR","EVENT_CATEGORY_CHESSBOARD","EVENT_CATEGORY_ERROR","EVENT_CATEGORY_MESSAGE_SHOWN","ROOT_FEN","PLAYER_COLOR_WHITE","PLAYER_COLOR_BLACK","LOADER_ANIMATION_DURATION_MS","OPENING_TREE_EMAIL","OPENNIG_TREE_REDDIT","OPENING_TREE_LICHESS","OPENING_TREE_CHESS_COM","OPENING_TREE_DISCORD","OPENING_TREE_FILE_CURRENT_VERSION","ERROR_ACTION_VISIT_OLD_SITE","serializeOpeningTree","treeData","filename","callback","chunkedArray","chunks","chunk","header","index","arraySizes","arrays","map","arr","length","forEach","array","Array","prototype","push","apply","chunkSize","startIndex","i","chunkIndex","slice","chunkArray","deflatedChunks","packControlWord","remainingChunks","hasError","zlib","deflate","Buffer","JSON","stringify","error","data","byteLength","saveAs","Blob","type","deserializeOpeningTree","file","reader","FileReader","onload","evt","target","result","version","unpackControlWord","numChunks","handleInflate","console","log","parse","e","sortedChunks","sort","a","b","flattenedChunks","el","flat","size","reconstructObjectFromChunks","inflate","from","getInflatedChunks","onerror","name","message","readAsArrayBuffer","control","view","DataView","getUint16","getUint32","buffer","ArrayBuffer","setUint16","setUint32","ExpansionPanel","withStyles","root","border","boxShadow","borderBottom","display","margin","expanded","MuiExpansionPanel","getNumberIcon","n","alt","className","src","height","advancedFilters","state","createSubObjectWithProperties","Constants","copyText","elementId","document","getElementById","select","setSelectionRange","execCommand","mainObject","properties","subObject","property","simplifiedFen","fen","fenComponents","split","getTimeControlsArray","site","timeControlState","selected","Common","filter","timeControl","monthLabels","getTimeframeSteps","steps","year","startYear","currentYear","Date","getFullYear","currentMonth","getMonth","toLongLabel","fromLongLabel","month","getSelectedTimeFrameData","timeframe","timeframeSteps","fromIndex","toIndex","fromTimeframe","toTimeframe","currentDate","fromMonth","fromYear","fromTimeStamp","getTimeStampInfoFor","toYear","toMonth","toTimeStamp","minOrMax","getTime","getDate","getDaysInMonth","getPerformanceDetails","totalElo","white","draws","black","playerColor","totalGames","averageElo","Math","round","playerWins","playerLosses","score","scorePercentage","ratingChange","results","performanceRating","Number","isInteger","toFixed","abs","isOpponentEloInSelectedRange","elo","range","isDateMoreRecentThan","date","than","User","props","isAdvancedFiltersOpen","Object","assign","defaultAdvancedFilters","this","rated","setState","newState","SitePolicy","setImmediate","setFilters","bind","checked","newValue","colorError","filtersChange","isDisabled","areAdvancedFiltersApplied","newProps","entries","key","deepEqual","playerName","selectedNotablePlayer","expandedPanel","TransitionComponent","MuiCollapse","TransitionProps","timeout","onChange","handleExpansionChange","disabled","expandIcon","getSummary","component","playerColorChange","color","onClick","toggleState","icon","faCaretUp","faCaretDown","isOpen","toggleRated","handleTimeControlChange","handleTimeframeChange","handleEloRangeChange","handleDownloadLimitChange","React","Component","Actions","unload","pgnReader","stopDownloading","isGamesSubsectionOpen","exportingInProgress","addEventListener","removeEventListener","importOpeningTree","files","err","subMesage","showError","success","importOpeningTreeObject","showInfo","exportOpeningTree","exportOpeningTreeObject","info","shouldDownloadToFile","PGNReader","fetchPGNFromSite","selectedNotableEvent","notify","readPgn","gamesProcessed","clear","loadedSite","setDownloading","importTreeClicked","variant","startIcon","disableElevation","downloadDisabledReason","isDownloading","load","download","placement","title","exportTreeClicked","stopDownloadingAction","switchToMovesTab","faList","openingTreeLoadActions","regularActions","mainComponent","in","normalizePGN","pgnString","dataString","normalizeNewLine","replace","BaseUrlIterator","url","shouldNormalizePGN","responseCodeCallback","errorCallback","dataCallback","endCallback","remainingBody","requestObject","request","get","json","on","response","statusCode","newBody","toString","lastValidPGN","lastIndexOf","body","callDataCallback","abort","trimString","LichessIterator","ready","playerNameFilter","encodeURIComponent","colorFilter","ratedFilter","selectedTimeFrameData","timeSinceFilter","timeUntilFilter","selectedTimeControls","perfFilter","join","responseCode","pgnStringArray","parsedPGNs","pgn","headers","Variant","opponentElo","BlackElo","WhiteElo","ChessComIterator","chessAPI","ChessWebAPI","queue","pendingRequests","parseGames","archiveResponse","games","game","rules","username","toLowerCase","ratedMode","time_class","rating","dequeue","fetchAllGames","responseBody","archives","reverse","archiveUrl","components","archiveMonth","archiveYear","shouldFetchGamesFromArchive","dispatch","getPlayerCompleteMonthlyArchives","jsonBody","setupReader","readAsText","playerColorHeaderName","lowerCasePlayerName","parsedPGN","playerColorHeaderValue","includes","onloadend","PGNUrlIterator","lowerCasePlayerNames","NotablePlayerIterator","selectedPlayer","lowerCaseAliases","pgnAliases","alias","pgnUrl","pendingGames","pendingDownloads","streamsaver","mitm","fileWriter","close","moves","moveObject","move","continueProcessingGames","fileStream","createWriteStream","getWriter","encoder","TextEncoder","processor","write","encode","getPgnString","then","setTimeout","parsePGNTimed","PGNFileIterator","pgnArray","move_number","chess","Chess","pgnParseFailed","parsedMoves","element","sourceFen","sloppy","targetFen","moveSan","san","parsedPGNDetails","pgnStats","gameResult","latestFen","Link","Site","White","Black","whiteElo","blackElo","timeClasses","unselectedTimeControls","includesAll","subArray","every","v","getTimeControlLabel","timeClass","lichessTimeControlLabel","AdvancedFilters","currentlyOpenAdvancedFilter","timeframeMarks","downloadLimitMarks","eloRangeMarks","filterName","subSectionComponent","setCurrentlyOpenAdvancedFilter","Collapse","getTimeControlFilters","getTimeFrameFilters","selectedEloRange","getEloRangeFilters","downloadLimit","getDownloadLimitFilters","Slider","valueLabelDisplay","valueLabelFormat","val","step","min","marks","max","firstRow","middleRow","lastRow","colWidth","FormControl","FormGroup","Container","getTimeControlFilterRow","controls","firstColumnWidth","position","clsName","Row","Col","sm","FormControlLabel","Checkbox","changeCallback","children","getFilters","LICHESS_TIME_CONTROLS","CHESS_DOT_COM_TIME_CONTROLS","TIME_CONTROL_LABELS","str","DP_TABLE","OpeningGraph","graph","Graph","hasMoves","arrayEntries","lastFen","parsedMove","addMoveForFen","addGameResultOnFen","addStatsToRoot","fullFen","resultIndex","currNode","getNodeFromGraph","gameResults","targetNode","details","blackWins","whiteWins","totalOpponentElo","lastPlayed","newDetails","getUpdatedMoveDetails","updateCalculatedValues","bestWin","bestWinGame","bestWinElo","getOpponentElo","worstLoss","worstLossGame","worstLossElo","lastPlayedGame","count","fullSourceFen","fullTargetFen","resultObject","playedByMax","getTargetDetailsCount","playedBy","targetDetails","nodes","GraphNode","set","currentMoveDetails","whiteWin","blackWin","draw","resultInt","currentBestWinGame","parseInt","currentWorstLossGame","currentLastPlayedGame","entry","targetNodeDetails","getDetailsForFen","orig","dest","to","level","levelFor","moveCount","maxCount","Map","openingGraph","OpeningManager","plys","currentIndex","pgnAsList","moveForward","pgnList","pgnSoFar","pgnListSoFar","moveNumber","whitePly","blackPly","currMove","floor","moveTo","Navigator","openingManager","currentMove","keyHandler","keyCode","previous","next","addPly","device","moveBack","opening","ChessEcoCodes","openingCode","code","lg","Button","faStepBackward","faStepForward","GlobalHeader","useState","setIsOpen","modal","setModal","toggleModal","launch","open","Navbar","light","expand","width","NavbarBrand","href","NavbarToggler","navbar","Nav","NavItem","NavLink","faDiscord","toggleFeedback","faComments","UncontrolledDropdown","DropdownToggle","nav","DropdownMenu","right","DropdownItem","divider","Modal","toggle","ModalHeader","ListGroup","ListGroupItem","tag","ModalFooter","Source","source","addNumber","Badge","ExpansionPanelSummary","aria-controls","id","getSourceOption","ExpansionPanelDetails","RadioGroup","siteChange","Radio","Divider","Dropzone","newFiles","filesChange","acceptedFiles","dropzoneText","handleFileChange","dropzoneParagraphClass","showFileNames","useChipsForPreview","previewChipProps","dropzoneClass","filesLimit","maxFileSize","NotableChessGames","updateDetails","option","profile","imageUrl","subText","list","options","selectedDetail","placeholder","renderOption","renderDetails","selectedEvent","playerNameError","player","validateInputDetailsSet","playerDetailsChange","finalPlayerName","helperText","TextField","editPlayerName","onKeyUp","playerNameKeyUp","setPlayerDetails","notablePlayers","notablePlayerChange","notableEvents","notableEventChange","getPlayerNameInput","Card","CardBody","CardTitle","faInfoCircle","CardText","getPgnFileSelection","getGoatDBEventSelection","getGoatDBSelection","getOpeningTreeSelection","getInputsToShow","ExpansionPanelActions","PGNLoader","settings","panel","newExpanded","timestamp","now","playername","openingTreeSave","saveVersion","setEntries","importCallback","gamesDetails","newSite","fetchGOATGames","filters","Filters","SettingsView","eventName","reset","faRetweet","clearAction","faTrashAlt","resetAction","faFastBackward","analyse","faDesktop","ControlsContainer","stopPropagation","simplifiedView","multiline","rowsMax","inputProps","style","fontSize","spellCheck","copyFen","moveDetails","getFenField","switchToUserTab","faUser","performanceDetails","Table","eatClicks","isNaN","TableHead","TableRow","TableCell","TableBody","launchGame","faExternalLinkAlt","removeQuestionMarksFromDate","TableFooter","colSpan","rel","indexOf","MovesList","openPerformanceIndex","onMove","prevProps","prevState","turnColor","moveIndex","movesToShow","resultsTable","movesTable","whitePlayer","blackPlayer","performancePopoverOpen","openMove","Popover","trigger","togglePerformancePopover","sampleResultWhite","sampleResultBlack","sampleResult","getPopover","Progress","multi","bar","activeTab","activeGame","tab","tabs","classnames","active","faChartBar","faCog","TabContent","TabPane","tabId","settingsChange","updateProcessedGames","turn","brushes","forBrushes","againstBrushes","calcMovable","dests","SQUARES","s","ms","square","verbose","m","free","orientation","promotion","lastMove","onMoveAction","navigateTo","previousMove","parsedGame","totalGamesProcessed","addPGN","downloadingGames","moveToShape","brush","autoShapes","shapes","fillArray","movesForFen","gameResultsForFen","len","trackingEvent","subMessage","errorActionText","errorAction","messageSeverity","trackingLabel","closeError","diagnosticsOpen","feedbackOpen","diagnosticsDataOpen","toggleDiagnosticsData","copyDiagnostics","importGameState","importState","getChessboardWidth","innerWidth","getDiagnosticsValue","navigator","userAgent","getRedditLink","getSubject","getBody","getEmailLink","addStateManagement","obj","variantIcon","CheckCircleIcon","warning","WarningIcon","ErrorIcon","InfoIcon","theme","backgroundColor","green","palette","dark","primary","amber","iconVariant","opacity","marginRight","spacing","alignItems","classes","onClose","actionText","showReportButton","other","Icon","SnackbarContent","clsx","aria-describedby","IconButton","aria-label","MainContainer","chessboardWidth","lastMoveArray","snackBarOpen","order","xs","movable","drawable","enabled","visible","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","ModalBody","ReactDOM","render","isAdvancedFiltersEnabled","isFilterPanelEnabled","treeSaveDisabledReason","selectedSite","exportFileName","extension","peg$SyntaxError","expected","found","Error","captureStackTrace","child","parent","ctor","constructor","peg$subclass","buildMessage","DESCRIBE_EXPECTATION_FNS","literal","expectation","literalEscape","text","escapedParts","parts","classEscape","inverted","any","end","description","hex","ch","charCodeAt","toUpperCase","j","descriptions","describeExpected","describeFound","module","exports","SyntaxError","input","peg$result","peg$FAILED","peg$startRuleFunctions","start","peg$parsestart","peg$startRuleFunction","peg$c3","h","c","mr","r","reduce","acc","x","comment","make_game","peg$c4","peg$c6","peg$literalExpectation","peg$c7","peg$c8","peg$classExpectation","peg$c10","peg$c11","peg$c12","peg$c13","peg$c15","peg$c16","peg$c17","chars","peg$c19","peg$c21","peg$c23","peg$c25","peg$c27","peg$c29","peg$c32","peg$c33","peg$c34","peg$c35","peg$c36","peg$c37","peg$c39","peg$c41","peg$c42","peg$c43","peg$c45","peg$c47","peg$c49","peg$c51","peg$c53","peg$c57","peg$c58","peg$c59","peg$c61","peg$c63","peg$c65","peg$c67","peg$c69","peg$c71","peg$c73","peg$c74","peg$c75","peg$c77","peg$c79","peg$c82","peg$c84","peg$c85","flatten","isArray","peg$c86","mn","peg$c88","nags","com","peg$c92","peg$c94","peg$currPos","peg$posDetailsCache","line","column","peg$maxFailPos","peg$maxFailExpected","peg$silentFails","startRule","ignoreCase","peg$computePosDetails","pos","p","peg$computeLocation","startPos","endPos","startPosDetails","endPosDetails","offset","peg$fail","peg$buildStructuredError","s0","s1","s2","s3","s4","s5","peg$parsegame","peg$parsenewline","charAt","peg$parseEOF","g","s6","s7","peg$parseheader","peg$parseheaders","peg$parsecomment","peg$parsewhitespace","peg$parsemovetext","peg$parseresult","peg$c2","peg$parsedouble_quote","peg$parseinteger","test","peg$parsews","peg$parsesymbol","peg$parsestring","hn","hv","make_header","peg$parsepiece","peg$parserank","peg$parsefile","peg$parsecapture","peg$parseperiod","substr","peg$parsesquare","peg$parsenag","peg$parsecomment_chars","peg$parsepawn_half_move","peg$parsepromotion","peg$parsehalf_move","peg$parsecontinuation","peg$parsecastle_half_move","peg$parsepiece_disambiguation_half_move","peg$parsepiece_half_move","peg$parsecheck","peg$parsecheckmate","peg$parsenag_alts","peg$parsemove","s8","s9","peg$parsemove_number","peg$parserav","ravs","make_move","first","rest","concat"],"mappings":"mHAAA,iFAGO,SAASA,IACZC,IAAQC,SAASC,OAAOC,SAASC,UAG9B,SAASC,EAAWC,EAAUC,EAAQC,EAAOC,GAChDT,IAAQU,MAAM,CACVJ,SAAUA,EACVC,OAAQA,EACRC,MAAOA,EACPC,MAAOA,IAXfT,IAAQW,WAAW,mB,+BCDnB,0uCAAO,IAAMC,EAA4B,cAC5BC,EAAsB,SACtBC,EAAqB,QACrBC,EAAqB,QACrBC,EAAyB,YACzBC,EAA8B,iBAC9BC,EAAqB,QACrBC,EAAoB,QACpBC,EAAiC,oBACjCC,EAA6B,gBAC7BC,EAAwB,WAExBC,EAAe,UACfC,EAAqB,WACrBC,EAAgB,UAChBC,EAAgB,UAChBC,EAAiB,WACjBC,EAAyB,WAEzBC,EAAqB,IACrBC,EAAiB,IAEjBC,EAA4B,SAC5BC,EAA4B,QAC5BC,EAA0B,WAC1BC,EAA2B,YAC3BC,EAA4B,aAC5BC,EAAuB,QACvBC,EAA+B,UAE/BC,EAAW,2DAEXC,EAAqB,QACrBC,EAAqB,QAErBC,EAA+B,IAE/BC,EAAqB,2BACrBC,EAAsB,eACtBC,EAAuB,UACvBC,EAAyB,UACzBC,EAAuB,6BAEvBC,EAAoC,EAGpCC,EAA8B,Y,iCC9C3C,2GAIO,SAASC,EAAqBC,EAAUC,EAAUC,GACrD,IAAIC,EA2HR,SAAeH,GACX,IAEII,EAAS,CAFA,CAACC,MAAML,EAASM,OAAQC,MAAM,EACvCC,WAAWR,EAASS,OAAOC,KAAI,SAAAC,GAAG,OAAEA,EAAIC,YAK5C,OAHAZ,EAASS,OAAOI,SAAQ,SAACC,GACrBC,MAAMC,UAAUC,KAAKC,MAAMd,EAKnC,SAAoBU,EAAOK,EAAWC,GAGlC,IAFA,IAAIjB,EAAa,GAERkB,EAAE,EAAGC,EAAW,EAAGD,EAAEP,EAAMF,OAAQS,GAAGF,EAAWG,IACtDnB,EAAac,KAAK,CAACZ,MAAMS,EAAMS,MAAMF,EAAEA,EAAEF,GAAYZ,MAAMa,EAAWE,IAE1E,OAAOnB,EAXgCqB,CAAWV,EAAO,IAAMV,EAAOQ,YAE/DR,EAlIYC,CAAML,GACrByB,EAAiB,GAErBA,EAAeR,KAAKS,EAAgB,IACpCD,EAAeR,KAAKS,EAAgBvB,EAAaS,SACjD,IAAIe,EAAkBxB,EAAaS,OAC/BgB,GAAW,EACfzB,EAAaU,SAAQ,SAACR,GAClBwB,IAAKC,QACD,IAAIC,SAAOC,KAAKC,UAAU5B,KAC1B,SAAC6B,EAAMC,GAOH,GANAR,IACGO,IACCN,GAAW,GAEfH,EAAeR,KAAKS,EAAgBS,EAAKC,aACzCX,EAAeR,KAAKkB,GACjBR,GAAiB,EAAG,CACnB,GAAGC,EAEC,YADA1B,EAAS,uBAGbmC,iBAAO,IAAIC,KAAKb,EAAgB,CAACc,KAAM,6BAA8BtC,GACrEC,EAAS,KAAD,qCAAqCD,WAM1D,SAASuC,EAAuBC,EAAMvC,GACzC,IAAIwC,EAAS,IAAIC,WACjBD,EAAOE,OAAS,SAASC,GACrB,IAAIV,EAAOU,EAAIC,OAAOC,OAClBxC,EAAQ,EACRyC,EAAUC,EAAkBd,EAAKZ,MAAMhB,EAAMA,EAAM,IAEvD,GADAA,GAAgB,EACD,IAAZyC,EAAH,CAIA,IAAIE,EAAYD,EAAkBd,EAAKZ,MAAMhB,EAAMA,EAAM,IACzDA,GAAgB,EACZ2C,EAYZ,SAA2Bf,EAAMf,EAAY8B,EAAWhD,GACpD,IAAIK,EAAQa,EACRK,EAAiB,GACjBE,EAAkBuB,EAClBtB,GAAS,EACTuB,EAAgB,SAACjB,EAAOC,GACxBR,IACGO,IACCkB,QAAQC,IAAInB,GACZN,GAAS,GAEb,IACIH,EAAeR,KAAKe,KAAKsB,MAAMnB,IACjC,MAAOoB,GACLH,QAAQC,IAAIE,GACZ3B,GAAS,EAEQ,IAAlBD,IACIC,GACC1B,EAAS,6BAA8B,MAG3CA,EAAS,KAcrB,SAAqCuB,GACjC,IAAI+B,EAAe/B,EAAegC,MAAK,SAACC,EAAEC,GAAH,OAAOD,EAAEnD,MAAMoD,EAAEpD,SACpDqD,EAAkBJ,EAAajC,MAAM,GAAGb,KAAI,SAAAmD,GAAE,OAAEA,EAAGxD,SAAOyD,OAC1DxD,EAASkD,EAAa,GACtB/C,EAAS,GACTF,EAAQ,EAKZ,OAJAD,EAAOE,WAAWK,SAAQ,SAACkD,GACvBtD,EAAOQ,KAAK2C,EAAgBrC,MAAMhB,EAAMA,EAAMwD,IAC9CxD,GAAOwD,KAEJ,CACHzD,OAAOA,EAAOD,MACdI,OAAOA,GA1BYuD,CAA4BvC,MAInD,KAAMyB,EAAU,GAAG,CACf,IAAI/B,EAAY8B,EAAkBd,EAAKZ,MAAMhB,EAAMA,EAAM,IACzDA,GAAgB,EAChBsB,IAAKoC,QACDlC,SAAOmC,KAAK/B,EAAK5B,EAAMY,GAAYgC,GACvC5C,GAAgBY,EAChB+B,KAxCAiB,CAAkBhC,EAAM5B,EAAO2C,EAAWhD,GAHtCA,EAAS,mCAAoC,WAN7CA,EAAS,wCAAyC,KAAK,sCAW/DwC,EAAO0B,QAAU,SAASb,GACtBrD,EAAS,kCAAmC,KAApC,UAA6CqD,EAAET,OAAOZ,MAAMmC,KAA5D,YAAoEd,EAAET,OAAOZ,MAAMoC,WAE/F5B,EAAO6B,kBAAkB9B,GAuD7B,SAASQ,EAAkBuB,GACvB,IAAIC,EAAO,IAAIC,SAASF,GACxB,OAAuB,OAApBC,EAAKE,UAAU,IAAmC,QAApBF,EAAKE,UAAU,GACrC,KAEJF,EAAKG,UAAU,GAG1B,SAASlD,EAAgB8C,GACrB,IAAIK,EAAS,IAAIC,YAAY,GACzBL,EAAO,IAAIC,SAASG,GAIxB,OAHAJ,EAAKM,UAAU,EAAG,MAClBN,EAAKO,UAAU,EAAGR,IAAU,GAC5BC,EAAKM,UAAU,EAAG,OACXF,I,gCC7HX,2LAMaI,EAAiBC,YAAW,CACrCC,KAAM,CACFC,OAAQ,gCACRC,UAAW,OACX,qBAAsB,CAClBC,aAAc,GAElB,WAAY,CACRC,QAAS,QAEb,aAAc,CACVC,OAAQ,SAGhBC,SAAU,IAdgBP,CAe3BQ,KAEI,SAASC,EAAcC,GAC1B,OAAO,yBAAKC,IAAG,eAAUD,GAAKE,UAAY,2BAA2BC,IAAG,yBAAoBH,EAApB,QAA6BI,OAAQ,KAG1G,SAASC,EAAgBC,GAC5B,OAAOC,YAA8BD,EACjC,CAACE,IAAqCA,IACtCA,IAA8BA,IAC9BA,IAAuCA,IACvCA,IAAkCA,IAClCA,IAA0CA,IAC1CA,MAGD,SAASC,EAASC,GAErB,IAAID,EAAWE,SAASC,eAAeF,GACvC,IAOI,OALAD,EAASI,SACTJ,EAASK,kBAAkB,EAAG,OAG9BH,SAASI,YAAY,SACd,EACT,MAAMpD,GACJ,OAAO,K,gCCjDf,mSAGO,SAAS4C,EAA8BS,EAAYC,GACtD,IAAIC,EAAY,GAIhB,OAHAD,EAAWhG,SAAQ,SAAAkG,GACfD,EAAUC,GAAYH,EAAWG,MAE9BD,EAEJ,SAASE,EAAcC,GAC1B,IAAIC,EAAgBD,EAAIE,MAAM,KAC9B,OAAGD,EAActG,QAAS,EACfqG,EAGL,GAAN,OAAUC,EAAc,GAAxB,YAA8BA,EAAc,GAA5C,YAAkDA,EAAc,IAG7D,SAASE,EAAqBC,EAAKC,EAAkBC,GAGxD,OAFsBF,IAASjB,IAC3BoB,IAA+BA,KACZC,QAAO,SAACC,GAAD,QAAiBJ,EAAiBI,KAAiBH,KAErF,IAAII,EAAc,CACd,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAE1E,SAASC,IASZ,IARA,IAAIC,EAAQ,CAAC,CACTC,KAAK,KACLvK,MAAM,IAENA,EAAQ,EACRwK,EAAY,KACZC,GAAc,IAAIC,MAAOC,cACzBC,GAAe,IAAIF,MAAOG,WACxBL,EAAYC,EAAY,GAC1BH,EAAM5G,KAAK,CACPoH,YAAY,GAAD,OAAIV,EAAY,IAAhB,YAAuBI,GAClCO,cAAc,GAAD,OAAIX,EAAY,GAAhB,YAAsBI,GACnCD,KAAKC,EACLxK,MAAMA,IAEVwK,IACAxK,IAEJ,IAAI,IAAI8D,EAAE,GAAGA,EAAE,EAAEA,IAAK,CAElB,IAAIkH,GAASJ,EAAa,GAAG9G,GAAG,GAC5ByG,EAAOS,EAAMJ,EAAaH,EAAYA,EAAY,EACtDH,EAAM5G,KAAK,CACPqH,cAAc,GAAD,OAAKX,EAAYY,GAAjB,YAA2BT,GACxCO,YAAY,GAAD,OAAKV,EAAYY,GAAjB,YAA2BT,GACtCS,MAAMA,EACNT,KAAMA,EACNvK,MAAMA,IAEVA,IAOJ,OALAsK,EAAM5G,KAAK,CACPsH,MAAM,GACNT,KAAME,EACNzK,MAAMA,IAEHsK,EAGJ,SAASW,EAAyBC,EAAWC,GAChD,IAAIC,EAAYF,EAAU,GACtBG,EAAUH,EAAU,GACpBI,EAAgBH,EAAeC,GAC/BG,EAAcJ,EAAeE,GAEjC,GAAGD,IAAcD,EAAe9H,OAAO,GAAKgI,IAAYF,EAAe9H,OAAO,EAAG,CAC7E,IAAImI,EAAc,IAAId,KACtB,MAAO,CACH3K,MAAM,gBACN0L,UAAUD,EAAYX,WACtBa,SAASF,EAAYb,cACrBgB,cAAcC,EAAoBJ,EAAYX,WAAYW,EAAYb,cAAe,QAG7F,GAAiB,IAAdS,GAA+B,IAAZC,EAClB,MAAO,CAACtL,MAAM,WAElB,GAAiB,IAAdqL,GAAmBC,IAAYF,EAAe9H,OAAO,EACpD,MAAO,CAACtD,MAAM,WAElB,GAAGsL,IAAYF,EAAe9H,OAAO,EAAG,CACpC,IAAI2H,EAAQM,EAAcN,MAAQM,EAAcN,MAAQ,EACxD,MAAO,CACHjL,MAAM,SAAD,OAAUuL,EAAcP,eAC7BW,SAAUJ,EAAcf,KACxBkB,UAAWT,EACXW,cAAeC,EAAoBZ,EAAOM,EAAcf,KAAM,QAGtE,GAAiB,IAAda,EAAiB,CAChB,IAAIJ,EAAQO,EAAYP,MAAQO,EAAYP,MAAQ,GACpD,MAAO,CACHjL,MAAM,SAAD,OAAUwL,EAAYT,aAC3Be,OAAQN,EAAYhB,KACpBuB,QAASd,EACTe,YAAaH,EAAoBZ,EAAOO,EAAYhB,KAAM,QAGlE,IAAIkB,EAAYH,EAAcN,MAAQM,EAAcN,MAAQ,EACxDc,EAAUP,EAAYP,MAAQO,EAAYP,MAAQ,GACtD,MAAO,CACHjL,MAAM,QAAD,OAASuL,EAAcP,cAAvB,eAA2CQ,EAAYT,aAC5DY,SAAUJ,EAAcf,KACxBkB,UAAWA,EACXE,cAAeC,EAAoBH,EAAWH,EAAcf,KAAM,OAClEsB,OAAQN,EAAYhB,KACpBuB,QAASA,EACTC,YAAaH,EAAoBE,EAASP,EAAYhB,KAAM,QAIpE,SAASqB,EAAoBZ,EAAOT,EAAMyB,GACtC,MAAgB,QAAbA,EACQ,IAAItB,KAAKH,EAAMS,GAAOiB,UAEtB,IAAIvB,KAAKH,EAAKS,EAI7B,SAAwBT,EAAKS,GACzB,OAAO,IAAIN,KAAKH,EAAMS,EAAQ,EAAG,GAAGkB,UALLC,CAAe5B,EAAMS,IAAQiB,UAQzD,SAASG,EAAsBC,EAAUC,EAAOC,EAAOC,EAAOC,GACjE,IAAIC,EAAaJ,EAAQC,EAAQC,EAC7BG,EAAaC,KAAKC,MAAMR,EAASK,GACjCI,EAAaL,IAAgB5D,IAA6ByD,EAAME,EAChEO,EAAeN,IAAgB5D,IAA6ByD,EAAME,EAClEQ,EAAQF,EAAYP,EAAM,EAC1BU,EAAkBL,KAAKC,MAAY,IAANG,EAAUN,GACvCQ,EAAejD,IAAgBgD,GACnC,MAAO,CACHE,QAAQ,IAAD,OAAKL,EAAL,YAAmBC,EAAnB,YAAmCR,GAC1Ca,kBAAkBT,EAAWO,EAC7BP,WAAYA,EACZK,MAAM,GAAD,OAAIK,OAAOC,UAAUN,GAAOA,EAAMA,EAAMO,QAAQ,GAAhD,YAAsDb,GAC3DQ,aAAa,GAAD,OAAmB,IAAfA,EAAiB,GAAIA,EAAa,EAAE,IAAI,KAA5C,OAAmDN,KAAKY,IAAIN,KAIzE,SAASO,EAA6BC,EAAKC,GAC9C,OAAGA,EAAM,KAAK9E,KAGP6E,GAAKC,EAAM,KAFPD,GAAKC,EAAM,GAKnB,SAASC,EAAqBC,EAAMC,GAEvC,QAAIA,KAGAD,GAGG,IAAInD,KAAKmD,GAAM,IAAInD,KAAKoD,M,qXC9IdC,E,YAEjB,WAAYC,GAAQ,IAAD,8BACf,4CAAMA,KACDrF,MAAQ,CACT8D,YAAa,EAAKuB,MAAMvB,YACxBwB,uBAAuB,GAE3B,EAAK9C,eAAe,EAAK6C,MAAM7C,eAC/B+C,OAAOC,OAAO,EAAKxF,MAAO,EAAKqF,MAAMtF,iBACrC,EAAK0F,uBAAyB,EAAKJ,MAAMtF,gBAR1B,E,2EAYU,QAArB2F,KAAK1F,MAAM2F,MACXD,KAAKE,SAAS,CAAED,MAAO,UACK,UAArBD,KAAK1F,MAAM2F,MAClBD,KAAKE,SAAS,CAAED,MAAO,WAEvBD,KAAKE,SAAS,CAAED,MAAO,QAE3B1O,YAAWiJ,IAAqC,uBAAwB,W,kCAEhEW,GAAW,IAAD,OAClB,OAAO,WACH,IAAIgF,EAAW,GACfA,EAAShF,IAAa,EAAKb,MAAMa,GACjC,EAAK+E,SAASC,GACd5O,YAAWiJ,IAAqC,wBAAyB,EAAKF,MAAMmB,S,wCAG1E7J,GACd,IAAIwM,EAAcxM,EAAMsF,OAAOvF,MAC/BqO,KAAKE,SAAS,CAAE9B,YAAaA,IAC7B7M,YAAWiJ,IAAqC,cAAe4D,GAC3DgC,IAAoCJ,KAAKL,MAAMlE,OAC/C4E,EAAaL,KAAKM,WAAWC,KAAKP,S,8CAGlBpO,GACpBoO,KAAKE,SAAL,eAAiBtO,EAAMsF,OAAOuB,KAAO7G,EAAMsF,OAAOsJ,Y,4CAEhC5O,EAAO6O,GACzBT,KAAKE,SAAL,eAAiB1F,IAA2CiG,M,2CAE3C7O,EAAO6O,GACxBT,KAAKE,SAAL,eAAiB1F,IAAkCiG,M,gDAE7B7O,EAAO6O,GAC7BT,KAAKE,SAAL,eAAiB1F,IAAuCiG,M,mCAIpDT,KAAK1F,MAAM8D,aAIf4B,KAAKE,SAAS,CAACQ,WAAW,GAAId,uBAAsB,IACpDI,KAAKL,MAAMgB,cAAcX,KAAK1F,QAJ1B0F,KAAKE,SAAS,CAACQ,WAAW,4B,iCAMvBE,GACP,OAAGZ,KAAKL,MAAMvB,cAAgBwC,EACnB,8BACF7G,YAAc,QADZ,UAEI,2BAAIiG,KAAKL,MAAMvB,cAAc5D,IAA6B,QAAQ,QAAlE,KACNwF,KAAKa,4BAA4B,0BAAM3G,UAAU,aAAhB,qBAAqD,MAGxF,8BAAOH,YAAc,GAArB,wB,gDAEe+G,GACtBd,KAAKE,SAAL,eAAkBY,EAASzG,gBAA3B,CAA4C+D,YAAY0C,EAAS1C,iB,kDAIjE,cAAyByB,OAAOkB,QAAQf,KAAKD,wBAA7C,eAAsE,CAAC,IAAD,sBAA5DiB,EAA4D,KAAvDrP,EAAuD,KAClE,GAAGqO,KAAKL,MAAMtF,gBAAgB2G,KAAOrP,IAGjCsP,IAAUjB,KAAKL,MAAMtF,gBAAgB2G,GAAMrP,GAC3C,OAAO,EAGf,OAAO,I,+BAKP,IAAIiP,GAAcR,IAAgCJ,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMuB,WAAYlB,KAAKL,MAAMwB,uBACrG,OAAO,kBAAC,IAAD,CAAgBtH,SAAuC,YAA7BmG,KAAKL,MAAMyB,cAChCC,oBAAqBC,IACrBC,gBAAiB,CAACC,QAAQhH,KAClCiH,SAAUzB,KAAKL,MAAM+B,sBACrBC,SAAUf,GACV,kBAAC,IAAD,CAAuBgB,WAAY,kBAAC,IAAD,OAAqB5B,KAAK6B,WAAWjB,IACxE,kBAAC,IAAD,KACI,yBAAK1G,UAAU,yBACf,kBAAC,IAAD,CAAa4H,UAAU,WAAWxL,QAAS0J,KAAK1F,MAAMoG,YAClD,kBAAC,IAAD,CAAWoB,UAAU,UAArB,eAA0C,2BAAI9B,KAAKL,MAAMuB,YAAzD,mBACA,kBAAC,IAAD,CAAYO,SAAUzB,KAAK+B,kBAAkBxB,KAAKP,MAAOrO,MAAOqO,KAAK1F,MAAM8D,aACvE,kBAAC,IAAD,CAAkBlE,UAAU,aAAatB,QAAS,kBAAC,IAAD,CAAOoJ,MAAM,YAAcrQ,MAAO6I,IAA8B9I,MAAOsO,KAAK1F,MAAM8D,cAAgB5D,IAA6B,oCAAa,UAC9L,kBAAC,IAAD,CAAkBN,UAAU,aAAatB,QAAS,kBAAC,IAAD,CAAOoJ,MAAM,YAAcrQ,MAAO6I,IAA8B9I,MAAOsO,KAAK1F,MAAM8D,cAAgB5D,IAA6B,oCAAa,WAElM,kBAAC,IAAD,KAAiBwF,KAAK1F,MAAMoG,cAG/BN,IAAoCJ,KAAKL,MAAMlE,MAAM,yBAAKvB,UAAU,oBAAmB,0BAAMA,UAAU,YAAY+H,QAASjC,KAAKkC,YAAY,yBAAyB3B,KAAKP,OAApF,oBAA4G,kBAAC,IAAD,CAAiBmC,KAAMnC,KAAK1F,MAAMsF,sBAAwBwC,IAAYC,OACtQ,kBAAC,IAAD,CAAUC,OAAQtC,KAAK1F,MAAMsF,uBACrB,kBAAC,IAAD,CACInE,KAAMuE,KAAKL,MAAMlE,KACjB8G,YAAavC,KAAKuC,YAAYhC,KAAKP,MACnCwC,wBAAyBxC,KAAKwC,wBAAwBjC,KAAKP,MAC3DyC,sBAAuBzC,KAAKyC,sBAAsBlC,KAAKP,MACvD0C,qBAAsB1C,KAAK0C,qBAAqBnC,KAAKP,MACrDlD,eAAgBkD,KAAKlD,eACrB6F,0BAA2B3C,KAAK2C,0BAA0BpC,KAAKP,MAC/D3F,gBAAiBA,YAAgB2F,KAAK1F,WAG/C,MAEP,kBAAC,IAAD,MACA,kBAAC,IAAD,KACI,kBAAC,IAAD,CAAkBnC,KAAK,QAAQ6J,MAAM,UAAUC,QAASjC,KAAKM,WAAWC,KAAKP,OAA7E,kB,GA3Hc4C,IAAMC,a,wUCLnBC,E,YACjB,WAAYnD,GAAQ,IAAD,8BACf,4CAAMA,KAMVoD,OAAS,WACD,EAAKC,WACL,EAAKA,UAAUC,mBAPnB,EAAK3I,MAAQ,CACT4I,uBAAwB,EACxBC,qBAAsB,GAJX,E,iFAaf/R,OAAOgS,iBAAiB,eAAgBpD,KAAK+C,U,6CAI7C3R,OAAOiS,oBAAoB,eAAgBrD,KAAK+C,U,0CAGhD/C,KAAKE,SAAS,CAACiD,qBAAoB,IACnC5R,YAAWiJ,IAAqC,WAAYwF,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMvB,cAAgB5D,IAA+B,EAAI,GAC3I6F,EAAaL,KAAKsD,kBAAkB/C,KAAKP,S,0CAExB,IAAD,OAChBpJ,YAAuBoJ,KAAKL,MAAM4D,MAAM,IACpC,SAACC,EAAIjN,EAAMkN,GACP,GAAGD,EAGC,OAFA,EAAK7D,MAAM+D,UAAUF,EAAK,KAAMC,QAChC,EAAKvD,SAAS,CAACiD,qBAAoB,IAGvC,IAAIQ,EAAU,EAAKhE,MAAMiE,wBAAwBrN,GACjD,EAAK2J,SAAS,CAACiD,qBAAoB,IAChCQ,GACC,EAAKhE,MAAMkE,SAAS,uC,0CAKhC7D,KAAKE,SAAS,CAACiD,qBAAoB,IACnC5R,YAAWiJ,IAAqC,WAAYwF,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMvB,cAAgB5D,IAA+B,EAAI,GAC3I6F,EAAaL,KAAK8D,kBAAkBvD,KAAKP,S,0CAExB,IAAD,OAChB7L,YAAqB6L,KAAKL,MAAMoE,0BAC5B3D,IAA0BJ,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMuB,WAAYlB,KAAKL,MAAMvB,YAAa,KAAM,SAChG,SAACoF,EAAKQ,GACCR,EACC,EAAK7D,MAAM+D,UAAUF,GAErB,EAAK7D,MAAMkE,SAASG,GAExB,EAAK9D,SAAS,CAACiD,qBAAoB,S,8BAKvCc,GACJjE,KAAKgD,UAAY,IAAIkB,IACrBlE,KAAKgD,UAAUmB,iBAAiBnE,KAAKL,MAAMuB,WACvClB,KAAKL,MAAMvB,YACX4B,KAAKL,MAAMlE,KACXuE,KAAKL,MAAMwB,sBACXnB,KAAKL,MAAMyE,qBACXH,EACAjE,KAAKL,MAAMtF,gBACX2F,KAAKL,MAAM0E,OACXrE,KAAKL,MAAM+D,UACX1D,KAAKiD,gBAAgB1C,KAAKP,MAC1BA,KAAKL,MAAM4D,S,iCAIfvD,KAAKsE,SAAQ,GACb/S,YAAWiJ,IAAqC,WAAYwF,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMvB,cAAgB5D,IAA+B,EAAI,K,sCAK3I,OAAGwF,KAAKL,MAAMlE,OAASjB,IACZwF,KAAKL,MAAMwB,sBAAsB1I,KAErCuH,KAAKL,MAAMuB,a,gDAEIJ,GACnBA,EAASyD,eAAe,GACvBvE,KAAKE,SAAS,CAACgD,uBAAsB,M,6BAKzClD,KAAKL,MAAM6E,QACXxE,KAAKE,SAAS,CAAEgD,uBAAuB,EAAMuB,WAAWzE,KAAKL,MAAMlE,OAEnEuE,KAAKL,MAAM8B,SAAS,aAAczB,KAAKL,MAAMuB,YAC7ClB,KAAKL,MAAM8B,SAAS,cAAezB,KAAKL,MAAMvB,aAC9C4B,KAAKsE,SAAQ,GACbtE,KAAKL,MAAM+E,gBAAe,GAC1BnT,YAAWiJ,IAAqC,OAAQwF,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMvB,cAAgB5D,IAA+B,EAAI,K,wCAGvIwF,KAAKL,MAAM+E,gBAAe,K,8CAG1B1E,KAAKiD,kBACL1R,YAAWiJ,IAAqC,kBAAmBwF,KAAKL,MAAMlE,Q,+CAG9E,OAAO,yBAAKvB,UAAU,oBAClB,kBAAC,IAAD,CACA+H,QAASjC,KAAK2E,kBAAkBpE,KAAKP,MACrC4E,QAAQ,YACR5C,MAAM,UACN6C,UAAW7E,KAAK1F,MAAM6I,oBAAoB,kBAAC,IAAD,MAAsB,kBAAC,IAAD,MAChEjJ,UAAU,aAAa4K,kBAAgB,EACvCnD,SAAU3B,KAAK1F,MAAM6I,qBAEhBnD,KAAK1F,MAAM6I,oBAAoB,oBAAoB,uB,uCAG9C,IAAD,OACT4B,EAAyB3E,IACGJ,KAAK1F,MAAMmK,WACXzE,KAAKL,MAAMlE,KACXuE,KAAKL,MAAM4E,eACXvE,KAAKL,MAAMqF,eAC3C,OAAO,6BACP,yBAAK9K,UAAU,oBAAmB,kBAAC,IAAD,CAC9B+H,QAASjC,KAAKiF,KAAK1E,KAAKP,MACxB4E,QAAQ,YACR5C,MAAM,UACN6C,UAAW,kBAAC,IAAD,MACX3K,UAAU,aAAa4K,kBAAgB,GALT,kBASlC,yBAAK5K,UAAU,oBAAmB,kBAAC,IAAD,CAC9B+H,QAASjC,KAAKkF,SAAS3E,KAAKP,MAC5B4E,QAAQ,YACR5C,MAAM,UACN6C,UAAW,kBAAC,IAAD,MACX3K,UAAU,aAAa4K,kBAAgB,GALT,kBAU9B,yBAAK5K,UAAU,oBAAmB,kBAAC,IAAD,CAASiL,UAAU,MAAMC,MAAOL,GAAwB,qDACtF,8BAAM,kBAAC,IAAD,CACN9C,QAASjC,KAAKqF,kBAAkB9E,KAAKP,MACrC4E,QAAQ,YACR5C,MAAM,UACN6C,UAAW7E,KAAK1F,MAAM6I,oBAAoB,kBAAC,IAAD,MAAsB,kBAAC,IAAD,MAChEjJ,UAAU,aAAa4K,kBAAgB,EACvCnD,WAAYoD,GAA0B/E,KAAK1F,MAAM6I,qBAE5CnD,KAAK1F,MAAM6I,oBAAoB,iBAAiB,uBAIzDnD,KAAK1F,MAAM4I,sBACP,6BACI,yBAAKhJ,UAAU,oBACT8F,KAAKL,MAAMvB,YAAoB4B,KAAKL,MAAMvB,cAAgB5D,IAA6B,cAAc,cAA9E,QAD7B,mBACsIwF,KAAKL,MAAM4E,eADjJ,KACoKvE,KAAKL,MAAMqF,cAAgB,0BAAM9K,UAAU,mBAAhB,IAAmC,0BAAMA,UAAU,YAAY+H,QAASjC,KAAKsF,sBAAsB/E,KAAKP,OAAO,yBAAK/F,IAAI,kBAAkBE,IAAI,gBAAgBC,OAAO,OAAlI,QAAnC,KAAkM,IAEjY,yBAAK6H,QAAS,kBAAM,EAAKtC,MAAM4F,oBAAoBrL,UAAU,kCACzD,kBAAC,IAAD,CAAiBiI,KAAMqD,MAD3B,kBAIF,M,sCAKV,OAAGxF,KAAKL,MAAMlE,OAASjB,IACZwF,KAAKyF,yBAETzF,KAAK0F,mB,+BAGZ,OAAG1F,KAAKL,MAAMyB,cACH,kBAAC,IAAD,CAAMI,QAAgD,EAAvChH,KACrBwF,KAAK2F,iBAGH,kBAAC,IAAD,CAAMC,IAAE,EAACpE,QAAgD,EAAvChH,KACpBwF,KAAK2F,qB,GA3LmB/C,IAAMC,a,yKCdpC,SAASgD,EAAaC,GAGzB,IAAIC,EAAaC,IAAiBF,GAkBlC,OAFAC,GALAA,GALAA,GAHAA,EAAaA,EAAWE,QAAQ,UAAW,KAGnBA,QAAQ,QAAS,KAKjBA,QAAQ,WAAnB,YAKWA,QAAQ,6BAAnB,O,YCjBIC,E,WAEjB,WAAYC,EAAKC,EAAoBC,EAAsBC,EAAeC,EAAcC,GAAc,IAAD,2BACjG,IAAIC,EAAc,GAEdC,EAAgBC,IAAQC,IACpBT,EACA,CAAEU,MAAM,IAASC,GAAG,QAASR,GAChCQ,GAAG,YAAW,SAACC,GACZ,OAAOV,EAAqBU,EAASC,eACtCF,GAAG,QAAQ,SAACvQ,GACX,IAAI0Q,EAAUb,EACVP,EAAaY,EAAgBlQ,EAAK2Q,YAClCT,EAAgBlQ,EAAK2Q,WACrBC,EAAeF,EAAQG,YAAR,UACfC,EAAOJ,EAAQtR,MAAM,EAAGwR,GAE5BV,EAAgBQ,EAAQtR,MAAMwR,GAC1B,EAAKG,iBAAiBD,EAAMd,IAC5BG,EAAca,WAEnBT,GAAG,OAAO,WACT,EAAKQ,iBAAiBb,EAAeF,GACrCC,O,6DAIKa,EAAMd,GAKnB,OAAOA,EAJQc,EAAK9L,MAAL,UACVzG,KACG,SAAAgR,GAAS,OAAG0B,YAAW1B,W,KC5BlB2B,EAEjB,WAAYvG,EAAY9C,EAAa/D,EAAiBqN,EAAOhE,GAAY,oBACrE,IACIiE,EAAmBC,mBAAmB1G,GACtC2G,EAAW,iBAAazJ,GACxB0J,EAAW,UAAqD,QAA/CzN,EAAgBG,KAAqC,GAArD,iBAAiH,UAA/CH,EAAgBG,KAAuC,OAAO,UACjJuN,EAAwBnL,YAAyBvC,EAAgBG,KAA2CwB,eAC5GgM,EAAe,UAAMD,EAAsBzK,cAAtB,iBAA8CyK,EAAsBzK,eAAgB,IACzG2K,EAAe,UAAMF,EAAsBrK,YAAtB,iBAA4CqK,EAAsBrK,aAAc,IACrGwK,EAAuB1M,YAAqBhB,IAAwBH,GAAiB,GACrF8N,EAA6C,IAAhCD,EAAqBlT,QAAgD,IAAhCkT,EAAqBlT,OACnE,GADS,oBACSkT,EAAqBE,KAAK,MACpD,IAAIlC,EAVc,sCAUiByB,EAAiBE,EAAYC,EAAYK,EAAWH,EAAgBC,GAAiB,GACpH,SAACI,GACuB,MAAjBA,EACC3E,EAAU,+BAAiCxC,GACnB,MAAjBmH,GACP3E,EAAU,wCAA0CxC,MAEzD,SAAC5K,GACAoN,EAAU,oEAAqE,KAAM,yDACrFgE,EAAM,IAAI,MACX,SAACY,GACA,IAAIC,EAAaD,EAAexT,KAAI,SAACgR,GACjC,IACI,OAAOpO,gBAAMoO,GAAW,GAC1B,MAAOnO,GAIL,OAHAH,QAAQC,IAAI,sBAAuBqO,GACnCtO,QAAQC,IAAIE,GACZpG,YAAWiJ,IAAgC,qBAAsB0G,GAC1D,SAcf,OAVyBwG,EAAMa,EAAW1M,QAAO,SAAC2M,GAC9C,IAAIA,GAA+B,aAAxBA,EAAIC,QAAQC,QACnB,OAAO,EAEX,IAAIC,EAAcvK,IAAgB5D,IAA6BgO,EAAIC,QAAQG,SAASJ,EAAIC,QAAQI,SAChG,QAAIzJ,YAA6BuJ,EAAatO,EAAgBG,UAI9D,MAEL,WACCkN,EAAM,IAAI,O,kBC7CLoB,EAEjB,WAAY5H,EAAY9C,EAAa/D,EAAiBqN,EAAOhE,GAAY,oBACrE,IAAIqF,EAAW,IAAIC,IAAY,CAC3BC,OAAO,IAEPC,EAAkB,EAClBC,EAAY,SAACC,GAgCb,GA/BAF,KACyBxB,EAAM0B,EAAgB/B,KAAKgC,MAAMxN,QACtD,SAAAyN,GACI,GAAgB,UAAbA,EAAKC,OAAmBD,EAAKlL,GAAaoL,SAASC,gBAAkBvI,EAAWuI,cAC/E,OAAO,EAEX,IAAIC,EAAYrP,EAAgBG,KAChC,GAAiB,UAAdkP,IAA0BJ,EAAKrJ,MAC9B,OAAO,EACJ,GAAkB,WAAdyJ,GAA0BJ,EAAKrJ,MACtC,OAAO,EAEX,IAAI5F,EAAgBiP,EAAKK,YACrB,OAAO,EAEX,IAAIhB,EAAcvK,IAAgB5D,IAA6B8O,EAAKnL,MAAMyL,OAAON,EAAKrL,MAAM2L,OAC5F,QAAIxK,YAA6BuJ,EAAatO,EAAgBG,SAI/D1F,KACC,SAAAwU,GACI,IACI,OAAO5R,gBAAMmO,EAAayD,EAAKd,MAAM,GACvC,MAAO7Q,GAIL,OAHAH,QAAQC,IAAI,sBAAuB6R,GACnC9R,QAAQC,IAAIE,GACZpG,YAAWiJ,IAAgC,sBAAjC,UAA2D0G,EAA3D,YAAyE9C,IAC5E,SAEZvC,QAAO,SAAAyN,GAAI,OAAY,OAATA,KAAgBJ,EAAgB,GACjC,CAEpB,KAAMH,EAASc,YACfX,EAAkB,EAClBxB,EAAM,IAAG,KAwBbK,EAAwBnL,YAAyBvC,EAAgBG,KAA2CwB,eAC5G8N,EAAgB,SAASC,GACzBA,EAAaC,SAASC,UAAUhV,SAAQ,SAACiV,GAErC,IAAIC,EAAWD,EAAW3O,MAAM,KAC5BW,EAAKiO,EAAWA,EAAWnV,OAAO,GAClC2H,EAAMwN,EAAWA,EAAWnV,OAAO,IA3Bb,SAACoV,EAAaC,EAAatC,GACzD,IAAI1K,EAAW0K,EAAsB1K,UAAY,KAC7CG,EAASuK,EAAsBvK,QAAU,IACzCJ,EAAY2K,EAAsB1K,UAAY,EAC9CI,EAAUsK,EAAsBvK,QAAU,GAE9C,OAAG6M,EAAYhN,GAAYgN,EAAY7M,KAGpC6M,EAAYhN,GAAYgN,EAAY7M,KAGpC6M,IAAgBhN,EACR+M,GAAgBhN,EAExBiN,IAAgB7M,EACR4M,GAAgB3M,GAE3BjG,QAAQC,IAAI,sBACL,KASA6S,CAA4B3N,EAAMT,EAAM6L,KACvCmB,IACAH,EAASwB,SAASxB,EAASyB,iCAAkCrB,EAAY,CAACjI,EAAYhF,EAAMS,QAG7E,IAApBuM,IACCxF,EAAU,2CAA2CxC,GACrDwG,EAAM,IAAI,KAIlBf,IAAQ,oCAAD,OAAqCzF,EAArC,oBAAkE,SAAU5K,EAAOyQ,EAAUM,GAChG,GAAG/Q,EACCoN,EAAU,wEAAyE,KAAM,yDACzFgE,EAAM,IAAI,QACP,GAA2B,MAAxBX,EAASC,WACftD,EAAU,iCAAiCxC,GAC3CwG,EAAM,IAAI,QACP,GAA4B,MAAxBX,EAASC,WAChBtD,EAAU,2CAA2CxC,GACrDwG,EAAM,IAAI,QAEV,GAAGX,EAASM,KACR,IACI,IAAIoD,EAAWrU,KAAKsB,MAAMqP,EAASM,MACnCyC,EAAcW,GACjB,MAAM9S,GACH+L,EAAU,2CAA2CxC,GACrDwG,EAAM,IAAI,QCxGbD,E,WAEjB,WAAYvG,EAAYqC,EAAOnF,EAAa/D,EAAiBqN,EAAOhE,GAAY,IAAD,2BAC3EH,EAAMtO,SAAQ,SAAC4B,GACE,EAAK6T,YAAYxJ,EAAY9C,EAAa/D,EAAiBqN,EAAOhE,GACxEiH,WAAW9T,M,wDAIdqK,EAAY9C,EAAa/D,EAAiBqN,EAAOhE,GACzD,IAAI5M,EAAS,IAAIC,WACb6T,EAAwBxM,IAAgB5D,IAA8B,QAAS,QAC/EqQ,EAAsB3J,EAAYA,EAAWuI,cAAgB,KA8BjE,OA7BA3S,EAAOE,OAAS,SAASC,GACrB,IAGIsR,EAHW1C,EAAa5O,EAAIC,OAAOC,QACdoE,MAAM,UAEJzG,KAAI,SAACgR,GAC5B,IACI,IAAIgF,EAAapT,gBAAM8P,YAAW1B,IAAY,GAC1CiF,EAAyBD,EAAUrC,QAAQmC,GAC/C,OAAG1J,GAAc6J,IAA2BA,EAAuBtB,cAAcuB,SAASH,GAE/E,KAEJC,EACT,MAAOnT,GAIL,OAHAH,QAAQC,IAAI,sBAAuBqO,GACnCtO,QAAQC,IAAIE,GACZpG,YAAWiJ,IAAgC,qBAAsB0G,GAC1D,SAGfwG,EAAMa,EAAW1M,QAAO,SAAA2M,GAAG,QAAIA,MAAM,IAEzC1R,EAAO0B,QAAU,SAASb,GACtB+L,EAAU,0BAA2B,KAAM/L,EAAET,OAAOZ,MAAMmC,KAAK,IAAId,EAAET,OAAOZ,MAAMoC,SAClFgP,EAAM,IAAI,IAEd5Q,EAAOmU,UAAY,WACfvD,EAAM,IAAI,IAEP5Q,M,uBC3CMoU,EAEjB,WAAY/E,EAAKgF,EAAsB/M,EAAa/D,EAAiBqN,EAAOhE,GAAY,oBACpF,IAAIkH,EAAwBxM,IAAgB5D,IAA8B,QAAS,QACnF,IAAI0L,EAAgBC,GAAK,GACrB,SAACkC,GACwB,MAAjBA,GACA3E,EAAU,yBAEf,SAACpN,GACAoN,EAAU,4BACVgE,EAAM,IAAI,MACX,SAACY,GACA,IAAIC,EAAaD,EAAexT,KAAI,SAACgR,GACjC,IAEI,OAAOpO,gBAAMoO,GAAW,GAC1B,MAAOnO,GAIL,OAHAH,QAAQC,IAAI,sBAAuBqO,GACnCtO,QAAQC,IAAIE,GACZpG,YAAWiJ,IAAgC,qBACpC,SAaf,OATyBkN,EAAMa,EAAW1M,QAAO,SAACyN,GAC9C,QAAIA,KAGD6B,IAAyBA,EAAqBH,SAAS1B,EAAKb,QAAQmC,GAAuBnB,oBAI9F,MAEL,WACC/B,EAAM,IAAI,OCvCL0D,EAEjB,WAAYC,EAAgBjN,EAAa/D,EAAiBqN,EAAOhE,GAAY,oBACzE,IAAI4H,EAAmBD,EAAeE,WAAWF,EAAeE,WAAWzW,KAAI,SAAA0W,GAAK,OAAEA,EAAM/B,iBAAe,KAC3G,IAAIyB,EAAeG,EAAeI,OAAQH,EAAkBlN,EAAa/D,EAAiBqN,EAAOhE,I,8CCGpFQ,E,WACjB,aAAe,oBACXlE,KAAK3B,WAAa,EAClB2B,KAAK0L,aAAe,EACpB1L,KAAK2L,kBAAmB,EACxBC,IAAYC,KAAO,8BACnB7L,KAAK8L,WAAa,K,8DAIf9L,KAAK8L,aACJ9L,KAAK8L,WAAWC,QAChB/L,KAAK8L,WAAa,Q,mCAIbxC,GACT,MAAM,GAAN,OAAUzJ,OAAOkB,QAAQuI,EAAKb,SAAS3T,KAAI,SAAAJ,GAAM,iBAAMA,EAAO,GAAb,aAAoBA,EAAO,GAA3B,SAAmC0T,KAAK,MAAzF,+BACYkB,EAAK0C,MAAMlX,KAAI,SAACmX,EAAYtX,GAC5B,MAAM,GAAN,OAAUA,EAAM,IAAI,EAAE,GAAGA,EAAM,EAAE,EAAE,IAAnC,YAA0CsX,EAAWC,SACtD9D,KAAK,KAHhB,YAGwBkB,EAAKnS,OAH7B,Y,uCAMa+J,EAAY9C,EAAa3C,EAAM0F,EAC5CiD,EAAsBH,EAAsB5J,EAAiBgK,EAC7DX,EAAWT,EAAiBM,GAAQ,IAAD,OAEnC,GADAvD,KAAKmM,yBAA0B,EAC5BlI,EAAsB,CACrB,IAAImI,EAAcR,IAAYS,kBAAkBjM,IAA0B3E,EAAMyF,EAAY9C,EAAagG,EAAsB,QAC/HpE,KAAK8L,WAAaM,EAAWE,YAEjC,IAAIC,EAAU,IAAIC,YAuBdC,EAAYxI,EAtBO,SAAC9M,EAAQwU,GAM5B,OALA,EAAKG,WAAWY,MAAMH,EAAQI,OAAOxV,EAAOrC,KAAI,SAAAwU,GAAI,OAAE,EAAKsD,aAAatD,MAAOlB,KAAK,MAAMyE,MAAK,WACvFlB,GACA,EAAK1I,sBAGN,GAEU,SAAC9L,EAAQwU,GAC1B,OAAIxU,GAGJ,EAAKkH,YAAclH,EAAOnC,OAC1B,EAAK0W,cAAgBvU,EAAOnC,OAC5B,EAAK2W,iBAAmBA,EAGxBmB,YAAW,WACP,EAAKC,cAActR,EAAMtE,EAAQkD,EAAiB+D,EAAa,EAAG8C,EAAYmD,EAAQX,EAAWT,KAClG,GACI,EAAKkJ,yBAVD,EAAKA,yBAahB1Q,IAASjB,IACT,IAAIiN,EAAgBvG,EAAY9C,EAAa/D,EAAiBoS,EAAW/I,GAClEjI,IAASjB,IAChB,IAAIsO,EAAiB5H,EAAY9C,EAAa/D,EAAiBoS,EAAW/I,GACnEjI,IAASjB,IAChB,IAAIwS,EAAgB9L,EAAYqC,EAAOnF,EAAa/D,EAAiBoS,EAAW/I,GACzEjI,IAASjB,IAChB,IAAI4Q,EAAsBjK,EAAuB/C,EAAa/D,EAAiBoS,EAAW/I,GACnFjI,IAASjB,KAChB,IAAI4Q,EAAsBhH,EAAsBhG,EAAa/D,EAAiBoS,EAAW/I,K,oCAMnFjI,EAAMwR,EAAU5S,EAAiB+D,EAAazJ,EAAQuM,EAAYmD,EAAQX,EAAWT,GAAkB,IAAD,OAQhH,GAPGtO,EAAOsY,EAASjY,QACfgL,KAAK0L,gBAEL1L,KAAK2L,kBAAoB3L,KAAK0L,cAAgB,GAC9CzI,MAGDtO,GAAQsY,EAASjY,SAAWgL,KAAKmM,wBAApC,CAIA,IAAI3D,EAAMyE,EAAStY,GAEnB,GAAG6T,EAAIwD,MAAM,IAAmC,IAA7BxD,EAAIwD,MAAM,GAAGkB,YAAmB,CAC/C,IAAIC,EAAQ,IAAIC,IACZC,GAAiB,EACjBC,EAAc,GAelB,GAdA9E,EAAIwD,MAAM/W,SAAQ,SAAAsY,GACd,IAAIC,EAAYL,EAAM9R,MAClB6Q,EAAOiB,EAAMjB,KAAKqB,EAAQrB,KAAM,CAACuB,QAAQ,IACzCC,EAAYP,EAAM9R,MAClB6Q,EAIJoB,EAAYjY,KAAK,CACbmY,UAAUA,EACVE,UAAUA,EACVC,QAAQzB,EAAK0B,MANbP,GAAe,KASpBA,EACC7V,QAAQC,IAAI,uBAAyB+Q,GACrC9E,EAAU,wBAAD,UAA6BxC,EAA7B,YAA2C9C,QACjD,CACH,IAAI/C,EAAM8R,EAAM9R,MACZwS,EAAmB,CACnBC,SAAS9N,KAAK+N,WAAWvF,EAAI/M,GAC7B6R,YAAYA,EACZU,UAAU3S,EACV+C,YAAYA,GAEhB4B,KAAKmM,wBAA0B9H,EAAOhK,EAAgBG,KAAsC,EAAGqT,IAGvGf,YAAW,WAAK,EAAKC,cAActR,EAAMwR,EAAU5S,EAAiB+D,EAAazJ,EAAM,EAAGuM,EAAYmD,EAAQX,EAAWT,KAAkB,M,iCAGpIuF,EAAK/M,GACZ,IAAI0K,EAAK,KACL1K,IAASjB,IACT2L,EAAMqC,EAAIC,QAAQwF,KACZxS,IAASjB,MACf2L,EAAMqC,EAAIC,QAAQyF,MAEtB,IAAIzF,EAAQ,KAIZ,OAHItC,IACAsC,EAAUD,EAAIC,SAEX,CACHtR,OAAOqR,EAAIrR,OACX8G,MAAMuK,EAAIC,QAAQ0F,MAClBhQ,MAAMqK,EAAIC,QAAQ2F,MAClBC,SAAS7F,EAAIC,QAAQI,SACrByF,SAAS9F,EAAIC,QAAQG,SACrBzC,IAAIA,EACJ3G,KAAKgJ,EAAIC,QAAQpM,KACjBoM,QAAQA,O,2MC/IhB8F,EAAc,CACd,CACI7c,MAAM,qBACNwW,qBAAqB,CACjB1N,IACAA,IACAA,KAEJgU,uBAAuB,CACnBhU,IACAA,IACAA,MAGR,CACI9I,MAAM,qBACNwW,qBAAqB,CACjB1N,IACAA,IACAA,KAEJgU,uBAAuB,CACnBhU,IACAA,IACAA,MAGR,CACI9I,MAAM,2BACNwW,qBAAqB,CACjB1N,IACAA,IACAA,IACAA,KAEJgU,uBAAuB,CACnBhU,IACAA,MAGR,CACI9I,MAAM,6BACNwW,qBAAqB,CACjB1N,IACAA,IACAA,IACAA,KAEJgU,uBAAuB,CACnBhU,IACAA,OAsCZ,SAASiU,EAAY1Z,EAAK2Z,GACtB,OAAOA,EAASC,OAAM,SAAAC,GAAC,OAAI7Z,EAAIiW,SAAS4D,MCzFrC,IAAMC,EDyDN,SAA0BpT,EAAMC,GACnC,IAAIwM,EAAuB1M,YAAqBC,EAAMC,GAAkB,GACpE8S,EAAyBhT,YAAqBC,EAAMC,GAAkB,GAC1E,OAAqC,IAAlC8S,EAAuBxZ,QAAgD,IAAhCkT,EAAqBlT,OACpD,oBAEwB,IAAhCkT,EAAqBlT,OACb4G,IAA2BsM,EAAqB,IAEtB,IAAlCsG,EAAuBxZ,OAChB,cAAN,OAAqB4G,IAA2B4S,EAAuB,KAExC,IAAhCtG,EAAqBlT,OACd,GAAN,OAAU4G,IAA2BsM,EAAqB,IAA1D,gBAAqEtM,IAA2BsM,EAAqB,KAM7H,SAAiCA,EAAsBsG,GACnD,IAAIM,EAAYP,EAAY1S,QACxB,SAACiT,GACG,OAAOL,EAAYD,EAAuBM,EAAUN,yBAC7CC,EAAYvG,EAAqB4G,EAAU5G,yBAE1D,GAAG4G,EAAU9Z,OACT,OAAO8Z,EAAU,GAAGpd,MAExB,OAAOwW,EAAqBpT,KAAI,SAAA8D,GAAO,OAAEgD,IAA2BhD,MAAUwP,KAAK,MAZ5E2G,CAAwB7G,EAAsBsG,I,kDElEpCQ,E,YACjB,WAAYrP,GAAQ,IAAD,8BACf,4CAAMA,KACDrF,MAAQ,CACT2U,4BAA4B,IAEhC,EAAKC,eAAe,CAChB,CACIvd,MAAM,EACND,MAAM,YACP,CACCC,MAAMgO,EAAM7C,eAAe9H,OAAO,EAClCtD,MAAM,QAEd,EAAKyd,mBAAmB,CACpB,CACIxd,MAAM,EACND,MAAM,KACP,CACCC,MAAM6I,IACN9I,MAAM,aAEd,EAAK0d,cAAc,CACf,CACIzd,MAAM,EACND,MAAM,KACP,CACCC,MAAM6I,IACN9I,MAAM,aA3BC,E,4FA+BY2d,GAAa,IAAD,OACvC,OAAO,WACA,EAAK/U,MAAM2U,8BAAgCI,IAE1CA,EAAa,IAEjB,EAAKnP,SAAS,CAAC+O,4BAA4BI,IAC3C9d,YAAWiJ,IAAqC,uBAAwB6U,M,iCAIrE5T,GACP,OAAO,6BACFuE,KAAKsP,oBAAoB,ODjDrB,SADarP,ECkD8BD,KAAKL,MAAMtF,gBAAgB4F,ODhDxE,mBACU,UAAVA,EACA,aACU,WAAVA,EACA,mBADJ,EC6CoFD,KAAKL,MAAM4C,aAC7FvC,KAAKsP,oBAAoB,eAAgBT,EAAoB7O,KAAKL,MAAMlE,KAAMuE,KAAKL,MAAMtF,iBAClF2F,KAAKuP,+BAA+B,eAAehP,KAAKP,MAC5D,kBAACwP,EAAA,EAAD,CAAUlN,OAAmD,gBAA3CtC,KAAK1F,MAAM2U,6BACxBjP,KAAKyP,sBAAsBhU,EAAM,KAGzCuE,KAAKsP,oBAAoB,eD/CHzS,EC+CqCmD,KAAKL,MAAMtF,gBAAgBG,KD/CrDsC,EC+CgGkD,KAAKL,MAAM7C,eD9C9IF,YAAyBC,EAAWC,GAAgBpL,OC+C/CsO,KAAKuP,+BAA+B,cAAchP,KAAKP,MACvD,kBAACwP,EAAA,EAAD,CAAUlN,OAAmD,eAA3CtC,KAAK1F,MAAM2U,6BACxBjP,KAAK0P,wBAEb1P,KAAKsP,oBAAoB,qBD/CP,KADEK,ECgD4C3P,KAAKL,MAAMtF,gBAAgBG,MD/ChF,IAAYmV,EAAiB,KAAKnV,IAC3C,kBACwB,IAAxBmV,EAAiB,GAClB,SAAN,OAAgBA,EAAiB,IAC1BA,EAAiB,KAAOnV,IACzB,SAAN,OAAgBmV,EAAiB,IAE3B,WAAN,OAAkBA,EAAiB,GAAnC,gBAA6CA,EAAiB,ICyCtD3P,KAAKuP,+BAA+B,YAAYhP,KAAKP,MACrD,kBAACwP,EAAA,EAAD,CAAUlN,OAAmD,aAA3CtC,KAAK1F,MAAM2U,6BACxBjP,KAAK4P,uBAEb5P,KAAKsP,oBAAoB,kBD1CAO,EC0CwC7P,KAAKL,MAAMtF,gBAAgBG,ODzC9EA,IAA6B,WAA7C,UAA2DqV,EAA3D,UC0CK7P,KAAKuP,+BAA+B,iBAAiBhP,KAAKP,MAC1D,kBAACwP,EAAA,EAAD,CAAUlN,OAAmD,kBAA3CtC,KAAK1F,MAAM2U,6BACxBjP,KAAK8P,6BD7CnB,IAA+BD,EAXLF,EAJE9S,EAAWC,EAVhBmD,I,gDC4EtB,OAAO,kBAAC8P,EAAA,EAAD,CAAQ7V,UAAY,eACvBvI,MAAOqO,KAAKL,MAAMtF,gBAAgBG,KAClCiH,SAAUzB,KAAKL,MAAMgD,0BACrBqN,kBAAkB,OAClBC,iBAAkB,SAACC,GAAD,OAAOA,GAAK1V,IAA6B,MAAM0V,GACjEC,KAAM,IACNC,IAAK,EACLC,MAAOrQ,KAAKmP,mBACZmB,IAAK9V,Q,4CAIU,IAAD,OAClB,OAAO,kBAACuV,EAAA,EAAD,CAAQ7V,UAAY,eACvBvI,MAAOqO,KAAKL,MAAMtF,gBAAgBG,KAClCiH,SAAUzB,KAAKL,MAAM8C,sBACrBuN,kBAAkB,MAClBC,iBAAkB,SAACC,GAAD,OAAO,EAAKvQ,MAAM7C,eAAeoT,GAAKxe,OACxDye,KAAM,EACNE,MAAOrQ,KAAKkP,eACZkB,IAAK,EACLE,IAAKtQ,KAAKL,MAAM7C,eAAe9H,OAAO,M,2CAK1C,OAAO,kBAAC+a,EAAA,EAAD,CAAQ7V,UAAY,eACvBvI,MAAOqO,KAAKL,MAAMtF,gBAAgBG,KAClCiH,SAAUzB,KAAKL,MAAM+C,qBACrBsN,kBAAkB,MAClBK,MAAOrQ,KAAKoP,cACZgB,IAAK,EACLE,IAAK9V,Q,4CAISiB,GAClB,IAAI8U,EAAW,KAAMC,EAAY,KAAMC,EAAU,KAC7CC,EAAW,KAiBf,MAhBY,YAATjV,GACC8U,EAAW,CAAC/V,IACAA,KACZgW,EAAY,CAAChW,IACDA,KACZiW,EAAU,CAACjW,IACCA,KACZkW,EAAW,MAGXH,EAAW,CAAC/V,IACAA,KACZiW,EAAU,CAACjW,IACCA,KACZkW,EAAW,KAER,kBAACC,EAAA,EAAD,KAAa,kBAACC,EAAA,EAAD,KAAW,kBAACC,EAAA,EAAD,KAC1B7Q,KAAK8Q,wBAAwBP,EAASG,EAAS,SAC/CF,EAAUxQ,KAAK8Q,wBAAwBN,EAAUE,EAAS,UAAU,KACpE1Q,KAAK8Q,wBAAwBL,EAAQC,EAAS,a,8CAM/BK,EAASC,EAAkBC,GAAU,IAAD,OACpDC,EAAU,0BAMd,MALgB,UAAbD,EACCC,EAAU,uBACU,SAAbD,IACPC,EAAU,qBAEP,kBAACC,EAAA,EAAD,CAAKjX,UAAWgX,GAClBH,EAASjc,KAAI,SAAC8D,GAAD,OACd,kBAACwY,EAAA,EAAD,CAAKC,GAAIL,EAAkBhQ,IAAG,cAASpI,IAEvC,kBAAC0Y,EAAA,EAAD,CAAkBpX,UAAY,WAC1BtB,QAAS,kBAAC2Y,EAAA,EAAD,CAAU/Q,QAAS,EAAKb,MAAMtF,gBAAgBzB,GAAUoJ,MAAM,UACvEP,SAAU,EAAK9B,MAAM6C,wBAAyB/J,KAAMG,IACpDlH,MAAOkK,IAA2BhD,Y,0CAI1BwM,EAAO1T,EAAO8f,EAAgBC,GAC9C,OAAO,yBAAKvX,UAAU,oBAAoBkL,EAAnC,KAA2C,0BAAMlL,UAAU,aAAhB,IAA6B,0BAAMA,UAAU,YAAY+H,QAASuP,GAArC,UAA7B,KAClD,6BAAK,2BAAI9f,IAAiB+f,K,+BAM1B,OAAOzR,KAAK0R,WAAW1R,KAAKL,MAAMlE,U,GAjKGmH,IAAMC,Y,yWCTtC8O,EAAwB,CACjCnX,IACAA,IACAA,IACAA,IACAA,IACAA,KAESoX,EAA8B,CACvCpX,IACAA,IACAA,IACAA,KAGSqX,GAAmB,mBAC3BrX,IAAsC,eADX,cAE3BA,IAAgC,UAFL,cAG3BA,IAA+B,SAHJ,cAI3BA,IAA+B,SAJJ,cAK3BA,IAAmC,aALR,cAM3BA,IAAwC,kBANb,cAO3BA,IAA+B,SAPJ,GAUzB,SAASgN,EAAWsK,GACvB,OAAOA,EAAI7L,QAAQ,aAAc,IAG9B,IAAM8L,EAAW,CACpB,IAAM,IAAO,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,GAAQ,GAAK,GAAQ,GAAK,GAC5C,GAAK,GAAQ,GAAK,GAAQ,GAAK,GAAQ,GAAK,GAC5C,GAAK,GAAQ,GAAK,GAAQ,GAAK,GAAQ,GAAK,GAC5C,GAAK,GAAQ,GAAK,EAAQ,GAAK,EAAQ,IAAM,EAC7C,IAAM,GAAO,IAAM,GAAO,IAAM,GAAO,IAAM,GAC7C,IAAM,GAAO,IAAM,GAAO,IAAM,GAAO,IAAM,GAC7C,IAAM,GAAO,IAAM,GAAO,IAAM,GAAO,IAAM,GAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,IAAM,IAC7C,IAAM,IAAO,IAAM,IAAO,IAAM,IAAO,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAAQ,GAAK,IAC5C,GAAK,M,4MCrDHC,E,WACF,aAAe,oBACXhS,KAAKiS,MAAM,IAAIC,EACflS,KAAKmS,UAAW,E,uDAETC,EAActE,GACrB9N,KAAKiS,MAAM,IAAIC,EAAME,EAActE,GACnC9N,KAAKmS,UAAW,I,8BAIhBnS,KAAKiS,MAAQ,IAAIC,EACjBlS,KAAKmS,UAAW,I,6BAGbrE,EAAUR,EAAa+E,EAASjU,GAAc,IAAD,OAChD0P,EAASnZ,MAAQqL,KAAKiS,MAAMnE,SAAS9Y,OACrCgL,KAAKiS,MAAMnE,SAASzY,KAAKyY,GACzB9N,KAAKiS,MAAM7T,YAAcA,EACzB4B,KAAKmS,UAAW,EAChB7E,EAAYrY,SAAQ,SAAAqd,GAChB,EAAKC,cAAcD,EAAW9E,UAAW8E,EAAW5E,UAAW4E,EAAW3E,QAASG,MAEvF9N,KAAKwS,mBAAmBH,EAASvE,EAASnZ,OAC1CqL,KAAKyS,eAAe3E,K,yCAGL4E,EAASC,GACxB,IAAIC,EAAW5S,KAAK6S,iBAAiBH,GACjCE,EAASE,cACTF,EAASE,YAAc,IAE3BF,EAASE,YAAYzd,KAAKsd,K,qCAEf7E,GACX,IAAIiF,EAAa/S,KAAK6S,iBAAiBrY,KACnCuY,EAAWC,UACXD,EAAWC,QAwMZ,CAEHC,UAAW,EACXC,UAAW,EACXhV,MAAO,EACPiV,iBAAkB,EAKlBC,WAAW,OAhNX,IAAIC,EAAarT,KAAKsT,sBAAsBP,EAAWC,QAASlF,GAChEiF,EAAWC,QAAUK,I,uCAGRX,GACb,IAAIM,EAAUhT,KAAK6S,iBAAiBzX,YAAcsX,IAAUM,QAC5D,GAAIhU,OAAOC,UAAU+T,GACjBA,EAAUhT,KAAKsT,sBA+LhB,CAEHL,UAAW,EACXC,UAAW,EACXhV,MAAO,EACPiV,iBAAkB,EAKlBC,WAAW,MAzM8CpT,KAAKiS,MAAMnE,SAASkF,SACtE,IAAIA,EACP,MA6LD,CAEHC,UAAW,EACXC,UAAW,EACXhV,MAAO,EACPiV,iBAAkB,EAKlBC,WAAW,MApMX,OADAJ,EAAUhT,KAAKuT,uBAAuBP,K,6CAInBA,GAanB,OAZGhU,OAAOC,UAAU+T,EAAQQ,WACxBR,EAAQS,YAAczT,KAAKiS,MAAMnE,SAASkF,EAAQQ,SAClDR,EAAQU,WAAa1T,KAAK2T,eAAe3T,KAAKiS,MAAM7T,YAAY4U,EAAQS,cAEzEzU,OAAOC,UAAU+T,EAAQY,aACxBZ,EAAQa,cAAgB7T,KAAKiS,MAAMnE,SAASkF,EAAQY,WACpDZ,EAAQc,aAAe9T,KAAK2T,eAAe3T,KAAKiS,MAAM7T,YAAY4U,EAAQa,gBAE3E7U,OAAOC,UAAU+T,EAAQI,cACxBJ,EAAQe,eAAiB/T,KAAKiS,MAAMnE,SAASkF,EAAQI,aAEzDJ,EAAQgB,MAAQhB,EAAQE,UAAUF,EAAQC,UAAUD,EAAQ9U,MACrD8U,I,oCAIGiB,EAAeC,EAAehI,EAAMiI,GAC9C,IAAIpB,EAAa/S,KAAK6S,iBAAiBqB,GACnCb,EAAarT,KAAKsT,sBAAsBP,EAAWC,QAASmB,GAChEpB,EAAWC,QAAUK,EAErB,IAAIT,EAAW5S,KAAK6S,iBAAiBoB,GACrCrB,EAASwB,YAAc7V,KAAK+R,IAAIsC,EAASwB,YAAapU,KAAKqU,sBAAsBtB,EAAWC,UACxFJ,EAAS0B,WACT1B,EAAS0B,SAAW,IAExB1B,EAAS0B,SAASpI,GAAQ,K,4CAGRqI,GAClB,OAAIA,EAGDvV,OAAOC,UAAUsV,GAET,EAEJA,EAAcrW,MAAMqW,EAActB,UAAUsB,EAAcrB,UANtD,I,uCASER,GACb,IAAIrX,EAAMD,YAAcsX,GACpBE,EAAW5S,KAAKiS,MAAMuC,MAAM5N,IAAIvL,GAMpC,OALIuX,KACAA,EAAW,IAAI6B,GACNpZ,IAAMA,EACf2E,KAAKiS,MAAMuC,MAAME,IAAIrZ,EAAKuX,IAEvBA,I,4CAGW+B,EAAoBR,GACtC,GAAGnV,OAAOC,UAAU0V,GAGhBA,EAAqB3U,KAAKsT,sBA+H3B,CAEHL,UAAW,EACXC,UAAW,EACXhV,MAAO,EACPiV,iBAAkB,EAKlBC,WAAW,MAxISpT,KAAKiS,MAAMnE,SAAS6G,SACjC,IAAIA,EAGP,OAAOR,EAAaxf,MAGxB,IAAIigB,EAAW,EAAGC,EAAW,EAAGC,EAAO,EAAGC,EAAY,EAClD3W,EAAc4B,KAAKiS,MAAM7T,YACF,QAAxB+V,EAAahd,QACZyd,EAAW,EACXG,EAAY3W,IAAgB5D,IAA8B,GAAK,GAChC,QAAxB2Z,EAAahd,QACpB0d,EAAW,EACXE,EAAY3W,IAAgB5D,IAA8B,GAAK,GAE/Dsa,EAAO,EAGX,IAAInM,EAAc3I,KAAK2T,eAAevV,EAAa+V,GACnD,GAAiB,IAAdY,EAAiB,CAChB,IAAIC,EAAqB,KACtBhW,OAAOC,UAAU0V,EAAmBnB,WACnCwB,EAAqBhV,KAAKiS,MAAMnE,SAAS6G,EAAmBnB,YAE5DwB,GAAsBC,SAAStM,GAAasM,SAASjV,KAAK2T,eAAevV,EAAa4W,OACtFL,EAAmBnB,QAAUW,EAAaxf,OAGlD,IAAkB,IAAfogB,EAAkB,CACjB,IAAIG,EAAuB,KACxBlW,OAAOC,UAAU0V,EAAmBf,aACnCsB,EAAuBlV,KAAKiS,MAAMnE,SAAS6G,EAAmBf,cAE9DsB,GAAwBD,SAAStM,GAAasM,SAASjV,KAAK2T,eAAevV,EAAa8W,OACxFP,EAAmBf,UAAYO,EAAaxf,OAGpD,IAAIwgB,EAAwB,KAY5B,OAXGnW,OAAOC,UAAU0V,EAAmBvB,cACnC+B,EAAwBnV,KAAKiS,MAAMnE,SAAS6G,EAAmBvB,aAE/D+B,IACA5V,YAAqB4U,EAAa3U,KAAM2V,EAAsB3V,QAC1DmV,EAAmBvB,WAAae,EAAaxf,OAErDggB,EAAmB1B,WAAa4B,EAChCF,EAAmBzB,WAAa0B,EAChCD,EAAmBzW,OAAS4W,EAC5BH,EAAmBxB,kBAAoB8B,SAAStM,GACzCgM,I,qCAGIvW,EAAa+V,GACxB,OAAG/V,IAAgB5D,IACR2Z,EAAa7F,SAEjB6F,EAAa9F,W,wCAGNqE,GAAU,IAAD,OACnBrX,EAAMD,YAAcsX,GAEpBE,EAAW5S,KAAKiS,MAAMuC,MAAM5N,IAAIvL,GACpC,OAAGuX,GAAYA,EAASE,YACbF,EAASE,YAAYhe,KAAI,SAACH,GAAD,OAAS,EAAKsd,MAAMnE,SAASnZ,MAE1D,O,kCAEC+d,GAAU,IAAD,OACbrX,EAAMD,YAAcsX,GAEpBE,EAAW5S,KAAKiS,MAAMuC,MAAM5N,IAAIvL,GACpC,OAAGuX,EACQzd,MAAMmD,KAAKuH,OAAOkB,QAAQ6R,EAAS0B,WAAWxf,KAAI,SAACsgB,GACtD,IAAIjI,EAAQ,IAAIC,IAAMsF,GAClBxG,EAAOiB,EAAMjB,KAAKkJ,EAAM,GAAI,CAAC3H,QAAQ,IACrC4H,EAAoB,EAAKC,iBAAiBnI,EAAM9R,OACpD,MAAO,CACHka,KAAKrJ,EAAK5T,KACVkd,KAAKtJ,EAAKuJ,GACVC,MAAM,EAAKC,SAASN,EAAkBrB,MAAOpB,EAASwB,aACtDxG,IAAI1B,EAAK0B,IACToF,QAAQqC,MAIb,O,+BAGFO,EAAWC,GAChB,OAAGA,GAAY,GAAID,EAAUC,EAAW,GAC7B,EAERD,EAAUC,EAAS,GACX,EAEJ,M,KAMT3D,EACF,WAAYE,EAActE,GAAU,IAAD,2BAC/B9N,KAAKwU,MAAQ,IAAIsB,IACjB9V,KAAK8N,SAAW,GAChB9N,KAAK5B,YAAc,GAChBgU,GACCA,EAAand,SAAQ,SAACmgB,GAClB,EAAKZ,MAAME,IAAIU,EAAM,GAAGA,EAAM,OAGnCtH,IACC9N,KAAK8N,SAAWA,IAKtB2G,E,sCACML,YAAc,GAqBnB,IAAM2B,EAAe,IAAI/D,E,0BC9PXgE,E,iDACjBC,KAAO,CAAC,CAACzN,IAAI,GAAInN,IAAIb,IAAoB0R,KAAK,O,KAC9CgK,aAAe,E,mDACR7a,EAAI6Q,GACP,KAAGlM,KAAKkW,aAAalW,KAAKiW,KAAKjhB,OAAO,GAAKgL,KAAKiW,KAAKjW,KAAKkW,aAAa,GAAGhK,KAAK0B,MAAQ1B,EAAK0B,KAW5F,OAPA5N,KAAKiW,KAAOjW,KAAKiW,KAAKtgB,MAAM,EAAEqK,KAAKkW,aAAa,GAChDlW,KAAKiW,KAAK5gB,KAAK,CACX8gB,UAAUnW,KAAKmW,UAAUjK,EAAK0B,KAC9BvS,IAAKA,EACL6Q,KAAMA,IAEVlM,KAAKkW,eACElW,KAAKiW,KAAKjW,KAAKkW,cAVlBlW,KAAKoW,gB,gCAaHxI,GACN,IACIyI,EADAC,EAAWtW,KAAKuW,eAQpB,GAHIF,EAHCC,EAGM,YAAOA,GAFJ,GAIAtW,KAAKiW,KAAKjhB,OACb,IAAM,EACbqhB,EAAQhhB,KAAK,CACTmhB,WAAWH,EAAQrhB,OAAO,EAC1ByhB,SAAS7I,EACT8I,SAAS,SAEV,CACH,IAAIC,EAAWN,EAAQA,EAAQrhB,OAAO,GACtC2hB,EAASD,SAAW9I,EACpByI,EAAQA,EAAQrhB,OAAO,GAAK2hB,EAEhC,OAAON,I,oCAIP,OAAO9X,KAAKqY,OAAO5W,KAAKkW,aAAa,GAAG,K,qCAIxC,OAAOlW,KAAKiW,KAAKjW,KAAKiW,KAAKjhB,OAAO,GAAGmhB,Y,4BAIrC,OAAOnW,KAAKiW,KAAKjW,KAAKkW,cAAc7a,M,oCAIpC,OAAO2E,KAAK6W,OAAO7W,KAAKkW,aAAa,K,iCAGrC,OAAOlW,KAAK6W,OAAO7W,KAAKkW,aAAa,K,6BAElCvhB,GAIH,OAHGA,GAAO,GAAKA,EAAMqL,KAAKiW,KAAKjhB,SAC3BgL,KAAKkW,aAAevhB,GAEjBqL,KAAKiW,KAAKjW,KAAKkW,kB,iECxDTY,E,YAEjB,WAAYnX,GAAO,IAAD,8BACd,4CAAMA,KACDoX,eAAiB,IAAIf,EAC1B,EAAK1b,MAAQ,CACT0c,YAAY,GAEd5lB,OAAOgS,iBAAiB,UAAU,EAAK6T,WAAW1W,KAAhB,iBANtB,E,wEASP5I,GACP,OAAOA,EAAEuf,SACP,KAAK,GACHlX,KAAKmX,SAASxf,EAAG,YACnB,MACA,KAAK,GACHqI,KAAKoX,KAAKzf,EAAG,e,4CAQCmJ,GAElB,OAAGA,EAASzF,MAAQ2E,KAAK+W,eAAe1b,QACf,OAAlByF,EAASoL,MACRlM,KAAK+W,eAAiB,IAAIf,GACnB,IAEXhW,KAAK+W,eAAeM,OAAOvW,EAASzF,IAAKyF,EAASoL,OAC3C,M,+BAKNvU,EAAG2f,GACR,IAAInX,EAAWH,KAAK+W,eAAeQ,WACnCvX,KAAKL,MAAM8B,SAAStB,EAAS9E,IAAK8E,EAAS+L,MAC3ClM,KAAKE,SAAS,CAAC8W,YAAYhX,KAAK+W,eAAeC,gBAC/CzlB,YAAWiJ,IAAoC,WAAY8c,GAAc,W,2BAGxE3f,EAAG2f,GACJ,IAAInX,EAAWH,KAAK+W,eAAeX,cACnCpW,KAAKL,MAAM8B,SAAStB,EAAS9E,IAAK8E,EAAS+L,MAC3ClM,KAAKE,SAAS,CAAC8W,YAAYhX,KAAK+W,eAAeC,gBAC/CzlB,YAAWiJ,IAAoC,OAAQ8c,GAAc,W,6BAGlE3iB,GAAQ,IAAD,OACV,OAAO,WACH,IAAIwL,EAAW,EAAK4W,eAAeF,OAAa,EAANliB,EAAQ,GAClD,EAAKgL,MAAM8B,SAAStB,EAAS9E,IAAK8E,EAAS+L,MAC3C,EAAKhM,SAAS,CAAC8W,YAAY,EAAKD,eAAeC,gBAC/CzlB,YAAWiJ,IAAoC,OAAQ,KAAM7F,M,+BAI5D,IAAD,OACA6iB,EAAUC,IAAczX,KAAK+W,eAAe1b,OAKhD,OAJImc,IACAxX,KAAKwX,QAAUA,EAAQ/e,KACvBuH,KAAK0X,YAAcF,EAAQG,MAE3B3X,KAAK+W,eAAeR,eAGjB,kBAAC1F,EAAA,EAAD,KACH,kBAACM,EAAA,EAAD,KACA,kBAACC,EAAA,EAAD,CAAKwG,GAAG,IAAI1d,UAAU,cAAa,kBAAC2d,EAAA,EAAD,CAAQ7V,MAAM,GAAG9H,UAAW,gBAAgB+H,QAAUjC,KAAKmX,SAAS5W,KAAKP,OAAO,kBAAC,IAAD,CAAiBmC,KAAM2V,MAAvG,SAAnC,KACA,kBAAC1G,EAAA,EAAD,CAAKwG,GAAG,IAAI1d,UAAU,cAAa,kBAAC2d,EAAA,EAAD,CAAQ7V,MAAM,GAAG9H,UAAW,gBAAgB+H,QAAWjC,KAAKoX,KAAK7W,KAAKP,OAAtE,QAAkF,kBAAC,IAAD,CAAiBmC,KAAM4V,SAC5I,kBAAC5G,EAAA,EAAD,CAAKjX,UAAU,YAAY8F,KAAK0X,YAAhC,KAA+C1X,KAAKwX,SAEhDxX,KAAK+W,eAAeR,eAAezhB,KAAI,SAACoX,EAAMvX,GAAP,OACnC,kBAACwc,EAAA,EAAD,CAAKnQ,IAAG,UAAKkL,EAAKsK,YAAcvU,QAAS,EAAK4U,OAAOliB,GAAO4L,KAAK,GAAOrG,UAAS,iBAAY,EAAK6c,eAAeC,gBAAkBriB,EAAO,eAAe,KACrJ,kBAACyc,EAAA,EAAD,CAAKC,GAAG,KAAKnX,UAAY,kBAAzB,UAA8CgS,EAAKsK,WAAnD,aAAkEtK,EAAKuK,SAAvE,YAAmFvK,EAAKwK,gBAV7F,kC,GApEoB9T,IAAMC,W,0KCgG9BmV,EA/EM,SAACrY,GAAW,IAAD,EACFsY,oBAAS,GADP,mBACvB3V,EADuB,KACf4V,EADe,OAEJD,oBAAS,GAFL,mBAEvBE,EAFuB,KAEhBC,EAFgB,KAKxBC,EAAc,kBAAMD,GAAUD,IAE9BG,EAAS,SAACnS,GACd,OAAO,WACL/U,OAAOmnB,KAAKpS,EAAK,YAGrB,OACE,6BACE,kBAACqS,EAAA,EAAD,CAAQxW,MAAM,QAAQyW,OAAK,EAACC,OAAO,MACjC,yBAAKve,IAAI,yBAAyBC,OAAO,OAAOue,MAAM,OAAO1e,IAAI,SACjE,kBAAC2e,EAAA,EAAD,CAAaC,KAAK,KAAlB,uBACA,kBAACC,EAAA,EAAD,CAAe7W,QAbN,kBAAMiW,GAAW5V,MAc1B,kBAACkN,EAAA,EAAD,CAAUlN,OAAQA,EAAQyW,QAAM,GAC9B,kBAACC,EAAA,EAAD,CAAK9e,UAAU,UAAU6e,QAAM,GAC/B,kBAACE,EAAA,EAAD,KAAS,kBAACC,EAAA,EAAD,CAAShf,UAAU,gBAAgB+H,QAASqW,EAAO,gDAAnD,uCAAsI,0BAAMpe,UAAU,aAAhB,oBAE/I,kBAAC8e,EAAA,EAAD,CAAK9e,UAAU,UAAU6e,QAAM,GAC/B,kBAACE,EAAA,EAAD,KAAS,kBAACC,EAAA,EAAD,CAAShf,UAAU,gBAAgB+H,QAASqW,EAAO9d,MAAiC,kBAAC,IAAD,CAAiB2H,KAAMgX,IAAWjf,UAAU,gBAAhI,uBAET,kBAAC8e,EAAA,EAAD,CAAK9e,UAAU,GAAG6e,QAAM,GACxB,kBAACE,EAAA,EAAD,KAAS,kBAACC,EAAA,EAAD,CAAShf,UAAU,gBAAgB+H,QAAStC,EAAMyZ,gBAAgB,kBAAC,IAAD,CAAiBjX,KAAMkX,IAAYnf,UAAU,iBAA/G,oBAET,kBAACof,EAAA,EAAD,KACI,kBAACC,EAAA,EAAD,CAAgBrf,UAAU,eAAesf,KAAG,GAC5C,kBAAC,IAAD,CAAiBrX,KAAME,IAAanI,UAAU,aAD9C,QAGA,kBAACuf,EAAA,EAAD,CAAcC,OAAK,GACjB,kBAACC,EAAA,EAAD,CAAc1X,QAASoW,GAAvB,oBAGA,kBAACsB,EAAA,EAAD,CAAc1X,QAASqW,EAAO,oCAA9B,eAGA,kBAACqB,EAAA,EAAD,CAAcC,SAAO,IACrB,kBAACD,EAAA,EAAD,CAAc1X,QAASqW,EAAO,yBAA9B,WAGA,kBAACqB,EAAA,EAAD,CAAc1X,QAASqW,EAAO,iCAA9B,eAGA,kBAACqB,EAAA,EAAD,CAAc1X,QAASqW,EAAO,0BAA9B,iBAQV,kBAACuB,EAAA,EAAD,CAAOvX,OAAQ6V,EAAO2B,OAAQzB,GAC5B,kBAAC0B,EAAA,EAAD,CAAaD,OAAQzB,GAArB,oBACA,kBAAC2B,EAAA,EAAD,CAAW9f,UAAU,mBACrB,kBAAC+f,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,0BAA0B3hB,OAAO,SAASzF,QAAM,GAA5E,eACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,2DAA2D3hB,OAAO,SAASzF,QAAM,GAA7G,iBACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,+CAA+C3hB,OAAO,SAASzF,QAAM,GAAjG,eACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,qCAAqC3hB,OAAO,SAASzF,QAAM,GAAvF,YACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,iCAAiC3hB,OAAO,SAASzF,QAAM,GAAnF,OACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,iDAAiD3hB,OAAO,SAASzF,QAAM,GAAnG,kBACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,2CAA2C3hB,OAAO,SAASzF,QAAM,GAA7F,wBACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,4BAA4B3hB,OAAO,SAASzF,QAAM,GAA9E,iBACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,iCAAiC3hB,OAAO,SAASzF,QAAM,GAAnF,oBACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,4CAA4C3hB,OAAO,SAASzF,QAAM,GAA9F,cACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,qDAAqD3hB,OAAO,SAASzF,QAAM,GAAvG,YACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,4BAA4B3hB,OAAO,SAASzF,QAAM,GAA9E,cACA,kBAACwoB,EAAA,EAAD,CAAeC,IAAI,IAAIrB,KAAK,gCAAgC3hB,OAAO,SAASzF,QAAM,GAAlF,kBAEA,kBAAC0oB,EAAA,EAAD,KACE,kBAACtC,EAAA,EAAD,CAAQ7V,MAAM,YAAYC,QAASoW,GAAnC,Y,2MClFW+B,G,wLACDC,EAAQC,GACpB,OAAID,IAAW7f,IACJ,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,yBAAKrgB,IAAI,UAAUC,UAAU,YAAYC,IAAI,sBAAsB,0BAAMD,UAAU,cAAhB,kBAC1HmgB,IAAW7f,IACX,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,yBAAKrgB,IAAI,YAAYC,UAAU,YAAYC,IAAI,wBACtGkgB,IAAW7f,IACX,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,kBAAC,KAAD,CAAQpgB,UAAU,eAAc,0BAAMA,UAAU,cAAhB,qBACvFmgB,IAAW7f,IACX,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,kBAAC,KAAD,CAAWpgB,UAAU,eAAc,0BAAMA,UAAU,cAAhB,0BAC1FmgB,IAAW7f,IACX,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,kBAAC,KAAD,CAAQpgB,UAAU,eAAc,0BAAMA,UAAU,cAAhB,2BACtFmgB,IAAW7f,IACZ,8BAAO8f,EAAUvgB,aAAc,OAAQugB,GAAW,KAAK,kBAAC,KAAD,CAAMpgB,UAAU,eAAc,0BAAMA,UAAU,cAAhB,qBAA+C,kBAACqgB,GAAA,EAAD,CAAOrgB,UAAU,aAAa8H,MAAM,aAApC,SAExI,8BAAOjI,aAAc,EAAGugB,GAAxB,qB,+BAIP,OAAO,kBAAC,KAAD,CAAgBjZ,oBAAqBmO,KACxCjO,gBAAiB,CAACC,QAAQhH,KAC1BX,SAAuC,WAA7BmG,KAAKL,MAAMyB,cACrBK,SAAUzB,KAAKL,MAAM+B,uBACrB,kBAAC8Y,GAAA,EAAD,CACI5Y,WAAY,kBAAC,KAAD,MACZ6Y,gBAAc,kBACdC,GAAG,kBAEH,6BACK1a,KAAK2a,gBAAgB3a,KAAKL,MAAMlE,MAAM,KAG/C,kBAACmf,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAYpZ,SAAUzB,KAAKL,MAAMmb,WAAYnpB,MAAOqO,KAAKL,MAAMlE,MAC3D,kBAAC6V,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAAwB5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,OACvI,kBAAC8W,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAA8B5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,OAC7I,kBAAC8W,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAAkC5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,OACjJ,kBAACwgB,GAAA,EAAD,CAAS9gB,UAAU,kBACnB,kBAACoX,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAA0B5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,OACzI,kBAAC8W,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAAyB5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,OACxI,kBAAC8W,GAAA,EAAD,CAAkBpX,UAAU,YAAYvI,MAAO6I,IAAyB5B,QAAS,kBAACmiB,GAAA,EAAD,CAAO/Y,MAAM,YAActQ,MAAOsO,KAAK2a,gBAAgBngB,c,GAxCxHoI,IAAMC,W,wCCXrBoY,G,yLACAC,GACf3pB,YAAWiJ,IAAqC,YAAa0gB,EAASlmB,OAAO,EAAEkmB,EAAS,GAAGziB,KAAK,MAChGuH,KAAKL,MAAMwb,YAAYD,K,+BAGvB,OACE,kBAAC,KAAD,CACAE,cAAe,GACfC,aAAcrb,KAAKL,MAAM0b,aACvB5Z,SAAUzB,KAAKsb,iBAAiB/a,KAAKP,MACrCub,uBAAuB,eACvBC,eAAe,EACfC,oBAAoB,EACpBC,iBAAkB,CAACxhB,UAAU,eAC7ByhB,cAAc,WACdC,WAAY5b,KAAKL,MAAMic,WACvBC,YAAa,W,GAjBejZ,IAAMC,W,+BCCvBiZ,G,2MAEjBC,cAAgB,SAACpqB,GACbJ,YAAWiJ,IAAqC,sBAAuB7I,EAAMA,OAC7E,EAAKgO,MAAM8B,SAAS9P,I,6EAGVqqB,GACV,OAAQ,6BACA,8BAAM,kBAAC,iBAAD,CAAe/hB,IAAK+hB,EAAOvjB,KAAMyB,UAAU,iBAAiBye,MAAM,KAAKve,OAAO,KAAKD,IAAK6hB,EAAOC,QAAQC,YAC7G,6BAAMF,EAAOvjB,MACb,yBAAKyB,UAAU,aAAa8hB,EAAOC,QAAQE,Y,+BAInD,IAAInc,KAAKL,MAAMyc,KACX,OAAO,yBAAKliB,UAAU,yBAAwB,yBAAKD,IAAI,UAAU0e,MAAM,KAAKve,OAAO,KAAKD,IAAI,kBAArF,iBACJ,IAAI6F,KAAKL,MAAMyc,KAAKpnB,OACvB,OAAO,yBAAKkF,UAAU,yBAAf,yBAEX,IAAImiB,EAAUrc,KAAKL,MAAMyc,KAAKtnB,KAAI,SAAAknB,GAAS,OAAO,gBAAIA,EAAX,CAAmBrqB,MAAMqqB,EAAOvjB,UAC3E,OAAO,kBAAC,KAAD,CACHA,KAAK,cACL9G,MAAOqO,KAAKL,MAAM2c,eAAe3qB,MACjC0qB,QAASA,EACTE,YAAavc,KAAKL,MAAM4c,YACxBC,aAAcxc,KAAKyc,cACnBhb,SAAUzB,KAAK+b,oB,GA3BoBnZ,IAAMC,W,wCCWhCnD,G,YACjB,WAAYC,GAAQ,IAAD,8BACf,4CAAMA,KACDrF,MAAQ,CACT4G,WAAW,GACXqC,MAAM,GACN8H,eAAe,GACfqR,cAAc,IANH,E,4EAUJ9qB,GACXoO,KAAKE,SAAS,CACVgB,WAAYtP,EAAMsF,OAAOvF,MACzBgrB,gBAAgB,O,kCAIZpZ,GACRvD,KAAKE,SAAS,CAACqD,MAAMA,M,0CAGLqZ,GAChB5c,KAAKE,SAAS,CACVmL,eAAeuR,M,yCAEJhrB,GACfoO,KAAKE,SAAS,CACVwc,cAAc9qB,M,kDAIlBoO,KAAKE,SAAS,CAACyc,gBAAgB,O,gDAI/B,GAAG3c,KAAKL,MAAMlE,OAASjB,KACnB,IAAIwF,KAAK1F,MAAMoiB,cAEX,OADA1c,KAAKL,MAAM+D,UAAU,2BACd,OAER,GAAG1D,KAAKL,MAAMlE,OAASjB,KAC1B,IAAIwF,KAAK1F,MAAM+Q,eAEX,OADArL,KAAKL,MAAM+D,UAAU,2BACd,OAER,GAAG1D,KAAKL,MAAMlE,OAASjB,KAC1BwF,KAAKL,MAAMlE,OAASjB,KAChB,IAAIwF,KAAK1F,MAAM4G,WAIX,OAHAlB,KAAKE,SAAS,CACVyc,gBAAgB,6BAEb,OAEZ,GAAG3c,KAAKL,MAAMlE,OAASjB,KAC1B,GAA+B,IAA5BwF,KAAK1F,MAAMiJ,MAAMvO,OAEhB,OADAgL,KAAKL,MAAM+D,UAAU,6BACd,OAER,GAAG1D,KAAKL,MAAMlE,OAASjB,KACK,IAA5BwF,KAAK1F,MAAMiJ,MAAMvO,OAEhB,OADAgL,KAAKL,MAAM+D,UAAU,sCACd,EAGf,OAAO,I,sCAEK2W,EAAQnZ,EAAYC,GAChC,OAAGkZ,IAAW7f,IACH2G,EAAsB1I,KAE9B4hB,IAAW7f,IACH,GAEJ0G,I,yCAGHlB,KAAK6c,2BACL7c,KAAKL,MAAMmd,oBACP9c,KAAK+c,gBACD/c,KAAKL,MAAMlE,KACXuE,KAAK1F,MAAM4G,WACXlB,KAAK1F,MAAM+Q,gBACfrL,KAAK1F,MAAMiJ,MACXvD,KAAK1F,MAAMoiB,cACX1c,KAAK1F,MAAM+Q,kB,mCAKnB,GAAGrL,KAAKL,MAAMlE,OAASjB,KACnB,GAAGwF,KAAKL,MAAM0L,gBAAkBrL,KAAKL,MAAM0L,eAAe5S,KACtD,OAAO,8BACEsB,aAAc,QACdiG,KAAKL,MAAM0L,eAAe4Q,QAAQ7W,MAAO,OAC1C,2BAAIpF,KAAKL,MAAM0L,eAAe5S,YAGvC,GAAGuH,KAAKL,MAAMlE,OAASjB,KAC1BwF,KAAKL,MAAMlE,OAASjB,KACpB,GAAGwF,KAAKL,MAAMuB,WACV,OAAO,8BAAOnH,aAAc,QAArB,SAAmC,2BAAIiG,KAAKL,MAAMuB,kBAE1D,GAAGlB,KAAKL,MAAMlE,OAASjB,KAC1BwF,KAAKL,MAAMlE,OAASjB,IAAiC,CACrD,GAA6B,IAA1BwF,KAAKL,MAAM4D,MAAMvO,OAChB,OAAO,8BAAO+E,aAAc,QAArB,SAAmC,2BAAIiG,KAAKL,MAAM4D,MAAM,GAAG9K,OAEtE,GAAGuH,KAAKL,MAAM4D,MAAMvO,OAAO,EACvB,OAAO,8BAAO+E,aAAc,QAASiG,KAAKL,MAAM4D,MAAMvO,OAA/C,4BAER,GAAGgL,KAAKL,MAAMlE,OAASjB,KACvBwF,KAAKL,MAAM+c,eAAiB1c,KAAKL,MAAM+c,cAAcjkB,KACpD,OAAO,8BAAOsB,aAAc,QAASiG,KAAKL,MAAM+c,cAAcjkB,MAGtE,OAAO,8BAAOsB,aAAc,GAArB,oB,yCAGQrI,EAAOsrB,GACtB,OAAO,kBAACC,GAAA,EAAD,CACH/iB,UAAU,kBAAkBzB,KAAK,aAAaiiB,GAAG,oBACjD9gB,OAAO,QAAQ6H,SAAUzB,KAAKkd,eAAe3c,KAAKP,MAClDtO,MAAOA,EAAOkT,QAAQ,WAAWjT,MAAOqO,KAAK1F,MAAM4G,WACnD8b,WAAYhd,KAAK1F,MAAMqiB,gBAAiB3c,KAAK1F,MAAMqiB,gBAAgBK,EACnE1mB,QAAO0J,KAAK1F,MAAMqiB,gBAA4BQ,QAASnd,KAAKod,gBAAgB7c,KAAKP,U,sCAGzE/I,GACO,KAAhBA,EAAIigB,SACHlX,KAAKqd,qB,2CAIT,OAAO,kBAAC,GAAD,CACHjB,KAAMpc,KAAKL,MAAM2d,eACjBf,YAAY,kBACZ9a,SAAUzB,KAAKud,oBAAoBhd,KAAKP,MACxCsc,eAAgBtc,KAAK1F,MAAM+Q,mB,gDAG/B,OAAO,kBAAC,GAAD,CACH+Q,KAAMpc,KAAKL,MAAM6d,cACjBjB,YAAY,kBACZ9a,SAAUzB,KAAKyd,mBAAmBld,KAAKP,MACvCsc,eAAgBtc,KAAK1F,MAAMoiB,kB,4CAI/B,OAAO,6BAAK,kBAAC,GAAD,CAAUvB,YAAanb,KAAKmb,YAAY5a,KAAKP,MAAO4b,WAAY,GAC5EP,aAAa,wEAEJrb,KAAK0d,mBAAmB,qBAAsB,oC,gDAKvD,OAAO,6BACH,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAU1jB,UAAU,iBACpB,kBAAC2jB,GAAA,EAAD,CAAW3jB,UAAU,qBAAoB,kBAAC,IAAD,CAAiBiI,KAAM2b,IAAc5jB,UAAU,eAAxF,iBACA,kBAAC6jB,GAAA,EAAD,CAAU7jB,UAAU,aAApB,0DAC2D,oCAD3D,qDACyH,iDADzH,uCAEsC,oCAFtC,kCAKO,6BACX,kBAAC,GAAD,CAAUihB,YAAanb,KAAKmb,YAAY5a,KAAKP,MAAO4b,WAAY,EACxDP,aAAa,+E,wCAMzB,OAAGrb,KAAKL,MAAMlE,OAASjB,IACZwF,KAAKge,sBACLhe,KAAKL,MAAMlE,OAASjB,IACpBwF,KAAK0d,mBAAmB,oBACxB1d,KAAKL,MAAMlE,OAASjB,IACpBwF,KAAK0d,mBAAmB,sBACxB1d,KAAKL,MAAMlE,OAASjB,IACpBwF,KAAKie,0BACLje,KAAKL,MAAMlE,OAASjB,IACpBwF,KAAKke,qBACNle,KAAKL,MAAMlE,OAASjB,IACnBwF,KAAKme,0BAET,gC,+BAIP,OAAO,kBAAC,KAAD,CAAgBtkB,SAAuC,SAA7BmG,KAAKL,MAAMyB,cACpCC,oBAAqBmO,KACrBjO,gBAAiB,CAACC,QAAQhH,KAC1BiH,SAAUzB,KAAKL,MAAM+B,sBACrBC,SAA4B,KAAlB3B,KAAKL,MAAMlE,MACrB,kBAAC+e,GAAA,EAAD,CAAuB5Y,WAAY,kBAAC,KAAD,OAAqB5B,KAAK6B,cAC7D,kBAAC+Y,GAAA,EAAD,KACS5a,KAAKoe,mBAEd,kBAACpD,GAAA,EAAD,MACA,kBAACqD,GAAA,EAAD,KACI,kBAAC,KAAD,CAAkBlmB,KAAK,QAAQ6J,MAAM,UAAUC,QAASjC,KAAKqd,iBAAiB9c,KAAKP,OAAnF,kB,GA1Mc4C,IAAMC,W,kDCLnByb,G,YAEjB,WAAY3e,GAAQ,IAAD,8BACf,4CAAMA,KACDrF,MAAQ,CACT4G,WAAY,GACZzF,KAAM,GACN2C,YAAa,EAAKuB,MAAM4e,SAASngB,YACjCwB,uBAAuB,EACvBsD,uBAAuB,EACvB9B,cAAe,SACfkc,eAAe,KACfE,cAAc,KACdja,MAAM,GACNa,qBAAqB,GACrBjD,sBAAsB,IAG1B,EAAKrE,eAAiBd,cACtB,EAAK1B,MAAME,KAA4C,CAAC,EAAG,EAAKsC,eAAe9H,OAAS,GACxF,EAAKsF,MAAME,KAAwCA,IACnD,EAAKF,MAAME,MAAuC,EAClD,EAAKF,MAAME,MAAiC,EAC5C,EAAKF,MAAME,MAAgC,EAC3C,EAAKF,MAAME,MAAgC,EAC3C,EAAKF,MAAME,MAAoC,EAC/C,EAAKF,MAAME,MAAyC,EACpD,EAAKF,MAAME,MAAgC,EAC3C,EAAKF,MAAME,KAA+B,MAC1C,EAAKF,MAAME,KAAmC,CAAC,EAAGA,KA3BnC,E,+EAgCf,OAAOD,YAA8ByF,KAAK1F,MACtC,CAACE,IAAqCA,IACtCA,IAA8BA,IAC9BA,IAAuCA,IACvCA,IAAkCA,IAClCA,IAA0CA,IAC1CA,Q,4CAIcgkB,GAAQ,IAAD,OACzB,OAAO,SAAC5sB,EAAO6sB,GACX,EAAKve,SAAS,CAAEkB,gBAAeqd,GAAcD,O,gDAKjD,MAAO,CACH9pB,OAAO,CACH0C,QAAQ,EACRsnB,UAAUngB,KAAKqY,MAAMva,KAAKsiB,MAAQ,KAClCpa,eAAevE,KAAKL,MAAM4E,eAC1Bga,SAASve,KAAKL,MAAM4e,SACpBrd,WAAWlB,KAAK1F,MAAMskB,WACtBnjB,KAAMuE,KAAK1F,MAAMmB,KACjBpB,gBAAgB2F,KAAK3F,mBAEzBxF,OAAQ,CAAC,YAAImL,KAAKL,MAAMoW,aAAa9D,MAAMuC,MAAMzT,WAAzC,YACQf,KAAKL,MAAMoW,aAAa9D,MAAMnE,c,8CAI9B+Q,GACpB,IAAIC,EAAc,EAIlB,OAHGD,EAAgBnqB,OAAO0C,UACtB0nB,EAAcD,EAAgBnqB,OAAO0C,SAEtC0nB,EAActkB,KACbwF,KAAKL,MAAM+D,UAAU,6CAA8C,KAC/D,qDAAsDlJ,MACnD,IAEXwF,KAAKE,SAAL,gBACO2e,EAAgBnqB,OAAO2F,gBAD9B,CAEI+D,YAAYygB,EAAgBnqB,OAAO6pB,SAASngB,YAC5C3C,KAAKojB,EAAgBnqB,OAAO+G,KAC5ByF,WAAW2d,EAAgBnqB,OAAO6pB,SAASrd,cAE/C6U,EAAagJ,WAAWF,EAAgBhqB,OAAO,GAAIgqB,EAAgBhqB,OAAO,IAC1EmL,KAAKL,MAAMqf,eAAe,CACtBT,SAASM,EAAgBnqB,OAAO6pB,SAChCha,eAAesa,EAAgBnqB,OAAO6P,eACtCwR,aAAaA,KAEV,K,0CAGS7U,EAAYqC,EAAOa,EAAsBjD,GACzDnB,KAAKE,SAAS,CACVgB,WAAYA,EACZE,cAAchB,KAAgCJ,KAAK1F,MAAMmB,KAAMyF,EAAYC,GAAuB,UAAU,GAC5GoC,MAAMA,EACNa,qBAAqBA,EACrBjD,sBAAsBA,EACtB/C,YAAY,KAEhB7M,YAAWiJ,IAAqC,qB,qCAErC2L,EAAK7R,GAAU,IAAD,OACzBqS,KAAQC,IAAIT,GAAK,SAAC7P,EAAOyQ,GACrB,GAAGzQ,EAGC,OAFA,EAAKqJ,MAAM+D,UAAU,8DACrBpP,EAAS,IAGb,IAAI2qB,EACJ,IACIA,EAAe7oB,KAAKsB,MAAMqP,EAASM,MAAM+U,KAC3C,MAAOzkB,GACLH,QAAQC,IAAIE,GAEZsnB,EAIA3qB,EAAS2qB,IAHT,EAAKtf,MAAM+D,UAAU,yBACrBpP,EAAS,U,iCAOV1C,GAAQ,IAAD,OACVstB,EAAUttB,EAAMsF,OAAOvF,MACxButB,IAAY1kB,KAA6BwF,KAAK1F,MAAMgjB,gBACnDtd,KAAKmf,eAAe,yCAAyC,SAACF,GAC1D,EAAK/e,SAAS,CAACod,eAAe2B,OAGnCC,IAAY1kB,KAA4BwF,KAAK1F,MAAMkjB,eAClDxd,KAAKmf,eAAe,0CAA0C,SAACF,GAC3D,EAAK/e,SAAS,CAACsd,cAAcyB,OAGrCjf,KAAKE,SAAS,CAAEzE,KAAMyjB,EAAS9d,cAAc,SAC7C7P,YAAWiJ,IAAqC,aAAc0kB,K,oCAGpDE,GACVpf,KAAKE,SAAL,gBAAkBkf,EAAlB,CAA2Bhe,cAAc,MACzC7P,YAAWiJ,IAAqC,eAAgBwF,KAAK1F,MAAMmB,Q,+BAI3E,OAAO,6BAAK,yBAAKvB,UAAU,oBACvB,kBAAC,GAAD,CAAQkH,cAAepB,KAAK1F,MAAM8G,cAC9BM,sBAAuB1B,KAAK0B,sBAAsB,UAAUnB,KAAKP,MACjEvE,KAAMuE,KAAK1F,MAAMmB,KAAMqf,WAAY9a,KAAK8a,WAAWva,KAAKP,QAC5D,kBAAC,GAAD,CAAMoB,cAAepB,KAAK1F,MAAM8G,cAAeF,WAAYlB,KAAK1F,MAAM4G,WAClEQ,sBAAuB1B,KAAK0B,sBAAsB,QAAQnB,KAAKP,MAC/D0D,UAAW1D,KAAKL,MAAM+D,UAAWH,MAAOvD,KAAK1F,MAAMiJ,MAAO+Z,eAAgBtd,KAAK1F,MAAMgjB,eACrFE,cAAexd,KAAK1F,MAAMkjB,cAAe/hB,KAAMuE,KAAK1F,MAAMmB,KAAMqhB,oBAAqB9c,KAAK8c,oBAAoBvc,KAAKP,MACnHyL,OAAQzL,KAAK1F,MAAMmR,OAAQJ,eAAgBrL,KAAK1F,MAAM6G,sBAAuBub,cAAe1c,KAAK1F,MAAM8J,uBAC3G,kBAACib,GAAA,EAAD,CAASje,cAAepB,KAAK1F,MAAM8G,cAAehD,YAAa4B,KAAK1F,MAAM8D,YACtEsD,sBAAuB1B,KAAK0B,sBAAsB,WAAWnB,KAAKP,MAClEvE,KAAMuE,KAAK1F,MAAMmB,KAAMyF,WAAYlB,KAAK1F,MAAM4G,WAAY7G,gBAAiB2F,KAAK3F,kBAChFyC,eAAgBkD,KAAKlD,eAAgB6D,cAAeX,KAAKW,cAAcJ,KAAKP,MAC5EmB,sBAAuBnB,KAAK1F,MAAM6G,yBAEtC,kBAAC2B,GAAA,EAAD,CAAS1B,cAAepB,KAAK1F,MAAM8G,cAAehD,YAAa4B,KAAK1F,MAAM8D,YAAamF,MAAOvD,KAAK1F,MAAMiJ,MACrGrC,WAAYlB,KAAK1F,MAAM4G,WAAYzF,KAAMuE,KAAK1F,MAAMmB,KAAMpB,gBAAiB2F,KAAK3F,kBAChFgK,OAAQrE,KAAKL,MAAM0E,OAAQX,UAAW1D,KAAKL,MAAM+D,UAAWjC,SAAUzB,KAAKL,MAAM8B,SACjFiD,eAAgB1E,KAAKL,MAAM+E,eAAgBF,MAAOxE,KAAKL,MAAM6E,MAAOQ,cAAehF,KAAKL,MAAMqF,cAC9FO,iBAAkBvF,KAAKL,MAAM4F,iBAAkBhB,eAAgBvE,KAAKL,MAAM4E,eAC1EpD,sBAAuBnB,KAAK1F,MAAM6G,sBAAuBiD,qBAAsBpE,KAAK1F,MAAM8J,qBAC1FL,wBAAyB/D,KAAK+D,wBAAwBxD,KAAKP,MAAO6D,SAAU7D,KAAKL,MAAMkE,SACvFD,wBAAyB5D,KAAK4D,wBAAwBrD,KAAKP,a,GAxKpC4C,IAAMC,WCJxByc,G,+KACVC,GAAW,IAAD,OACb,OAAQ,WACJ,IAAI9e,EAAW,EAAKd,MAAM4e,SAASgB,KAAe/kB,IAA+BA,IAA6BA,IAC9G,EAAKmF,MAAM8B,SAAS8d,EAAW9e,GAC/BlP,YAAWiJ,IAAmC,wB,gCAIlDpJ,OAAOmnB,KAAP,oDAAyDvY,KAAKL,MAAMtE,KAAO,UAC3E9J,YAAWiJ,IAAmC,iB,oCAI9CwF,KAAKL,MAAM6f,QACXjuB,YAAWiJ,IAAmC,W,oCAG9CwF,KAAKL,MAAM6E,QACXjT,YAAWiJ,IAAmC,W,+BAI9C,OAAO,6BACH,kBAACqW,EAAA,EAAD,KACI,kBAACM,EAAA,EAAD,CAAKE,GAAG,MACJ,kBAACD,EAAA,EAAD,CAAKC,GAAG,KACJ,kBAACwG,EAAA,EAAD,CAAQ3d,UAAU,gBAAgB+H,QAAWjC,KAAK8Z,OAAO,eAAgB9X,MAAM,IAAG,4BAAI,kBAAC,IAAD,CAAiBG,KAAMsd,OAA7G,gBAEJ,kBAACrO,EAAA,EAAD,CAAKC,GAAG,KACJ,kBAACwG,EAAA,EAAD,CAAQ3d,UAAU,gBAAgB+H,QAAWjC,KAAK0f,YAAYnf,KAAKP,MAAOgC,MAAM,IAAG,4BAAI,kBAAC,IAAD,CAAiBG,KAAMwd,OAA9G,iBAEJ,kBAACvO,EAAA,EAAD,CAAKC,GAAG,KACJ,kBAACwG,EAAA,EAAD,CAAQ3d,UAAU,gBAAgB+H,QAAWjC,KAAK4f,YAAYrf,KAAKP,MAAOgC,MAAM,IAAG,4BAAI,kBAAC,IAAD,CAAiBG,KAAM0d,OAA9G,uBAEJ,kBAACzO,EAAA,EAAD,CAAKC,GAAG,KACJ,kBAACwG,EAAA,EAAD,CAAQ3d,UAAU,gBAAgB+H,QAAWjC,KAAK8f,QAAQvf,KAAKP,MAAOgC,MAAM,IAAG,4BAAI,kBAAC,IAAD,CAAiBG,KAAM4d,OAA1G,8B,GApCkBnd,IAAMC,W,uHCD3Bmd,G,kLACProB,GACNA,EAAEsoB,oB,gCAIFxlB,aAAS,YAETuF,KAAKL,MAAMkE,SAAS,gB,oCAIpB,OAAO7D,KAAKL,MAAMugB,eAAe,KAC7B,yBAAKhmB,UAAU,UACf,kBAAC+iB,GAAA,EAAD,CACIvC,GAAG,WACHyF,WAAS,EACTzuB,MAAM,MACN0uB,QAAQ,IACRzuB,MAAOqO,KAAKL,MAAMtE,IAClBglB,WAAY,CACRC,MAAO,CAACC,SAAU,IAClBC,YAAY,GAEd5b,QAAQ,WACV1K,UAAU,WACVN,OAAO,QACPqI,QAAWjC,KAAKygB,QAAQlgB,KAAKP,W,+BAK/B,IAAD,OACL,IAAIA,KAAKL,MAAM+gB,YAAY3M,eACvB,OAAO,6BAAM/T,KAAK2gB,cAAc,yBAAKzmB,UAAY,eAAjB,wEAC5B,0BAAMA,UAAY,gBAAgB+H,QAAS,kBAAI,EAAKtC,MAAMihB,oBAA1D,IAA8E,kBAAC,IAAD,CAAiBze,KAAM0e,MAArG,SAD4B,0BAIpC,IAAIC,EAAqB,GASzB,OARG9gB,KAAKL,MAAM2C,SACVwe,EAAqB/iB,YAAsBiC,KAAKL,MAAM+gB,YAAYvN,iBACtBnT,KAAKL,MAAM+gB,YAAYxN,UACvBlT,KAAKL,MAAM+gB,YAAYxiB,MACvB8B,KAAKL,MAAM+gB,YAAYzN,UACvBjT,KAAKL,MAAM4e,SAASngB,cAG7D,6BACF4B,KAAK2gB,cACN,kBAACI,GAAA,EAAD,CAAO9e,QAASjC,KAAKghB,WACpBC,MAAMH,EAAmB/hB,mBAAmB,KAAiB,kBAACmiB,GAAA,EAAD,CAAWhnB,UAAS,8BAAyB8F,KAAKL,MAAMugB,eAAe,qBAAqB,KAAM,kBAACiB,GAAA,EAAD,KAC5J,kBAACC,GAAA,EAAD,CAAWlnB,UAAU,wBAAuB,2CAC5C,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAuB,2BAAI4mB,EAAmB/hB,sBAEvE,kBAACsiB,GAAA,EAAD,KACA,kBAACF,GAAA,EAAD,CAAUjnB,UAAU,wBAChB,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,WACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB4mB,EAAmBhiB,UAEnEmiB,MAAMH,EAAmBxiB,YAAY,KACtC,kBAAC6iB,GAAA,EAAD,CAAUjnB,UAAU,wBAChB,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,gBACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB4mB,EAAmBxiB,aAEpE,kBAAC6iB,GAAA,EAAD,CAAUjnB,UAAU,wBAChB,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,SACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB4mB,EAAmBniB,QAEnEqB,KAAKL,MAAMugB,gBAAkBe,MAAMH,EAAmBxiB,YAAY,KACnE,kBAAC6iB,GAAA,EAAD,CAAUjnB,UAAU,wBAChB,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,iBACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB4mB,EAAmBjiB,gBAGlEmB,KAAKL,MAAMugB,gBAAkBlgB,KAAKL,MAAM+gB,YAAYhN,WAAW,kBAACyN,GAAA,EAAD,CAAUjnB,UAAU,wBACjF,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,YACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB8F,KAAKL,MAAM+gB,YAAYhN,WAApE,IAAgF,kBAAC,IAAD,CAAiBxZ,UAAU,sBAAsB+H,QAAUjC,KAAKL,MAAM2hB,WAAWthB,KAAKL,MAAM+gB,YAAYjN,aAActR,KAAMof,QACpM,MACVvhB,KAAKL,MAAMugB,gBAAkBlgB,KAAKL,MAAM+gB,YAAY5M,aAAa,kBAACqN,GAAA,EAAD,CAAUjnB,UAAU,wBACnF,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,cACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB8F,KAAKL,MAAM+gB,YAAY5M,aAApE,IAAkF,kBAAC,IAAD,CAAiB5Z,UAAU,sBAAsB+H,QAAUjC,KAAKL,MAAM2hB,WAAWthB,KAAKL,MAAM+gB,YAAY7M,eAAgB1R,KAAMof,QACxM,KACZ,kBAACJ,GAAA,EAAD,CAAUjnB,UAAU,wBAChB,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAArB,eACA,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwB8F,KAAKwhB,4BAA4BxhB,KAAKL,MAAM+gB,YAAY3M,eAAevU,MAApH,IAA2H,kBAAC,IAAD,CAAiBtF,UAAU,sBAAsB+H,QAAUjC,KAAKL,MAAM2hB,WAAWthB,KAAKL,MAAM+gB,YAAY3M,gBAAiB5R,KAAMof,SAG7PvhB,KAAKL,MAAMugB,eAAe,KAC3B,kBAACuB,GAAA,EAAD,KACI,kBAACN,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAWM,QAAQ,KAAnB,uBAA2C,uBAAG7I,KAAK,4CAA4C3hB,OAAO,SAASyqB,IAAI,uBAAxE,2B,kDAO/BniB,GACxB,OAA0B,IAAvBA,EAAKoiB,QAAQ,KACLpiB,EAEJA,EAAK7J,MAAM,EAAG6J,EAAKoiB,QAAQ,U,GArGKhf,IAAMC,WCEhCgf,G,YACjB,WAAYliB,GAAQ,IAAD,8BACf,4CAAMA,KACDrF,MAAQ,CACTwnB,qBAAsB,MAHX,E,kEAOdxpB,EAAMmd,GAAK,IAAD,OACX,OAAO,WACH,EAAK9V,MAAMoiB,OAAOzpB,EAAMmd,GACxBlkB,YAAWiJ,IAAqC,kB,yCAGrCwnB,EAAWC,GACvBD,EAAUE,YAAcliB,KAAKL,MAAMuiB,WAClCliB,KAAKE,SAAS,CACV4hB,qBAAsB,S,+CAITK,GAAY,IAAD,OAChC,OAAO,SAACxqB,GACmC,OAApC,EAAK2C,MAAMwnB,qBACV,EAAK5hB,SAAS,CAAC4hB,qBAAqB,OAEpC,EAAK5hB,SAAS,CAAC4hB,qBAAsBK,IAEzCxqB,EAAEsoB,qB,+BAGD,IAAD,OACJ,OAAIjgB,KAAKL,MAAMyiB,YAIZ,6BAAOpiB,KAAKL,MAAMmT,aAAe9S,KAAKL,MAAMmT,YAAY9d,OAAO,EAAGgL,KAAKqiB,eAAe,KAChFriB,KAAKsiB,cAJH,yBAAKpoB,UAAY,eAAjB,oDACH,0BAAMA,UAAY,gBAAgB+H,QAAS,kBAAI,EAAKtC,MAAMihB,oBAA1D,IAA8E,kBAAC,IAAD,CAAiBze,KAAM0e,MAArG,SADG,iC,qCAMC,IAAD,OACX,OAAO,kBAACE,GAAA,EAAD,KACH,kBAACM,GAAA,EAAD,KAEIrhB,KAAKL,MAAMmT,YAAYhe,KAAI,SAAAqC,GACvB,IAAIorB,EAAc,EAAK3F,OAAOzlB,EAAO8G,MAAO9G,EAAOkX,UAC/CmU,EAAc,EAAK5F,OAAOzlB,EAAOgH,MAAOhH,EAAOmX,UACnD,OAAO,kBAAC6S,GAAA,EAAD,CAAUjnB,UAAU,UAAU8G,IAAG,UAAO7J,EAAOgP,KAAOlE,QAAS,EAAKtC,MAAM2hB,WAAWnqB,IACxF,kBAACiqB,GAAA,EAAD,KACqB,QAAhBjqB,EAAOA,OAAe,2BAAIorB,GAAiBA,EADhD,IAC8DprB,EAAOA,OADrE,IACgG,QAAlBA,EAAOA,OAAiB,2BAAIqrB,GAAiBA,W,6BAOxI/pB,EAAM4G,GACT,MAAM,GAAN,OAAU5G,GAAV,OAAiB4G,EAAI,IAAD,OAAKA,EAAL,KAAY,M,iCAEzB8iB,GACP,IAAIM,EAAyBziB,KAAK1F,MAAMwnB,uBAAyBK,EAC7DO,EAAW1iB,KAAKL,MAAMyiB,YAAYD,GAEtC,OAAO,kBAACQ,GAAA,EAAD,CAASC,QAAQ,QAAQzd,UAAU,QAAQ7C,OAAQmgB,EAAwBvrB,OAAM,4BAAuBirB,GAAarI,OAAQ9Z,KAAK6iB,yBAAyBV,IAC1J,kBAAC,GAAD,CAAgBzB,YAAagC,EAAS1P,QAASkN,gBAAgB,EAAM5d,OAAUmgB,EAAwBnB,WAAYthB,KAAKL,MAAM2hB,WAAY/C,SAAUve,KAAKL,MAAM4e,c,mCAG7J,IAAD,OACLpM,EAAYnS,KAAKL,MAAMyiB,aAAepiB,KAAKL,MAAMyiB,YAAYptB,OAAO,EACxE,OAAO,kBAAC+rB,GAAA,EAAD,KACF5O,EACL,kBAAC+O,GAAA,EAAD,KACA,kBAACC,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAWjpB,KAAK,QAAQ+B,UAAU,YAAW,oCAC7C,kBAACknB,GAAA,EAAD,CAAWjpB,KAAK,QAAQ+B,UAAU,YAAW,qCAC7C,kBAACknB,GAAA,EAAD,KAAW,yCAEd,KACAjP,EACD,kBAACkP,GAAA,EAAD,KAEArhB,KAAKL,MAAMyiB,YAAYttB,KAAI,SAACoX,EAAMiW,GAC9B,IAAIW,EAAoB,EAAKlG,OAAO1Q,EAAK8G,QAAQe,eAAe9V,MAAOiO,EAAK8G,QAAQe,eAAe1F,UAC/F0U,EAAoB,EAAKnG,OAAO1Q,EAAK8G,QAAQe,eAAe5V,MAAO+N,EAAK8G,QAAQe,eAAezF,UAC/F0U,EAAe9W,EAAK8G,QAAQe,eAAe5c,OAE/C,OAAO+U,EAAK8G,QAAQgB,MAAQ,EAAE,kBAACmN,GAAA,EAAD,CAAUjnB,UAAU,UAAU8G,IAAG,UAAOkL,EAAKqJ,MAAZ,OAAmBrJ,EAAKsJ,MAAQvT,QAAS,EAAKiK,KAAKA,EAAKqJ,KAAMrJ,EAAKsJ,OAC9H,kBAAC4L,GAAA,EAAD,CAAWjpB,KAAK,QAAQ+B,UAAU,YAAYgS,EAAK0B,IAAnD,KACA,kBAACwT,GAAA,EAAD,CAAWjpB,KAAK,QAAQuiB,GAAE,4BAAuByH,GAAajoB,UAAU,WAAW+H,QAAU,EAAK4gB,yBAAyBV,IACtHjW,EAAK8G,QAAQgB,MADlB,IACyB,kBAAC,IAAD,CAAiB9Z,UAAU,aAAaiI,KAAM2b,MAClE,EAAKmF,WAAWd,IAErB,kBAACf,GAAA,EAAD,KACI,kBAAC8B,GAAA,EAAD,CAAUhpB,UAAY,SAASipB,OAAK,GAChC,kBAACD,GAAA,EAAD,CAAUE,KAAG,EAAClpB,UAAU,YAAYvI,MAAK,UAAKua,EAAK8G,QAAQE,UAAUhH,EAAK8G,QAAQgB,MAAM,MAAQ9H,EAAK8G,QAAQE,UAAUhH,EAAK8G,QAAQgB,MAAM,GAAI9H,EAAK8G,QAAQE,UAAU,IACrK,kBAACgQ,GAAA,EAAD,CAAUE,KAAG,EAAClpB,UAAU,WAAWvI,MAAK,UAAKua,EAAK8G,QAAQ9U,MAAMgO,EAAK8G,QAAQgB,MAAM,MAAQ9H,EAAK8G,QAAQ9U,MAAMgO,EAAK8G,QAAQgB,MAAM,GAAI9H,EAAK8G,QAAQ9U,MAAM,IACxJ,kBAACglB,GAAA,EAAD,CAAUE,KAAG,EAAClpB,UAAU,YAAYvI,MAAK,UAAKua,EAAK8G,QAAQC,UAAU/G,EAAK8G,QAAQgB,MAAM,MAAQ9H,EAAK8G,QAAQC,UAAU/G,EAAK8G,QAAQgB,MAAM,GAAI9H,EAAK8G,QAAQC,UAAU,OAIjL,kBAACkO,GAAA,EAAD,CAAUjnB,UAAU,UAAU8G,IAAG,UAAOkL,EAAKqJ,MAAZ,OAAmBrJ,EAAKsJ,MAAQvT,QAAS,EAAKiK,KAAKA,EAAKqJ,KAAMrJ,EAAKsJ,OAChG,kBAAC4L,GAAA,EAAD,CAAWjpB,KAAK,QAAQ+B,UAAU,YAAYgS,EAAK0B,KACnD,kBAACwT,GAAA,EAAD,CAAWM,QAAU,KAC5BoB,EADO,IACaE,EADb,IAC4BD,EAD5B,IACgD,kBAAC,IAAD,CAAiB7oB,UAAU,sBAAsB+H,QAAU,EAAKtC,MAAM2hB,WAAWpV,EAAK8G,QAAQe,gBAAiB5R,KAAMof,YAMhL,KACG,kBAACE,GAAA,EAAD,KAAa,kBAACN,GAAA,EAAD,KACZnhB,KAAKL,MAAM4e,SAASrd,WAEjBiR,EACI,kBAACiP,GAAA,EAAD,CAAWM,QAAQ,KAAnB,uCAEQ1hB,KAAKL,MAAMuiB,YAAcliB,KAAKL,MAAM4e,SAASngB,YAAa,KAAO,oBAFzE,IAE8F,2BAAI4B,KAAKL,MAAM4e,SAASrd,YAFtH,sBAGe,2BAAIlB,KAAKL,MAAM4e,SAASrd,YAHvC,kBAGqE,2BAAIlB,KAAKL,MAAM4e,SAASngB,aAH7F,KAKA,kBAACgjB,GAAA,EAAD,CAAWM,QAAQ,KAAnB,4BAC0B1hB,KAAKL,MAAMuiB,YAAcliB,KAAKL,MAAM4e,SAASngB,YAAa,KAAO,oBAD3F,IACgH,2BAAI4B,KAAKL,MAAM4e,SAASrd,YADxI,sBAEe,2BAAIlB,KAAKL,MAAM4e,SAASrd,YAFvC,kBAEqE,2BAAIlB,KAAKL,MAAM4e,SAASngB,aAF7F,KAKJ+T,EACI,kBAACiP,GAAA,EAAD,CAAWM,QAAQ,KAAnB,8CAEU,2BAAI1hB,KAAKL,MAAMuiB,WAFzB,sBAKA,kBAACd,GAAA,EAAD,CAAWM,QAAQ,KAAnB,4BAEU,2BAAI1hB,KAAKL,MAAMuiB,WAFzB,6B,GAjIuBtf,IAAMC,WCKxBmd,G,YACjB,WAAYrgB,GAAO,IAAD,8BAChB,4CAAMA,KACDrF,MAAQ,CACT+oB,UAAU,OACVC,WAAW,MAEf,EAAKjL,YAAc,WACjB,EAAKnY,SAAS,CAACojB,WAAW,QAPZ,E,wEAYPha,GAAO,IAAD,OACf,OAAGA,EAAKnD,IACG,SAACxO,GACJA,EAAEsoB,kBACF7uB,OAAOmnB,KAAKjP,EAAKnD,IAAK,UACtB5U,YAAWiJ,IAAqC,qBAGhD,SAAC7C,GACPA,EAAEsoB,kBACF,EAAK/f,SAAS,CAACojB,WAAWha,O,6BAIvBia,GACAvjB,KAAK1F,MAAM+oB,YAAcE,IACxBvjB,KAAKE,SAAS,CAACmjB,UAAUE,IACzBhyB,YAAWiJ,IAAD,oBAAgD+oB,O,wCAIhEvjB,KAAK8Z,OAAO,U,yCAGZ9Z,KAAK8Z,OAAO,W,+BAGL,IAAD,OACJ,OAAO,6BACD,kBAACD,EAAA,EAAD,CAAOvX,OAAQtC,KAAK1F,MAAMgpB,WAAYxJ,OAAQ9Z,KAAKqY,aACnD,kBAAC0B,EAAA,EAAD,CAAaD,OAAQ9Z,KAAKqY,aAA1B,gBACErY,KAAK1F,MAAMgpB,WACb,kBAACvC,GAAA,EAAD,KAEE,kBAACM,GAAA,EAAD,KAEIxhB,OAAOkB,QAAQf,KAAK1F,MAAMgpB,WAAW7a,SAAS3T,KAAI,SAACsgB,GAAD,OAAUA,EAAM,GAAQ,kBAAC+L,GAAA,EAAD,CAAUjnB,UAAU,wBAC1F,kBAACknB,GAAA,EAAD,CAAWlnB,UAAU,wBAAwBkb,EAAM,IACnD,kBAACgM,GAAA,EAAD,CAAWlnB,UAAU,wBAAwBkb,EAAM,KAFc,UALnD,KAcxB,kBAAC+E,EAAA,EAAD,KACJ,kBAACtC,EAAA,EAAD,CAAQ7V,MAAM,YAAYC,QAASjC,KAAKqY,aAAxC,UAGE,kBAACW,EAAA,EAAD,CAAKwK,MAAI,GACb,kBAACvK,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CACEhf,UAAWupB,KAAW,CAAEC,OAAiC,SAAzB1jB,KAAK1F,MAAM+oB,YAC3CphB,QAAS,WAAQ,EAAK6X,OAAO,UAE7B,kBAAC,IAAD,CAAiB3X,KAAM0e,MAJzB,IAI8D,SAAzB7gB,KAAK1F,MAAM+oB,UAAqB,OAAO,KAG9E,kBAACpK,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CACEhf,UAAWupB,KAAW,CAAEC,OAAiC,UAAzB1jB,KAAK1F,MAAM+oB,YAC3CphB,QAAS,WAAQ,EAAK6X,OAAO,WAE7B,kBAAC,IAAD,CAAiB3X,KAAMqD,MAJzB,IAI8D,UAAzBxF,KAAK1F,MAAM+oB,UAAsB,QAAQ,KAGhF,kBAACpK,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CACEhf,UAAWupB,KAAW,CAAEC,OAAiC,WAAzB1jB,KAAK1F,MAAM+oB,YAC3CphB,QAAS,WAAQ,EAAK6X,OAAO,YAE7B,kBAAC,IAAD,CAAiB3X,KAAMwhB,MAJzB,IAIkE,WAAzB3jB,KAAK1F,MAAM+oB,UAAuB,SAAS,KAGtF,kBAACpK,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CACEhf,UAAWupB,KAAW,CAAEC,OAAiC,aAAzB1jB,KAAK1F,MAAM+oB,YAC3CphB,QAAS,WAAQ,EAAK6X,OAAO,cAE7B,kBAAC,IAAD,CAAiB3X,KAAMyhB,MAJzB,IAI6D,aAAzB5jB,KAAK1F,MAAM+oB,UAAyB,WAAW,MAIvF,kBAACQ,GAAA,EAAD,CAAYR,UAAWrjB,KAAK1F,MAAM+oB,WAChC,kBAACS,GAAA,EAAD,CAASC,MAAM,QACX,kBAAC,GAAD,CACExe,iBAAkBvF,KAAKuF,iBAAiBhF,KAAKP,MAC7CwE,MAASxE,KAAKL,MAAM6E,MACpBD,eAAkBvE,KAAKL,MAAM4E,eAC7Bga,SAAYve,KAAKL,MAAM4e,SACvB9c,SAAYzB,KAAKL,MAAMqkB,eACvB3f,OAAUrE,KAAKL,MAAMskB,qBACrBvgB,UAAa1D,KAAKL,MAAM+D,UACxBG,SAAY7D,KAAKL,MAAMkE,SACvBa,eAAkB1E,KAAKL,MAAM+E,eAC7BM,cAAiBhF,KAAKL,MAAMqF,cAC5B+Q,aAAc/V,KAAKL,MAAMoW,aACzBiJ,eAAgBhf,KAAKL,MAAMqf,kBAGjC,kBAAC8E,GAAA,EAAD,CAASC,MAAM,SACX,kBAAC,GAAD,CACEnD,gBAAiB5gB,KAAK4gB,gBAAgBrgB,KAAKP,MAC3CoiB,YAAapiB,KAAKL,MAAMyiB,YACxBtP,YAAa9S,KAAKL,MAAMmT,YACxBiP,OAAQ/hB,KAAKL,MAAMoiB,OACnBxD,SAAUve,KAAKL,MAAM4e,SACrB2D,UAAWliB,KAAKL,MAAMuiB,UACtB8B,eAAgBhkB,KAAKL,MAAMqkB,eAC3B1C,WAActhB,KAAKshB,WAAW/gB,KAAKP,SAGzC,kBAAC8jB,GAAA,EAAD,CAASC,MAAM,UACb,kBAAC,GAAD,CAAgB1oB,IAAK2E,KAAKL,MAAMtE,IAAK6kB,gBAAkB,EACrDQ,YAAe1gB,KAAKL,MAAMoW,aAAaT,iBAAiBtV,KAAKL,MAAMtE,KACnEimB,WAAYthB,KAAKshB,WAAW/gB,KAAKP,MAAOue,SAAUve,KAAKL,MAAM4e,SAC7DqC,gBAAiB5gB,KAAK4gB,gBAAgBrgB,KAAKP,MAC3CsC,OAAmC,WAAzBtC,KAAK1F,MAAM+oB,UACrBxf,SAAY7D,KAAKL,MAAMkE,YAE3B,kBAACigB,GAAA,EAAD,CAASC,MAAM,YACb,kBAAC5S,EAAA,EAAD,KACE,kBAACC,EAAA,EAAD,CAAKC,GAAG,KACR,kBAAC,GAAD,CAAchW,IAAK2E,KAAKL,MAAMtE,IAAKkjB,SAAUve,KAAKL,MAAM4e,SAAUjc,QAAU,EAAMkC,MAASxE,KAAKL,MAAM6E,MAAOgb,MAASxf,KAAKL,MAAM6f,MAAO/d,SAAYzB,KAAKL,MAAMqkB,0B,GAxI5HphB,IAAMC,WCTrD,SAASqf,KACL,MAIqB,MAJDliB,KAAKmN,MAAM+W,OAIJ1pB,IAA+BA,IAG9D,SAAS4D,KACL,OAAO4B,KAAK1F,MAAMikB,SAASngB,YAG/B,SAAS+lB,KACL,OAAGnkB,KAAK5B,gBAAkB4B,KAAKkiB,YACpBliB,KAAKokB,WAETpkB,KAAKqkB,eAGhB,SAASC,KAAe,IAAD,OACjBC,EAAQ,GAKV,OAJAvkB,KAAKmN,MAAMqX,QAAQvvB,SAAQ,SAAAwvB,GACvB,IAAMC,EAAK,EAAKvX,MAAMnB,MAAM,CAAC2Y,OAAQF,EAAGG,SAAS,IAC7CF,EAAG1vB,SAAQuvB,EAAME,GAAKC,EAAG5vB,KAAI,SAAA+vB,GAAC,OAAIA,EAAEpP,UAErC,CACHqP,MAAM,EACNP,QACAviB,MAAOhC,KAAKkiB,aAIpB,SAAS6C,KACL,OAAO/kB,KAAK1F,MAAMikB,SAASwG,YAG/B,SAAShD,GAAOzpB,EAAMmd,GAClB,IAAMtI,EAAQnN,KAAKmN,MACfjB,EAAOiB,EAAMjB,KAAK,CAAE5T,OAAMmd,KAAIuP,UAAW,MAC7ChlB,KAAKE,SAAS,CAAE7E,IAAK8R,EAAM9R,MAAO4pB,SAAU/Y,IAIhD,SAASgZ,GAAa5sB,EAAMmd,GACxBzV,KAAK+hB,OAAOzpB,EAAKmd,GACjBlkB,YAAWiJ,IAAqC,QAGpD,SAAS2qB,GAAW9pB,EAAK+pB,GACrBplB,KAAKmN,MAAQ,IAAIC,IAAM/R,GACvB2E,KAAKE,SAAS,CAAC7E,IAAIA,EAAK4pB,SAASG,IAErC,SAASnB,GAAqBpU,EAAe7V,EAAGqrB,GAC5C,IAAIC,EAAsBtlB,KAAK1F,MAAMiK,eAAevK,EAWpD,OAVAgG,KAAK1F,MAAMyb,aAAawP,OAAOF,EAAWvX,SAAUuX,EAAW/X,YACvD+X,EAAWrX,UAAUqX,EAAWjnB,aACxC4B,KAAKE,SAAS,CACVqE,eAAgB+gB,EAChBE,kBAAmBF,EAAoBzV,GAAiBA,GAAerV,MAA8BwF,KAAK1F,MAAMkrB,oBAM5GF,EAAsBzV,GAAiBA,GAAerV,MAAgCwF,KAAK1F,MAAMkrB,iBAE7G,SAASC,GAAYvZ,GACjB,MAAO,CACHqJ,KAAKrJ,EAAKqJ,KACEC,KAAMtJ,EAAKsJ,KACXkQ,MAAO1lB,KAAKmkB,UAAUjY,EAAKwJ,QAI/C,SAASiQ,KACL,IAAI3Z,EAAQhM,KAAKoiB,cACjB,GAAGpW,EAAO,CACN,IAAI4Z,EAAS5Z,EAAMlX,IAAIkL,KAAKylB,YAAYllB,KAAKP,OAC7C,OAAOA,KAAK6lB,UAAUD,EAAS,IAEnC,OAAO5lB,KAAK6lB,UAAU,GAAI,IAG9B,SAASzD,KACL,IAAIpiB,KAAK1F,MAAMyb,aAAa5D,SACxB,OAAO,KAEX,IAAInG,EAAQhM,KAAK1F,MAAMyb,aAAa+P,YAAY9lB,KAAKmN,MAAM9R,OAC3D,OAAO2Q,EAAMA,EAAMnU,MAAK,SAACC,EAAEC,GAAH,OAAOA,EAAEib,QAAQgB,MAAMlc,EAAEkb,QAAQgB,SAAO,GAKpE,SAASlB,KACL,OAAO9S,KAAK1F,MAAMyb,aAAagQ,kBAAkB/lB,KAAKmN,MAAM9R,OAGhE,SAASwqB,GAAU9wB,EAAKixB,GACpB,IAAK,IAAIvwB,EAAIV,EAAIC,OAAQS,EAAIuwB,EAAKvwB,IAC9BV,EAAIM,KAAK,CAAC,KAAO,IAAII,EAAG,KAAO,KAAKA,EAAE,GAAIiwB,MAAM1lB,KAAKmkB,UAAU,KAEnE,OAAOpvB,EAGX,SAASyqB,KACLxf,KAAKmN,MAAQ,IAAIC,IACjBpN,KAAKE,SAAS,CAAC7E,IAAK2E,KAAKmN,MAAM9R,MAAO4pB,SAAS,OAGnD,SAASzgB,KACLxE,KAAK1F,MAAMyb,aAAavR,QACxBxE,KAAK1F,MAAMiK,eAAiB,EAC5BvE,KAAKwf,QAGT,SAASwE,GAAevrB,EAAM9G,GAC1B,IAAI4sB,EAAWve,KAAK1F,MAAMikB,SAC1BA,EAAS9lB,GAAQ9G,EACjBqO,KAAKE,SAAS,CACV,SAAWqe,IAWnB,SAAS7a,GAAUhL,EAASutB,EAAeC,EAAYz0B,GACnD,IAAI00B,EAAiBC,EARTjgB,EAST1U,GAAU+I,KACT2rB,EAAgB,iBAVRhgB,EAWa,kCAArBigB,EAVG,WACLh1B,OAAOmnB,KAAKpS,EAAK,aAWfggB,EAAgB,cAChBC,EAAcpmB,KAAKoZ,gBAAe,IAEtCpZ,KAAKE,SAAS,CAACxH,QAAQA,EAASwtB,WAAWA,EACvCE,YAAYA,EAAaD,gBAAgBA,EACzCE,gBAAgB,UACpB,IAAI9G,EAAY,aACb0G,IACC1G,EAAYA,EAAU,IAAI0G,GAE9B10B,YAAWiJ,IAAuC+kB,EAAW7mB,GAGjE,SAASmL,GAASnL,EAAS4tB,GACvBtmB,KAAKE,SAAS,CAACxH,QAAQA,EAAS2tB,gBAAgB,YAChD90B,YAAWiJ,IAAuC,YAC9C8rB,GAA4B5tB,GAIpC,SAAS6tB,KACLvmB,KAAKE,SAAS,CAACxH,QAAQ,GAAIwtB,WAAW,KAG1C,SAAS9M,GAAeoN,GAAkB,IAAD,OACrC,OAAO,WACH,IAAIC,EAAe,EAAKnsB,MAAMmsB,aAC9B,EAAKF,aACL,EAAKrmB,SAAS,CAACumB,cAAcA,EACrBC,oBAAoBF,KAIpC,SAAS9hB,GAAewL,GACpBlQ,KAAKE,SAAS,CAACslB,iBAAiBtV,IAGpC,SAASyW,KACL3mB,KAAKE,SAAS,CAACwmB,qBAAqB1mB,KAAK1F,MAAMosB,sBAGnD,SAASE,KACLnsB,aAAS,mBACTuF,KAAK6D,SAAS,2BAIlB,SAASgjB,GAAgBC,GACrB9mB,KAAKE,SAAS,CACZqe,SAASuI,EAAYvI,SACrBxI,aAAa+Q,EAAY/Q,aACzBxR,eAAeuiB,EAAYviB,iBAG/B,SAASwiB,KAGP,OAAI31B,OAAO41B,YAAY,IACf,GAAN,OAAUzoB,KAAKC,MAAwB,GAAlBpN,OAAO41B,WAAc,KAA1C,MACU51B,OAAO41B,YAAY,KACvB,GAAN,OAAUzoB,KAAKC,MAAwB,GAAlBpN,OAAO41B,WAAc,KAA1C,MAEO,QAKb,SAASC,KACP,MAAM,2BAAN,OACEC,UAAUC,UADZ,sCAGE/wB,KAAKC,UAAU2J,KAAK1F,OAHtB,+BAOF,SAAS8sB,KACL,MAAM,8CAAN,OAAqD5sB,IAArD,oBAA8FwF,KAAKqnB,aAAnG,sCAA6IrnB,KAAKsnB,WAGtJ,SAASC,KACL,MAAM,UAAN,OAAiB/sB,IAAjB,oBAAyDwF,KAAKqnB,aAA9D,mCAAqGrnB,KAAKsnB,WAG9G,SAASD,KACL,OAAOrnB,KAAK1F,MAAMosB,oBAAoB,2BAA2B,0BAErE,SAASY,KACL,OAAOtnB,KAAK1F,MAAMosB,oBAAoB1mB,KAAKinB,sBAAsB,GAIrE,SAASO,GAAmBC,GACxBA,EAAI1C,YAAeA,GACnB0C,EAAIvF,UAAYA,GAChBuF,EAAInD,YAAcA,GAClBmD,EAAI1F,OAASA,GACb0F,EAAIvC,aAAeA,GACnBuC,EAAI9B,WAAaA,GACjB8B,EAAIxD,qBAAuBA,GAC3BwD,EAAIzD,eAAiBA,GACrByD,EAAIjI,MAAQA,GACZiI,EAAIjjB,MAAQA,GACZijB,EAAItC,WAAaA,GACjBsC,EAAIrpB,YAAcA,GAClBqpB,EAAI5B,UAAYA,GAChB4B,EAAItD,QAAUA,GACdsD,EAAIhC,YAAcA,GAClBgC,EAAIrF,YAAcA,GAClBqF,EAAI3U,YAAcA,GAClB2U,EAAI/jB,UAAYA,GAChB+jB,EAAI5jB,SAAWA,GACf4jB,EAAIlB,WAAaA,GACjBkB,EAAIrO,eAAiBA,GAAe7Y,KAAKknB,GACzCA,EAAI/iB,eAAiBA,GACrB+iB,EAAId,sBAAwBA,GAAsBpmB,KAAKknB,GACvDA,EAAIb,gBAAkBA,GAAgBrmB,KAAKknB,GAC3CA,EAAIZ,gBAAkBA,GACtBY,EAAIR,oBAAsBA,GAC1BQ,EAAIV,mBAAqBA,GACzBU,EAAIF,aAAeA,GACnBE,EAAIJ,WAAaA,GACjBI,EAAIH,QAAUA,GAAQ/mB,KAAKknB,GAC3BA,EAAIL,cAAgBA,G,6MCxPlBM,GAAc,CAChB/jB,QAASgkB,KACTC,QAASC,KACTvxB,MAAOwxB,KACP9jB,KAAM+jB,MA4EKzuB,qBAzEA,SAAC0uB,GAAD,MAAY,CACvBrkB,QAAS,CACLskB,gBAAiBC,KAAM,MAE3B5xB,MAAO,CACH2xB,gBAAiBD,EAAMG,QAAQ7xB,MAAM8xB,MAEzCpkB,KAAM,CACFikB,gBAAiBD,EAAMG,QAAQE,QAAQD,MAE3CR,QAAS,CACLK,gBAAiBK,KAAM,MAE3BnmB,KAAM,CACFoe,SAAU,IAEdgI,YAAa,CACTC,QAAS,GACTC,YAAaT,EAAMU,QAAQ,IAE/BhwB,QAAS,CACLiB,QAAS,OACTgvB,WAAY,aAmDLrvB,EA/Cf,SAAgCqG,GAAQ,IAC7BipB,EAA6GjpB,EAA7GipB,QAAS1uB,EAAoGyF,EAApGzF,UAAWxB,EAAyFiH,EAAzFjH,QAASmwB,EAAgFlpB,EAAhFkpB,QAASjkB,EAAuEjF,EAAvEiF,QAASshB,EAA8DvmB,EAA9DumB,WAAYz0B,EAAkDkO,EAAlDlO,OAAQq3B,EAA0CnpB,EAA1CmpB,WAAYC,EAA8BppB,EAA9BopB,iBAAqBC,EADxE,aACiFrpB,EADjF,6GAE7BspB,EAAOvB,GAAY9iB,GAEzB,OACI,gBAACskB,GAAA,EAAD,eACIhvB,UAAWivB,aAAKP,EAAQhkB,GAAU1K,GAClCkvB,mBAAiB,kBACjB1wB,QACI,2BAAK,wBAAMgiB,GAAG,kBAAkBxgB,UAAW0uB,EAAQlwB,SAC/C,gBAACuwB,EAAD,CAAM/uB,UAAWivB,aAAKP,EAAQzmB,KAAMymB,EAAQL,eAC3C7vB,GAGHwtB,EAAgB,uBAAKhsB,UAAU,aAAf,mCAA4EgsB,GAAjF,MAGjBz0B,OAAQ,CACHs3B,EAAsB,gBAAC,KAAD,CAAQ/nB,IAAI,SAASiB,QAAWxQ,EAAQuQ,MAAM,UAAU7J,KAAK,SACjF2wB,GADe,KAGlB,gBAACO,GAAA,EAAD,CACIroB,IAAI,QACJsoB,aAAW,QACXtnB,MAAM,UACN9H,UAAW0uB,EAAQ7c,MACnB9J,QAAS4mB,GAET,gBAAC,KAAD,CAAW3uB,UAAW0uB,EAAQzmB,UAGlC6mB,O,oBC1DKO,G,YAEnB,WAAY5pB,GAAO,IAAD,8BAChB,4CAAMA,KACDwN,MAAQ,IAAIC,IACjBoa,GAAmB,gBACnB,EAAKltB,MAAQ,CACTe,IAAK,EAAK8R,MAAM9R,MAChB4pB,SAAU,KACV1gB,eAAe,EACfwR,aAAaA,EACbwI,SAAS,CACPrd,WAAW,GACX6jB,YAAYvqB,IACZ4D,YAAY,IAEd1F,QAAQ,GACR8sB,kBAAiB,EACjBiB,cAAa,EACbC,qBAAoB,GAExB,EAAK8C,gBAAkB,EAAKzC,qBAE5B,EAAK3C,WAAa,CAAC,WAAY,YAAa,SAC5C,EAAKC,eAAiB,CAAC,UAAW,UAAW,OAtB7B,E,sEA2BhB,IAAIoF,EAAgBzpB,KAAK1F,MAAM2qB,SAAW,CAACjlB,KAAK1F,MAAM2qB,SAAS3sB,KAAM0H,KAAK1F,MAAM2qB,SAASxP,IAAM,KAC3FiU,IAAe1pB,KAAK1F,MAAM5B,QAC9B,OAAO,yBAAKwB,UAAU,YAClB,kBAAC,EAAD,CAAckf,eAAkBpZ,KAAKoZ,gBAAe,KACpD,kBAACvI,EAAA,EAAD,CAAW3W,UAAU,iBACnB,kBAACiX,EAAA,EAAD,KAAK,kBAACC,EAAA,EAAD,CAAKwG,GAAI,CAAC+R,MAAM,EAAGxxB,KAAK,GAAIyxB,GAAI,CAACD,MAAM,IAAI,kBAAC,EAAD,CAAWtuB,IAAO2E,KAAK1F,MAAMe,IAAK6Q,KAAMlM,KAAK1F,MAAM2qB,SAAUxjB,SAAWzB,KAAKmlB,WAAW5kB,KAAKP,SAC7I,kBAACoR,EAAA,EAAD,CAAKwG,GAAG,KAAI,kBAAC,IAAD,CAChBxd,OAAQ4F,KAAKwpB,gBACb7Q,MAAO3Y,KAAKwpB,gBACZzE,YAAa/kB,KAAK+kB,cAClB7C,UAAWliB,KAAKkiB,YAChB2H,QAAS7pB,KAAKskB,cAEdW,SAAUwE,EACVpuB,IAAK2E,KAAK1F,MAAMe,IAChB0mB,OAAQ/hB,KAAKklB,aAAa3kB,KAAKP,MAC/B8pB,SAAW,CACTC,SAAS,EACTC,SAAS,EACTrE,WAAY3lB,KAAK2lB,cAEnBrF,MAAO,CAAE1mB,OAAQ,WAEb,kBAACwX,EAAA,EAAD,CAAKwG,GAAG,IAAI1d,UAAU,cAAa,kBAAC,GAAD,CAAmBmB,IAAK2E,KAAK1F,MAAMe,IAChEkJ,eAAgBvE,KAAK1F,MAAMiK,eAC3B0f,qBAAsBjkB,KAAKikB,qBAAqB1jB,KAAKP,MACrDgkB,eAAgBhkB,KAAKgkB,eAAezjB,KAAKP,MACzCue,SAAUve,KAAK1F,MAAMikB,SACrBiB,MAAOxf,KAAKwf,MAAMjf,KAAKP,MACvBwE,MAAOxE,KAAKwE,MAAMjE,KAAKP,MACvBoiB,YAAapiB,KAAKoiB,cAClBtP,YAAa9S,KAAK8S,cAClBiP,OAAQ/hB,KAAK+hB,OAAOxhB,KAAKP,MACzBkiB,UAAWliB,KAAKkiB,YAChBxe,UAAW1D,KAAK0D,UAAUnD,KAAKP,MAC/B6D,SAAU7D,KAAK6D,SAAStD,KAAKP,MAC7B0E,eAAgB1E,KAAK0E,eAAenE,KAAKP,MACzCgF,cAAehF,KAAK1F,MAAMkrB,iBAC1BzP,aAAc/V,KAAK1F,MAAMyb,aACzBiJ,eAAgBhf,KAAK6mB,gBAAgBtmB,KAAKP,WAGtD,kBAACiqB,GAAA,EAAD,CAAUC,aAAc,CAAEC,SAAS,SAAUC,WAAW,QAChD7R,KAAMmR,EAAcW,iBAAkB,IACtCxB,QAAS7oB,KAAKumB,WAAWhmB,KAAKP,OAEtC,kBAAC,GAAD,CACwB6oB,QAAS7oB,KAAKumB,WAAWhmB,KAAKP,MAC9B4E,QAAS5E,KAAK1F,MAAM+rB,gBACpB3tB,QAASsH,KAAK1F,MAAM5B,QACpBwtB,WAAYlmB,KAAK1F,MAAM4rB,WACvB6C,iBAA+C,UAA7B/oB,KAAK1F,MAAM+rB,gBAC7B50B,OAAQuO,KAAK1F,MAAM8rB,YACnB0C,WAAY9oB,KAAK1F,MAAM6rB,mBAI/C,kBAACtM,EAAA,EAAD,CAAOvX,OAAQtC,KAAK1F,MAAMmsB,aAAc3M,OAAQ9Z,KAAKoZ,gBAAe,IAChE,kBAACW,EAAA,EAAD,CAAaD,OAAQ9Z,KAAKoZ,gBAAe,IAAzC,YACA,kBAACkR,GAAA,EAAD,4HAEE,4BACE,yCAAc,uBAAG3I,IAAI,sBAAsB9I,KAAM7Y,KAAKunB,eAAgBrwB,OAAO,UAAUsD,MACvF,oDAAyB,uBAAGmnB,IAAI,sBAAsB9I,KAAM7Y,KAAKonB,gBAAiBlwB,OAAO,UAAhE,KAA4EsD,MACrG,sDAA2B,uBAAGmnB,IAAI,sBAAsB9I,KAAI,oCAA+Bre,KAAkCtD,OAAO,UAAUsD,MAC9I,wDAA6B,uBAAGmnB,IAAI,sBAAsB9I,KAAI,iDAA4Cre,KAAoCtD,OAAO,UAAUsD,MAC/J,uCAAY,uBAAGmnB,IAAI,sBAAsB9I,KAAMre,IAA+BtD,OAAO,UAAzE,kBAAZ,aAEF,kBAACoa,GAAA,EAAD,CACF1Y,QACE,kBAAC2Y,GAAA,EAAD,CACE/Q,QAASR,KAAK1F,MAAMosB,oBACpBjlB,SAAUzB,KAAK2mB,sBACfluB,KAAK,cACLuJ,MAAM,YAGVtQ,MAAM,oCAEJ,kBAAC8d,EAAA,EAAD,CAAUlN,OAAQtC,KAAK1F,MAAMosB,qBAC3B,kBAACzJ,GAAA,EAAD,CAAWvC,GAAG,kBAAkBhpB,MAAM,iBAAiBkT,QAAQ,WAC/D1K,UAAU,YAAYvI,MAAOqO,KAAKinB,sBAClC7G,QAAS,EAAGne,QAASjC,KAAK4mB,gBAAiBzG,WAAS,MAGxD,kBAAChG,EAAA,EAAD,KACE,kBAACtC,EAAA,EAAD,CAAQ7V,MAAM,YAAYC,QAASjC,KAAKoZ,gBAAe,IAAvD,e,GAnHiCxW,IAAMC,WChBjD0nB,IAASC,OAAO,kBAAC,GAAD,MAAmB7vB,SAASC,eAAe,SAC3D3J,e,gCCNA,mJAEO,SAASw5B,EAAyBpQ,GACrC,OAAOA,IAAW7f,KACd6f,IAAW7f,IAIZ,SAASkwB,EAAqBrQ,EAAQnZ,GACzC,OAAGmZ,IAAW7f,KACV6f,IAAW7f,OAGN0G,EAGN,SAASypB,EAAuBlmB,EAAYmmB,EAAcrmB,EAAgBS,GAC7E,OAAG4lB,IAAiBpwB,KAChBowB,IAAiBpwB,IACV,2CAERiK,IAAemmB,GAAgBrmB,GAAgB,EACvC,0CAERS,EACQ,+CAEJ,GAEJ,SAAS6lB,EAAexQ,EAAQnZ,EAAY9C,EAAase,EAAeoO,GAC3E,OAAGzQ,IAAW7f,IACJ,GAAN,OAAUkiB,EAAcjkB,KAAxB,YAAgCqyB,GAEjC5pB,EACO,GAAN,OAAUA,EAAV,YAAwB9C,EAAxB,YAAuC0sB,GAErC,6BAAN,OAAoCA,K,gCCtBxC,SAASC,EAAgBryB,EAASsyB,EAAUC,EAAO55B,GACjD2O,KAAKtH,QAAWA,EAChBsH,KAAKgrB,SAAWA,EAChBhrB,KAAKirB,MAAWA,EAChBjrB,KAAK3O,SAAWA,EAChB2O,KAAKvH,KAAW,cAEuB,oBAA5ByyB,MAAMC,mBACfD,MAAMC,kBAAkBnrB,KAAM+qB,IAdlC,SAAsBK,EAAOC,GAC3B,SAASC,IAAStrB,KAAKurB,YAAcH,EACrCE,EAAKl2B,UAAYi2B,EAAOj2B,UACxBg2B,EAAMh2B,UAAY,IAAIk2B,EAexBE,CAAaT,EAAiBG,OAE9BH,EAAgBU,aAAe,SAAST,EAAUC,GAChD,IAAIS,EAA2B,CACzBC,QAAS,SAASC,GAChB,MAAO,IAAOC,EAAcD,EAAYE,MAAQ,KAGlD,MAAS,SAASF,GAChB,IACIn2B,EADAs2B,EAAe,GAGnB,IAAKt2B,EAAI,EAAGA,EAAIm2B,EAAYI,MAAMh3B,OAAQS,IACxCs2B,GAAgBH,EAAYI,MAAMv2B,aAAcN,MAC5C82B,EAAYL,EAAYI,MAAMv2B,GAAG,IAAM,IAAMw2B,EAAYL,EAAYI,MAAMv2B,GAAG,IAC9Ew2B,EAAYL,EAAYI,MAAMv2B,IAGpC,MAAO,KAAOm2B,EAAYM,SAAW,IAAM,IAAMH,EAAe,KAGlEI,IAAK,SAASP,GACZ,MAAO,iBAGTQ,IAAK,SAASR,GACZ,MAAO,gBAGT5C,MAAO,SAAS4C,GACd,OAAOA,EAAYS,cAI3B,SAASC,EAAIC,GACX,OAAOA,EAAGC,WAAW,GAAGtlB,SAAS,IAAIulB,cAGvC,SAASZ,EAAcpH,GACrB,OAAOA,EACJxe,QAAQ,MAAO,QACfA,QAAQ,KAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,gBAAyB,SAASsmB,GAAM,MAAO,OAASD,EAAIC,MACpEtmB,QAAQ,yBAAyB,SAASsmB,GAAM,MAAO,MAASD,EAAIC,MAGzE,SAASN,EAAYxH,GACnB,OAAOA,EACJxe,QAAQ,MAAO,QACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,KAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,gBAAyB,SAASsmB,GAAM,MAAO,OAASD,EAAIC,MACpEtmB,QAAQ,yBAAyB,SAASsmB,GAAM,MAAO,MAASD,EAAIC,MA6CzE,MAAO,YAtCP,SAA0BvB,GACxB,IACIv1B,EAAGi3B,EANoBd,EAKvBe,EAAe,IAAIx3B,MAAM61B,EAASh2B,QAGtC,IAAKS,EAAI,EAAGA,EAAIu1B,EAASh2B,OAAQS,IAC/Bk3B,EAAal3B,IATYm2B,EASaZ,EAASv1B,GAR1Ci2B,EAAyBE,EAAYj1B,MAAMi1B,IAalD,GAFAe,EAAa90B,OAET80B,EAAa33B,OAAS,EAAG,CAC3B,IAAKS,EAAI,EAAGi3B,EAAI,EAAGj3B,EAAIk3B,EAAa33B,OAAQS,IACtCk3B,EAAal3B,EAAI,KAAOk3B,EAAal3B,KACvCk3B,EAAaD,GAAKC,EAAal3B,GAC/Bi3B,KAGJC,EAAa33B,OAAS03B,EAGxB,OAAQC,EAAa33B,QACnB,KAAK,EACH,OAAO23B,EAAa,GAEtB,KAAK,EACH,OAAOA,EAAa,GAAK,OAASA,EAAa,GAEjD,QACE,OAAOA,EAAah3B,MAAM,GAAI,GAAGyS,KAAK,MAClC,QACAukB,EAAaA,EAAa33B,OAAS,IAQxB43B,CAAiB5B,GAAY,QAJlD,SAAuBC,GACrB,OAAOA,EAAQ,IAAOY,EAAcZ,GAAS,IAAO,eAGM4B,CAAc5B,GAAS,WA8tDrF6B,EAAOC,QAAU,CACfC,YAAajC,EACbrzB,MA7tDF,SAAmBu1B,EAAO5Q,GACxBA,OAAsB,IAAZA,EAAqBA,EAAU,GAEzC,IA6GI6Q,EA7GAC,EAAa,GAEbC,EAAyB,CAAEC,MAAOC,IAClCC,EAAyBD,GAKzBE,EAAS,SAASC,EAAGC,EAAGC,GAAK,OAkrD7B,SAAmBF,EAAGC,EAAG7I,EAAG+I,GAExB,MAAO,CACHnlB,SAFJglB,EAAIA,GAAK,IAEMI,QAAO,SAACC,EAAKC,GAAN,OAAYluB,OAAOC,OAAOguB,EAAKC,KAAI,IACrDC,QAASN,EACT1hB,MAAO6Y,GAAK,GACZ1tB,OAAQy2B,GAxrDoBK,CAAUR,EAAGC,EAAGC,EAAG,GAAIA,EAAG,KAC9DO,EA+IK,CAAEv3B,KAAM,OA7Ibw3B,EAASC,GAAuB,KAAM,GACtCC,EAAS,QACTC,EAASC,GAAqB,CAAC,MAAO,GAAM,GAE5CC,EAAU,SACVC,EAAUF,GAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GACpDG,EAAU,SACVC,EAAUJ,GAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GAEpDK,EAAU,kBACVC,EAAUN,GAAqB,CAAC,CAAC,IAAK,KAAM,CAAC,IAAK,KAAM,CAAC,IAAK,KAAM,IAAK,MAAM,GAAO,GACtFO,EAAU,SAASC,GAAQ,OAAOA,EAAM3mB,KAAK,KAE7C4mB,EAAUZ,GAAuB,KAAK,GAEtCa,EAAUb,GAAuB,MAAM,GAEvCc,EAAUd,GAAuB,MAAM,GAEvCe,EAAUf,GAAuB,MAAM,GAEvCgB,EAAUhB,GAAuB,KAAK,GAEtCiB,EAAUjB,GAAuB,KAAK,GAGtCkB,EAAU,YACVC,EAAUhB,GAAqB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,MAAM,GAAO,GACtEiB,EAAU,SACVC,EAAUlB,GAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GACpDmB,EAAU,SACVC,EAAUpB,GAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GAEpDqB,EAAUxB,GAAuB,KAAK,GAEtCyB,EAAUzB,GAAuB,KAAK,GACtC0B,EAAU,QACVC,EAAUxB,GAAqB,CAAC,IAAK,MAAM,GAAO,GAElDyB,EAAU5B,GAAuB,KAAK,GAEtC6B,EAAU7B,GAAuB,OAAO,GAExC8B,EAAU9B,GAAuB,OAAO,GAExC+B,EAAU/B,GAAuB,KAAK,GAEtCgC,EAAUhC,GAAuB,WAAW,GAI5CiC,EAAUjC,GAAuB,KAAK,GACtCkC,EAAU,WACVC,EAAUhC,GAAqB,CAAC,IAAK,IAAK,IAAK,IAAK,MAAM,GAAO,GAEjEiC,EAAUpC,GAAuB,KAAK,GAEtCqC,EAAUrC,GAAuB,MAAM,GAEvCsC,EAAUtC,GAAuB,MAAM,GAEvCuC,EAAUvC,GAAuB,MAAM,GAEvCwC,EAAUxC,GAAuB,MAAM,GAEvCyC,EAAUzC,GAAuB,KAAK,GAEtC0C,EAAU1C,GAAuB,KAAK,GACtC2C,EAAU,QACVC,EAAUzC,GAAqB,CAAC,MAAM,GAAM,GAE5C0C,EAAU7C,GAAuB,KAAK,GAEtC8C,EAAU9C,GAAuB,KAAK,GAGtC+C,GAAU/C,GAAuB,SAAS,GAE1CgD,GAAUhD,GAAuB,OAAO,GACxCiD,GAAU,SAASxM,GAAI,OAkkDvB,SAASyM,EAAQx5B,GACb,IAD2B,IAAXg2B,EAAU,uDAAJ,GACbr4B,EAAI,EAAGA,EAAIqC,EAAE9C,OAAQS,IACtBN,MAAMo8B,QAAQz5B,EAAErC,IAChB67B,EAAQx5B,EAAErC,GAAIq4B,GAEdA,EAAIz4B,KAAKyC,EAAErC,IAGnB,OAAOq4B,EA1kDmBwD,CAAQzM,GAAGzc,KAAK,KAC9CopB,GAAU,SAASC,EAAI5M,EAAG7qB,GAAI,OAAOA,GAErC03B,GAAU,SAASD,EAAI5M,EAAG8M,EAAMC,EAAKhE,GAAI,OAAOA,GAIhDiE,GAAUzD,GAAuB,KAAK,GAEtC0D,GAAU1D,GAAuB,KAAK,GAGtC2D,GAAuB,EAEvBC,GAAuB,CAAC,CAAEC,KAAM,EAAGC,OAAQ,IAC3CC,GAAuB,EACvBC,GAAuB,GACvBC,GAAuB,EAI3B,GAAI,cAAehW,EAAS,CAC1B,KAAMA,EAAQiW,aAAalF,GACzB,MAAM,IAAIlC,MAAM,mCAAqC7O,EAAQiW,UAAY,MAG3E/E,EAAwBH,EAAuB/Q,EAAQiW,WA2BzD,SAASlE,GAAuBtC,EAAMyG,GACpC,MAAO,CAAE57B,KAAM,UAAWm1B,KAAMA,EAAMyG,WAAYA,GAGpD,SAAShE,GAAqBvC,EAAOE,EAAUqG,GAC7C,MAAO,CAAE57B,KAAM,QAASq1B,MAAOA,EAAOE,SAAUA,EAAUqG,WAAYA,GAexE,SAASC,GAAsBC,GAC7B,IAAwCC,EAApC1f,EAAUgf,GAAoBS,GAElC,GAAIzf,EACF,OAAOA,EAGP,IADA0f,EAAID,EAAM,GACFT,GAAoBU,IAC1BA,IASF,IALA1f,EAAU,CACRif,MAFFjf,EAAUgf,GAAoBU,IAEZT,KAChBC,OAAQlf,EAAQkf,QAGXQ,EAAID,GACmB,KAAxBxF,EAAMT,WAAWkG,IACnB1f,EAAQif,OACRjf,EAAQkf,OAAS,GAEjBlf,EAAQkf,SAGVQ,IAIF,OADAV,GAAoBS,GAAOzf,EACpBA,EAIX,SAAS2f,GAAoBC,EAAUC,GACrC,IAAIC,EAAkBN,GAAsBI,GACxCG,EAAkBP,GAAsBK,GAE5C,MAAO,CACLxF,MAAO,CACL2F,OAAQJ,EACRX,KAAQa,EAAgBb,KACxBC,OAAQY,EAAgBZ,QAE1B9F,IAAK,CACH4G,OAAQH,EACRZ,KAAQc,EAAcd,KACtBC,OAAQa,EAAcb,SAK5B,SAASe,GAASjI,GACZ+G,GAAcI,KAEdJ,GAAcI,KAChBA,GAAiBJ,GACjBK,GAAsB,IAGxBA,GAAoB/8B,KAAK21B,IAO3B,SAASkI,GAAyBlI,EAAUC,EAAO55B,GACjD,OAAO,IAAI05B,EACTA,EAAgBU,aAAaT,EAAUC,GACvCD,EACAC,EACA55B,GAIJ,SAASi8B,KACP,IAAI6F,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAMxB,GAJAL,EAAKpB,GACLqB,EAAK,GACLC,EAAKtB,IACLuB,EAAKG,QACMtG,EAAY,CAGrB,IAFAoG,EAAK,GACLC,EAAKE,KACEF,IAAOrG,GACZoG,EAAGl+B,KAAKm+B,GACRA,EAAKE,KAEHH,IAAOpG,EAETkG,EADAC,EAAK,CAACA,EAAIC,IAGVxB,GAAcsB,EACdA,EAAKlG,QAGP4E,GAAcsB,EACdA,EAAKlG,EAEP,KAAOkG,IAAOlG,GAIZ,GAHAiG,EAAG/9B,KAAKg+B,GACRA,EAAKtB,IACLuB,EAAKG,QACMtG,EAAY,CAGrB,IAFAoG,EAAK,GACLC,EAAKE,KACEF,IAAOrG,GACZoG,EAAGl+B,KAAKm+B,GACRA,EAAKE,KAEHH,IAAOpG,EAETkG,EADAC,EAAK,CAACA,EAAIC,IAGVxB,GAAcsB,EACdA,EAAKlG,QAGP4E,GAAcsB,EACdA,EAAKlG,EAkBT,OAfIiG,IAAOjG,IACTkG,EAiHJ,WACE,IAAIF,EAAIC,EAERD,EAAKpB,GACLM,KACIpF,EAAMj4B,OAAS+8B,IACjBqB,EAAKnG,EAAM0G,OAAO5B,IAClBA,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAAS/E,IAExCmE,KACIe,IAAOjG,EACTgG,OAAK,GAELpB,GAAcoB,EACdA,EAAKhG,GAGP,OAAOgG,EArIAS,MACMzG,GACMgG,EAEfA,EADAC,EAAYA,EA7RmBt+B,KAAI,SAAS++B,GAAK,OAAOA,EAAE,QAoS5D9B,GAAcoB,EACdA,EAAKhG,GAGAgG,EAGT,SAASM,KACP,IAAIN,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIM,EAAIC,EAOhC,GALAZ,EAAKpB,IACLqB,EAkYF,WACE,IAAID,EAAIC,EAAIC,EAKZ,GAHAF,EAAKpB,GACLqB,EAAK,IACLC,EAAKW,QACM7G,EACT,KAAOkG,IAAOlG,GACZiG,EAAG/9B,KAAKg+B,GACRA,EAAKW,UAGPZ,EAAKjG,EAEHiG,IAAOjG,IACMgG,EACfC,EAAaA,GAIf,OAFAD,EAAKC,EApZAa,MACM9G,IACTiG,EAAK,MAEHA,IAAOjG,EAKT,IAJAkG,EAAKa,QACM/G,IACTkG,EAAK,MAEHA,IAAOlG,EAAY,CAGrB,IAFAmG,EAAK,GACLC,EAAKY,KACEZ,IAAOpG,GACZmG,EAAGj+B,KAAKk+B,GACRA,EAAKY,KAEP,GAAIb,IAAOnG,EAAY,CAGrB,GAFAoG,EAAKxB,IACLyB,EAAKY,QACMjH,EAAY,CAGrB,GAFA2G,EAAK,IACLC,EAAKI,QACMhH,EACT,KAAO4G,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,UAGPL,EAAK3G,EAEH2G,IAAO3G,IACT4G,EAAKM,QACMlH,GACMoG,EAEfA,EADAC,EAhV4B,CAgVRA,EAAIO,KAO1BhC,GAAcwB,EACdA,EAAKpG,QAGP4E,GAAcwB,EACdA,EAAKpG,EAWP,GATIoG,IAAOpG,IACToG,EAAKxB,IACLyB,EAAKa,QACMlH,IACMoG,EACfC,EAlWC,SAAS/F,EAAGC,EAAGE,GAAI,MAAO,CAAC,KAAMA,GAkW7B0G,CAAOlB,EAAIC,EAAIG,IAEtBD,EAAKC,GAEHD,IAAOpG,EAAY,CAGrB,IAFAqG,EAAK,GACLM,EAAKK,KACEL,IAAO3G,GACZqG,EAAGn+B,KAAKy+B,GACRA,EAAKK,KAEHX,IAAOrG,GACMgG,EAEfA,EADAC,EAAK5F,EAAO4F,EAAIC,EAAIE,KAGpBxB,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EA0BT,SAASoB,KACP,IAAIpB,EAUJ,OARsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EAjaS,IAkaTpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS9E,IAGjCgF,EAiDT,SAASqB,KACP,IAAIrB,EAAIC,EAAIC,EAAIC,EAUhB,GARAH,EAAKpB,GACDvD,EAAQiG,KAAKxH,EAAM0G,OAAO5B,MAC5BqB,EAAKnG,EAAM0G,OAAO5B,IAClBA,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAASxE,IAEpC2E,IAAOjG,EAAY,CASrB,IARAkG,EAAK,GACD3E,EAAQ+F,KAAKxH,EAAM0G,OAAO5B,MAC5BuB,EAAKrG,EAAM0G,OAAO5B,IAClBA,OAEAuB,EAAKnG,EACmB,IAApBkF,IAAyBY,GAAStE,IAEjC2E,IAAOnG,GACZkG,EAAGh+B,KAAKi+B,GACJ5E,EAAQ+F,KAAKxH,EAAM0G,OAAO5B,MAC5BuB,EAAKrG,EAAM0G,OAAO5B,IAClBA,OAEAuB,EAAKnG,EACmB,IAApBkF,IAAyBY,GAAStE,IAGtC0E,IAAOlG,GACMgG,EAEfA,EADAC,EAhf+Bne,SAgflBme,EAAIC,EAhf2BjrB,KAAK,IAAK,MAmftD2pB,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EAsCT,SAASuB,KACP,IAAIvB,EA4BJ,OA1BsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EAjiBU,IAkiBVpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASjE,IAEpCmE,IAAOhG,IAC6B,KAAlCF,EAAMT,WAAWuF,KACnBoB,EAviBQ,KAwiBRpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAShE,IAEpCkE,IAAOhG,IAC6B,IAAlCF,EAAMT,WAAWuF,KACnBoB,EA7iBM,KA8iBNpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS/D,MAKrCiE,EAGT,SAASgB,KACP,IAAIhB,EAOJ,OALAA,EAAKuB,QACMvH,IACTgG,EAAKO,MAGAP,EAGT,SAASO,KACP,IAAIP,EAUJ,OARsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EAtkBU,KAukBVpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS9D,IAGjCgE,EAGT,SAASa,KACP,IAAIb,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIM,EAAIC,EAUhC,GARAZ,EAAKpB,GACiC,KAAlC9E,EAAMT,WAAWuF,KACnBqB,EAnlBU,IAolBVrB,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAAS7D,IAEpCgE,IAAOjG,EAET,IADAkG,EAxGJ,WACE,IAAIF,EAAIC,EAAIC,EAWZ,GATAF,EAAKpB,GACLqB,EAAK,GACDxE,EAAQ6F,KAAKxH,EAAM0G,OAAO5B,MAC5BsB,EAAKpG,EAAM0G,OAAO5B,IAClBA,OAEAsB,EAAKlG,EACmB,IAApBkF,IAAyBY,GAASpE,IAEpCwE,IAAOlG,EACT,KAAOkG,IAAOlG,GACZiG,EAAG/9B,KAAKg+B,GACJzE,EAAQ6F,KAAKxH,EAAM0G,OAAO5B,MAC5BsB,EAAKpG,EAAM0G,OAAO5B,IAClBA,OAEAsB,EAAKlG,EACmB,IAApBkF,IAAyBY,GAASpE,SAI1CuE,EAAKjG,EAQP,OANIiG,IAAOjG,IACMgG,EACfC,EAAKtE,EAAQsE,IAEfD,EAAKC,EA0EEuB,MACMxH,EAAY,CAGrB,GAFAmG,EAAK,IACLC,EAAKmB,QACMvH,EACT,KAAOoG,IAAOpG,GACZmG,EAAGj+B,KAAKk+B,GACRA,EAAKmB,UAGPpB,EAAKnG,EAEP,GAAImG,IAAOnG,EAET,IADAoG,EAjNR,WACE,IAAIJ,EAAQE,EAAIC,EAIhB,GAFAH,EAAKpB,GACAwC,OACMpH,EAAY,CASrB,IARAkG,EAAK,GACDhF,EAAOoG,KAAKxH,EAAM0G,OAAO5B,MAC3BuB,EAAKrG,EAAM0G,OAAO5B,IAClBA,OAEAuB,EAAKnG,EACmB,IAApBkF,IAAyBY,GAAS3E,IAEjCgF,IAAOnG,GACZkG,EAAGh+B,KAAKi+B,GACJjF,EAAOoG,KAAKxH,EAAM0G,OAAO5B,MAC3BuB,EAAKrG,EAAM0G,OAAO5B,IAClBA,OAEAuB,EAAKnG,EACmB,IAApBkF,IAAyBY,GAAS3E,IAGtC+E,IAAOlG,IACTmG,EAAKiB,QACMpH,GACMgG,EAEfA,EADYE,EAncmBjrB,KAAK,MA0ctC2pB,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EAsKIyB,MACMzH,EAQT,GAPsC,KAAlCF,EAAMT,WAAWuF,KACnByB,EAxmBE,IAymBFzB,OAEAyB,EAAKrG,EACmB,IAApBkF,IAAyBY,GAAS5D,IAEpCmE,IAAOrG,EAAY,CAGrB,IAFA2G,EAAK,GACLC,EAAKI,KACEJ,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,KAEHL,IAAO3G,GACMgG,EAEfA,EADAC,EA8gCV,SAAqByB,EAAGC,GACpB,IAAIjQ,EAAI,GAER,OADAA,EAAEgQ,GAAMC,EACDjQ,EAtoDyBkQ,CAqnBb1B,EAAIE,KAGjBxB,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EA0BT,SAAS6B,KACP,IAAI7B,EAUJ,OARI7D,EAAQmF,KAAKxH,EAAM0G,OAAO5B,MAC5BoB,EAAKlG,EAAM0G,OAAO5B,IAClBA,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS1D,IAGjC4D,EAGT,SAAS8B,KACP,IAAI9B,EAUJ,OARI3D,EAAQiF,KAAKxH,EAAM0G,OAAO5B,MAC5BoB,EAAKlG,EAAM0G,OAAO5B,IAClBA,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASxD,IAGjC0D,EAGT,SAAS+B,KACP,IAAI/B,EAUJ,OARIzD,EAAQ+E,KAAKxH,EAAM0G,OAAO5B,MAC5BoB,EAAKlG,EAAM0G,OAAO5B,IAClBA,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAStD,IAGjCwD,EA+BT,SAASgC,KACP,IAAIhC,EAUJ,OARIrD,EAAQ2E,KAAKxH,EAAM0G,OAAO5B,MAC5BoB,EAAKlG,EAAM0G,OAAO5B,IAClBA,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASlD,IAGjCoD,EAGT,SAASiC,KACP,IAAIjC,EAUJ,OARsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EApvBU,IAqvBVpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASjD,IAGjCmD,EAGT,SAASkB,KACP,IAAIlB,EAqCJ,MAlyBY,QA+vBRlG,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAhwBU,MAiwBVpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAShD,IAEpCkD,IAAOhG,IApwBC,QAqwBNF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAtwBQ,MAuwBRpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS/C,IAEpCiD,IAAOhG,IAC6B,KAAlCF,EAAMT,WAAWuF,KACnBoB,EA5wBM,IA6wBNpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS9C,IAEpCgD,IAAOhG,IAhxBH,YAixBFF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAlxBI,UAmxBJpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS7C,OAMvC+C,EAoDT,SAASmC,KACP,IAAInC,EAAIC,EAAIC,EAmBZ,OAjBAF,EAAKpB,IACLqB,EAAK6B,QACM9H,IACTkG,EAAK6B,QACM/H,GACMgG,EAEfA,EADAC,EAAaA,EAAIC,IAOnBtB,GAAcoB,EACdA,EAAKhG,GAGAgG,EAqCT,SAASoC,KACP,IAAIpC,EAAIC,EAAIC,EAAIC,EA8BhB,OA5BAH,EAAKpB,GACLqB,EAAKrB,GACiC,KAAlC9E,EAAMT,WAAWuF,KACnBsB,EAv4BU,IAw4BVtB,OAEAsB,EAAKlG,EACmB,IAApBkF,IAAyBY,GAASzC,IAEpC6C,IAAOlG,IACTmG,EAAKkB,QACMrH,EAETiG,EADAC,EAAK,CAACA,EAAIC,IAOZvB,GAAcqB,EACdA,EAAKjG,GAEHiG,IAAOjG,IACMgG,EACfC,EAAKtE,EAAQsE,IAEfD,EAAKC,EA4FP,SAASoC,KACP,IAAIrC,EAUJ,OARIpC,EAAQ0D,KAAKxH,EAAM0G,OAAO5B,MAC5BoB,EAAKlG,EAAM0G,OAAO5B,IAClBA,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASjC,IAGjCmC,EAGT,SAASe,KACP,IAAIf,EAAIC,EAAIC,EAAIC,EAUhB,GARAH,EAAKpB,GACiC,MAAlC9E,EAAMT,WAAWuF,KACnBqB,EA7/BU,IA8/BVrB,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAAShC,IAEpCmC,IAAOjG,EAAY,CAGrB,IAFAkG,EAAK,GACLC,EAAKkC,KACElC,IAAOnG,GACZkG,EAAGh+B,KAAKi+B,GACRA,EAAKkC,KAEHnC,IAAOlG,GAC6B,MAAlCF,EAAMT,WAAWuF,KACnBuB,EA1gCM,IA2gCNvB,OAEAuB,EAAKnG,EACmB,IAApBkF,IAAyBY,GAAS/B,IAEpCoC,IAAOnG,GACMgG,EAEfA,EADAC,EAAaC,EAhhCiBjrB,KAAK,MAmhCnC2pB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EAGT,SAASsC,KACP,IAAItC,EAAIC,EAAIC,EAAIC,EA4ChB,OA1CAH,EAAKpB,GACLqB,EAAKrB,IACLsB,EAAK4B,QACM9H,IACTmG,EAAK6B,QACMhI,EAETiG,EADAC,EAAK,CAACA,EAAIC,IAOZvB,GAAcqB,EACdA,EAAKjG,GAEHiG,IAAOjG,IACTiG,EAAK,MAEHA,IAAOjG,IACTkG,EAAKiC,QACMnI,IACTmG,EAhPN,WACE,IAAIH,EAAIC,EAAIC,EA8BZ,OA5BAF,EAAKpB,GACiC,KAAlC9E,EAAMT,WAAWuF,KACnBqB,EAx2BU,IAy2BVrB,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAAS5C,IAEpC+C,IAAOjG,GACLmD,EAAQmE,KAAKxH,EAAM0G,OAAO5B,MAC5BsB,EAAKpG,EAAM0G,OAAO5B,IAClBA,OAEAsB,EAAKlG,EACmB,IAApBkF,IAAyBY,GAAS1C,IAEpC8C,IAAOlG,EAETgG,EADAC,EAAK,CAACA,EAAIC,IAGVtB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,GAGAgG,EAiNEuC,MACMvI,IACTmG,EAAK,MAEHA,IAAOnG,EAETgG,EADAC,EAAK,CAACA,EAAIC,EAAIC,IAGdvB,GAAcoB,EACdA,EAAKhG,KAOT4E,GAAcoB,EACdA,EAAKhG,GAGAgG,EAiGT,SAASwC,KACP,IAAIxC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAyDxB,OAvDAL,EAAKpB,GACLqB,EAAKrB,IACLsB,EA3OF,WACE,IAAIF,EAAIC,EAAIC,EAAIC,EAwBhB,OAtBAH,EAAKpB,IACLqB,EAAKgC,QACMjI,IACTkG,EAAK+B,QACMjI,IACTmG,EAAK8B,QACMjI,EAETgG,EADAC,EAAK,CAACA,EAAIC,EAAIC,IAWlBvB,GAAcoB,EACdA,EAAKhG,GAGAgG,EAkNFyC,MACMzI,IACTkG,EAAK,MAEHA,IAAOlG,IACTmG,EAjCJ,WACE,IAAIH,EAmBJ,MA5qCY,UA2pCRlG,EAAMoI,OAAOtD,GAAa,IAC5BoB,EA5pCU,QA6pCVpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS9B,KAEpCgC,IAAOhG,IAhqCC,QAiqCNF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAlqCQ,MAmqCRpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAS7B,MAInC+B,EAaA0C,MACM1I,IACTmG,EA3EN,WACE,IAAIH,EAAIC,EAAIC,EAAIC,EAAIC,EAoCpB,OAlCAJ,EAAKpB,IACLqB,EAAK4B,QACM7H,IACTkG,EAAK4B,QACM9H,IACTkG,EAAK6B,MAEH7B,IAAOlG,IACTmG,EAAK6B,QACMhI,IACTmG,EAAK,MAEHA,IAAOnG,IACToG,EAAK+B,QACMnI,EAETgG,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAOpBxB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,GAGAgG,EAsCE2C,MACM3I,IACTmG,EA5GR,WACE,IAAIH,EAAIC,EAAIC,EAAIC,EA2BhB,OAzBAH,EAAKpB,IACLqB,EAAK4B,QACM7H,IACTkG,EAAK8B,QACMhI,IACTkG,EAAK,MAEHA,IAAOlG,IACTmG,EAAKgC,QACMnI,EAETgG,EADAC,EAAK,CAACA,EAAIC,EAAIC,IAOhBvB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,GAGAgG,EAgFI4C,MACM5I,IACTmG,EAAKmC,MAIPnC,IAAOnG,IACToG,EAniBN,WACE,IAAIJ,EAUJ,OARsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EAhtBU,IAitBVpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASrD,IAGjCuD,EAwhBE6C,MACM7I,IACToG,EAvhBR,WACE,IAAIJ,EAUJ,OARsC,KAAlClG,EAAMT,WAAWuF,KACnBoB,EA5tBU,IA6tBVpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASpD,IAGjCsD,EA4gBI8C,IAEH1C,IAAOpG,IACToG,EAAK,MAEHA,IAAOpG,IACTqG,EA9TR,WACE,IAAIL,EAuDJ,MAz9BY,OAo6BRlG,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAr6BU,KAs6BVpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASxC,IAEpC0C,IAAOhG,IAz6BC,OA06BNF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EA36BQ,KA46BRpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASvC,IAEpCyC,IAAOhG,IA/6BD,OAg7BJF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAj7BM,KAk7BNpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAAStC,IAEpCwC,IAAOhG,IAr7BH,OAs7BFF,EAAMoI,OAAOtD,GAAa,IAC5BoB,EAv7BI,KAw7BJpB,IAAe,IAEfoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASrC,IAEpCuC,IAAOhG,IAC6B,KAAlCF,EAAMT,WAAWuF,KACnBoB,EA77BE,IA87BFpB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASpC,IAEpCsC,IAAOhG,IAC6B,KAAlCF,EAAMT,WAAWuF,KACnBoB,EAn8BA,IAo8BApB,OAEAoB,EAAKhG,EACmB,IAApBkF,IAAyBY,GAASnC,SAQ3CqC,EAsQI+C,MACM/I,IACTqG,EAAK,MAEHA,IAAOrG,EAETiG,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAGlBzB,GAAcqB,EACdA,EAAKjG,KAGP4E,GAAcqB,EACdA,EAAKjG,KAGP4E,GAAcqB,EACdA,EAAKjG,KAGP4E,GAAcqB,EACdA,EAAKjG,GAEHiG,IAAOjG,IACMgG,EACfC,EAAK/B,GAAQ+B,IAEfD,EAAKC,EAKP,SAAS+C,KACP,IAAIhD,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIM,EAAIC,EAAIqC,EAAIC,EAOxC,GALAlD,EAAKpB,IACLqB,EA9eF,WACE,IAAID,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EA6CxB,OA3CAL,EAAKpB,IACLqB,EAAKoB,QACMrH,IACTkG,EAAK+B,QACMjI,IACTkG,EAAK,MAEHA,IAAOlG,GACTmG,EAAKvB,IACLwB,EAAK6B,QACMjI,IACTqG,EAAK4B,QACMjI,EAETmG,EADAC,EAAK,CAACA,EAAIC,IAOZzB,GAAcuB,EACdA,EAAKnG,GAEHmG,IAAOnG,IACTmG,EAAK,MAEHA,IAAOnG,GACMgG,EAEfA,EADAC,EAAaA,IAGbrB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,GAGAgG,EAgcFmD,MACMnJ,IACTiG,EAAK,MAEHA,IAAOjG,EAAY,CAGrB,IAFAkG,EAAK,GACLC,EAAKa,KACEb,IAAOnG,GACZkG,EAAGh+B,KAAKi+B,GACRA,EAAKa,KAEP,GAAId,IAAOlG,EAET,IADAmG,EAAKqC,QACMxI,EAAY,CAKrB,GAJAoG,EAAK,GACLC,EAAKzB,GACL+B,EAAK,IACLC,EAAKI,QACMhH,EACT,KAAO4G,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,UAGPL,EAAK3G,EAgBP,IAdI2G,IAAO3G,IACT4G,EAAKwB,QACMpI,GACMqG,EAEfA,EADAM,EAAKtC,GAAQ4B,EAAIE,EAAIS,KAOvBhC,GAAcyB,EACdA,EAAKrG,GAEAqG,IAAOrG,GAAY,CAKxB,GAJAoG,EAAGl+B,KAAKm+B,GACRA,EAAKzB,GACL+B,EAAK,IACLC,EAAKI,QACMhH,EACT,KAAO4G,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,UAGPL,EAAK3G,EAEH2G,IAAO3G,IACT4G,EAAKwB,QACMpI,GACMqG,EAEfA,EADAM,EAAKtC,GAAQ4B,EAAIE,EAAIS,KAOvBhC,GAAcyB,EACdA,EAAKrG,GAGT,GAAIoG,IAAOpG,EAAY,CAIrB,GAHAqG,EAAKzB,GACL+B,EAAK,IACLC,EAAKI,QACMhH,EACT,KAAO4G,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,UAGPL,EAAK3G,EAmBP,GAjBI2G,IAAO3G,IACT4G,EAAKG,QACM/G,GACMqG,EAEfA,EADAM,EAAyBC,IAO3BhC,GAAcyB,EACdA,EAAKrG,GAEHqG,IAAOrG,IACTqG,EAAK,MAEHA,IAAOrG,EAAY,CAKrB,GAJA2G,EAAK,GACLC,EAAKhC,GACLqE,EAAK,IACLC,EAAKlC,QACMhH,EACT,KAAOkJ,IAAOlJ,GACZiJ,EAAG/gC,KAAKghC,GACRA,EAAKlC,UAGPiC,EAAKjJ,EAgBP,IAdIiJ,IAAOjJ,IACTkJ,EAAKE,QACMpJ,GACM4G,EAEfA,EADAqC,EAAK1E,GAAQ0B,EAAIE,EAAIC,EAAIC,EAAI6C,KAO/BtE,GAAcgC,EACdA,EAAK5G,GAEA4G,IAAO5G,GAAY,CAKxB,GAJA2G,EAAGz+B,KAAK0+B,GACRA,EAAKhC,GACLqE,EAAK,IACLC,EAAKlC,QACMhH,EACT,KAAOkJ,IAAOlJ,GACZiJ,EAAG/gC,KAAKghC,GACRA,EAAKlC,UAGPiC,EAAKjJ,EAEHiJ,IAAOjJ,IACTkJ,EAAKE,QACMpJ,GACM4G,EAEfA,EADAqC,EAAK1E,GAAQ0B,EAAIE,EAAIC,EAAIC,EAAI6C,KAO/BtE,GAAcgC,EACdA,EAAK5G,GAGL2G,IAAO3G,GACMgG,EAEfA,EADAC,EA2MV,SAAmBlmB,EAAahB,EAAMylB,EAAM6E,EAAMxI,GAC9C,IAAInJ,EAAI,GAMR,OALI3X,IAAa2X,EAAE3X,YAAcA,GAC7BhB,IAAM2Y,EAAE3Y,KAAOA,GACfylB,GAAQA,EAAK38B,SAAQ6vB,EAAE8M,KAAOA,GAC9B6E,GAAQA,EAAKxhC,SAAQ6vB,EAAE2R,KAAOA,GAC9BxI,IAASnJ,EAAEmJ,QAAUA,GAClBnJ,EAplDwC4R,CAk4C5BrD,EAAIE,EAAIC,EAAQO,EAAJN,KAGzBzB,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EAGT,SAASiB,KACP,IAAIjB,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAh6CHkD,EAAOC,EAo6C5B,GAFAxD,EAAKpB,IACLqB,EAAK+C,QACMhJ,EAAY,CAKrB,GAJAkG,EAAK,GACLC,EAAKvB,GACLwB,EAAK,IACLC,EAAKW,QACMhH,EACT,KAAOqG,IAAOrG,GACZoG,EAAGl+B,KAAKm+B,GACRA,EAAKW,UAGPZ,EAAKpG,EAeP,IAbIoG,IAAOpG,IACTqG,EAAK2C,QACMhJ,EAETmG,EADAC,EAAK,CAACA,EAAIC,IAOZzB,GAAcuB,EACdA,EAAKnG,GAEAmG,IAAOnG,GAAY,CAKxB,GAJAkG,EAAGh+B,KAAKi+B,GACRA,EAAKvB,GACLwB,EAAK,IACLC,EAAKW,QACMhH,EACT,KAAOqG,IAAOrG,GACZoG,EAAGl+B,KAAKm+B,GACRA,EAAKW,UAGPZ,EAAKpG,EAEHoG,IAAOpG,IACTqG,EAAK2C,QACMhJ,EAETmG,EADAC,EAAK,CAACA,EAAIC,IAOZzB,GAAcuB,EACdA,EAAKnG,GAGLkG,IAAOlG,GACMgG,EA19CSwD,EA29CPtD,EACjBF,EADAC,GA39CiBsD,EA29CJtD,GA39CiC,CAACsD,GAAOE,OAAOD,EAAK7hC,KAAI,SAAS+vB,GAAI,OAAOA,EAAE,OAAQ,KA89CpGkN,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EAGT,SAASoD,KACP,IAAIpD,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIM,EAAIC,EAUhC,GARAZ,EAAKpB,GACiC,KAAlC9E,EAAMT,WAAWuF,KACnBqB,EA7+CU,IA8+CVrB,OAEAqB,EAAKjG,EACmB,IAApBkF,IAAyBY,GAASpB,KAEpCuB,IAAOjG,EAAY,CAGrB,IAFAkG,EAAK,GACLC,EAAKa,KACEb,IAAOnG,GACZkG,EAAGh+B,KAAKi+B,GACRA,EAAKa,KAEP,GAAId,IAAOlG,EAET,IADAmG,EAAKc,QACMjH,EAAY,CAGrB,IAFAoG,EAAK,GACLC,EAAKW,KACEX,IAAOrG,GACZoG,EAAGl+B,KAAKm+B,GACRA,EAAKW,KAEP,GAAIZ,IAAOpG,EAKT,IAJAqG,EAAKa,QACMlH,IACTqG,EAAK,MAEHA,IAAOrG,EAAY,CAGrB,IAFA2G,EAAK,GACLC,EAAKI,KACEJ,IAAO5G,GACZ2G,EAAGz+B,KAAK0+B,GACRA,EAAKI,KAEHL,IAAO3G,GAC6B,KAAlCF,EAAMT,WAAWuF,KACnBgC,EA/gDF,IAghDEhC,OAEAgC,EAAK5G,EACmB,IAApBkF,IAAyBY,GAASnB,KAEpCiC,IAAO5G,GACMgG,EAEfA,EADAC,EA4DD,CACHpnB,MA7DiBsnB,EA8DjBn8B,OA9DqBq8B,KAGjBzB,GAAcoB,EACdA,EAAKhG,KAGP4E,GAAcoB,EACdA,EAAKhG,QAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,OAGP4E,GAAcoB,EACdA,EAAKhG,EAGP,OAAOgG,EA+CT,IAFAjG,EAAaK,OAEMJ,GAAc4E,KAAgB9E,EAAMj4B,OACrD,OAAOk4B,EAMP,MAJIA,IAAeC,GAAc4E,GAAc9E,EAAMj4B,QACnDi+B,GA/iDK,CAAEt8B,KAAM,QAkjDTu8B,GACJd,GACAD,GAAiBlF,EAAMj4B,OAASi4B,EAAM0G,OAAOxB,IAAkB,KAC/DA,GAAiBlF,EAAMj4B,OACnB29B,GAAoBR,GAAgBA,GAAiB,GACrDQ,GAAoBR,GAAgBA,S","file":"static/js/main.34c95b35.chunk.js","sourcesContent":["import ReactGA from 'react-ga';\nReactGA.initialize('UA-159149755-1');\n\nexport function trackPageView() {\n    ReactGA.pageview(window.location.pathname);\n}\n\nexport function trackEvent(category, action, label, value) {\n    ReactGA.event({\n        category: category,\n        action: action,\n        label: label,\n        value: value\n      })\n}","export const TIME_CONTROL_ULTRA_BULLET = \"ultraBullet\"\nexport const TIME_CONTROL_BULLET = \"bullet\"\nexport const TIME_CONTROL_BLITZ = \"blitz\"\nexport const TIME_CONTROL_RAPID = \"rapid\"\nexport const TIME_CONTROL_CLASSICAL = \"classical\"\nexport const TIME_CONTROL_CORRESPONDENCE = \"correspondence\"\nexport const TIME_CONTROL_DAILY = \"daily\"\nexport const FILTER_NAME_RATED = \"rated\"\nexport const FILTER_NAME_SELECTED_TIMEFRAME = \"selectedTimeframe\"\nexport const FILTER_NAME_DOWNLOAD_LIMIT = \"downloadLimit\"\nexport const FILTER_NAME_ELO_RANGE = \"eloRange\"\n\nexport const SITE_LICHESS = \"lichess\"\nexport const SITE_CHESS_DOT_COM = \"chesscom\"\nexport const SITE_PGN_FILE = \"pgnfile\"\nexport const SITE_EVENT_DB = \"eventdb\"\nexport const SITE_PLAYER_DB = \"playerdb\"\nexport const SITE_OPENING_TREE_FILE = \"opntfile\"\n\nexport const MAX_DOWNLOAD_LIMIT = 2000\nexport const MAX_ELO_RATING = 3000\n\nexport const EVENT_CATEGORY_PGN_LOADER = \"loader\"\nexport const EVENT_CATEGORY_MOVES_LIST = \"moves\"\nexport const EVENT_CATEGORY_CONTROLS = \"controls\"\nexport const EVENT_CATEGORY_NAVIGATOR = \"navigator\"\nexport const EVENT_CATEGORY_CHESSBOARD = \"chessboard\"\nexport const EVENT_CATEGORY_ERROR = \"error\"\nexport const EVENT_CATEGORY_MESSAGE_SHOWN = \"message\"\n\nexport const ROOT_FEN = \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\"\n\nexport const PLAYER_COLOR_WHITE = 'white'\nexport const PLAYER_COLOR_BLACK = 'black'\n\nexport const LOADER_ANIMATION_DURATION_MS = 500\n\nexport const OPENING_TREE_EMAIL = 'feedback@openingtree.com'\nexport const OPENNIG_TREE_REDDIT = 'opening_tree'\nexport const OPENING_TREE_LICHESS = 'vannooz'\nexport const OPENING_TREE_CHESS_COM = 'vannooz'\nexport const OPENING_TREE_DISCORD = 'https://discord.gg/hCwKkN8'\n\nexport const OPENING_TREE_FILE_CURRENT_VERSION = 2\n\nexport const ERROR_ACTION_REPORT = 'report'\nexport const ERROR_ACTION_VISIT_OLD_SITE = 'visitOld'","import zlib from 'zlib'\nimport {Buffer} from 'buffer'\nimport { saveAs } from 'file-saver';\n\nexport function serializeOpeningTree(treeData, filename, callback) {\n    let chunkedArray = chunk(treeData)\n    let deflatedChunks = []\n    //push version number 1 for later backward compatibility\n    deflatedChunks.push(packControlWord(0x1))\n    deflatedChunks.push(packControlWord(chunkedArray.length))\n    let remainingChunks = chunkedArray.length\n    let hasError = false;\n    chunkedArray.forEach((chunk)=>{\n        zlib.deflate(\n            new Buffer(JSON.stringify(chunk)), \n            (error,data)=>{\n                remainingChunks--\n                if(error) {\n                    hasError = true\n                }\n                deflatedChunks.push(packControlWord(data.byteLength))\n                deflatedChunks.push(data)\n                if(remainingChunks<=0) {\n                    if(hasError) {\n                        callback(\"Could not save file\")\n                        return\n                    }\n                    saveAs(new Blob(deflatedChunks, {type: \"application/octet-stream\"}), filename)\n                    callback(null, `Saved opening tree to file ${filename}`)\n                }\n            });\n        })\n}\n\nexport function deserializeOpeningTree(file, callback) {\n    let reader = new FileReader()\n    reader.onload = function(evt) {\n        let data = evt.target.result\n        let index = 0\n        let version = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        if(version !== 0x1) {\n            callback(\"File is not an openingtree save file.\", null,\"Are you loading the correct file?\")\n            return\n        }\n        let numChunks = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        if(!numChunks) {\n            callback(\"Input file not in correct format\", null)\n            return\n        }\n        getInflatedChunks(data, index, numChunks, callback)\n    };\n    reader.onerror = function(e) {\n        callback(\"Failed to read openingtree file\", null, `${e.target.error.name}:${e.target.error.message}`)\n    }\n    reader.readAsArrayBuffer(file)\n}\n\nfunction getInflatedChunks(data, startIndex, numChunks, callback) {\n    let index = startIndex\n    let deflatedChunks = []\n    let remainingChunks = numChunks\n    let hasError=false\n    let handleInflate = (error, data)=> {\n        remainingChunks--\n        if(error) {\n            console.log(error)\n            hasError=true\n        }\n        try {\n            deflatedChunks.push(JSON.parse(data))\n        } catch (e) {\n            console.log(e)\n            hasError=true\n        }\n        if(remainingChunks===0) {\n            if(hasError) {\n                callback(\"Input file seems corrupted\", null)\n            }\n            \n            callback(null, reconstructObjectFromChunks(deflatedChunks))\n        }\n        \n    }\n    while(numChunks>0) {\n        let chunkSize = unpackControlWord(data.slice(index,index+8))\n        index = index + 8\n        zlib.inflate(\n            Buffer.from(data,index,chunkSize), handleInflate)\n        index = index + chunkSize\n        numChunks--\n    }\n}\n\nfunction reconstructObjectFromChunks(deflatedChunks) {\n    let sortedChunks = deflatedChunks.sort((a,b)=>a.index-b.index)\n    let flattenedChunks = sortedChunks.slice(1).map(el=>el.chunk).flat()\n    let header = sortedChunks[0]\n    let arrays = []\n    let index = 0\n    header.arraySizes.forEach((size)=>{\n        arrays.push(flattenedChunks.slice(index,index+size))\n        index+=size\n    })\n    return {\n        header:header.chunk,\n        arrays:arrays\n    }\n}\n\nfunction unpackControlWord(control) {\n    let view = new DataView(control)\n    if(view.getUint16(0)!==0x1337 || view.getUint16(6)!==0xC0D3) {\n        return null\n    }\n    return view.getUint32(2)\n}\n\nfunction packControlWord(control) {\n    var buffer = new ArrayBuffer(8); \n    var view = new DataView(buffer); \n    view.setUint16(0, 0x1337)\n    view.setUint32(2, control>>>0)\n    view.setUint16(6, 0xC0D3)\n    return buffer\n}\n\nfunction chunk(treeData) {\n    let chunk1 = {chunk:treeData.header, index:0, \n        arraySizes:treeData.arrays.map(arr=>arr.length)}\n    let chunks = [chunk1]\n    treeData.arrays.forEach((array)=>{\n        Array.prototype.push.apply(chunks, chunkArray(array, 1000, chunks.length));\n    })\n    return chunks\n}\n\nfunction chunkArray(array, chunkSize, startIndex) {\n    let chunkedArray=[]\n    \n    for (let i=0, chunkIndex=1; i<array.length; i+=chunkSize, chunkIndex++) {\n        chunkedArray.push({chunk:array.slice(i,i+chunkSize), index:startIndex+chunkIndex});\n    }\n    return chunkedArray\n}\n","import { withStyles } from '@material-ui/core/styles';\nimport MuiExpansionPanel from '@material-ui/core/ExpansionPanel';\nimport React from 'react'\nimport { createSubObjectWithProperties } from '../../app/util'\nimport * as Constants from '../../app/Constants'\n\nexport const ExpansionPanel = withStyles({\n    root: {\n        border: '1px solid rgba(0, 0, 0, .125)',\n        boxShadow: 'none',\n        '&:not(:last-child)': {\n            borderBottom: 0,\n        },\n        '&:before': {\n            display: 'none',\n        },\n        '&$expanded': {\n            margin: 'auto',\n        },\n    },\n    expanded: {},\n})(MuiExpansionPanel);\n\nexport function getNumberIcon(n) {\n    return <img alt={`step ${n}`} className = 'lowOpacity styledNumbers' src={`/images/styled-${n}.png`} height={24}/>\n}\n\nexport function advancedFilters(state) {\n    return createSubObjectWithProperties(state,\n        [Constants.TIME_CONTROL_ULTRA_BULLET, Constants.TIME_CONTROL_BULLET,\n        Constants.TIME_CONTROL_BLITZ, Constants.TIME_CONTROL_RAPID,\n        Constants.TIME_CONTROL_CORRESPONDENCE, Constants.TIME_CONTROL_DAILY,\n        Constants.TIME_CONTROL_CLASSICAL, Constants.FILTER_NAME_RATED,\n        Constants.FILTER_NAME_SELECTED_TIMEFRAME, Constants.FILTER_NAME_DOWNLOAD_LIMIT,\n        Constants.FILTER_NAME_ELO_RANGE])\n}\n\nexport function copyText(elementId) {\n    /* Get the text field */\n    var copyText = document.getElementById(elementId);\n    try {\n        /* Select the text field */\n        copyText.select();\n        copyText.setSelectionRange(0, 99999); /*For mobile devices*/\n\n        /* Copy the text inside the text field */\n        document.execCommand(\"copy\");\n        return true\n    } catch(e) {\n        return false\n    }\n}","import * as Constants from '../app/Constants'\nimport * as Common from '../app/Common'\n\nexport function createSubObjectWithProperties(mainObject, properties) {\n    let subObject = {}\n    properties.forEach(property => {\n        subObject[property] = mainObject[property]\n    });\n    return subObject\n}\nexport function simplifiedFen(fen) {\n    let fenComponents = fen.split(' ')\n    if(fenComponents.length <=4) {\n        return fen\n    }\n    //exclude move and halfMove components\n    return `${fenComponents[0]} ${fenComponents[1]} ${fenComponents[2]}`\n}\n\nexport function getTimeControlsArray(site,timeControlState, selected) {\n    let allTimeControls = site === Constants.SITE_LICHESS ? \n        Common.LICHESS_TIME_CONTROLS : Common.CHESS_DOT_COM_TIME_CONTROLS\n    return allTimeControls.filter((timeControl)=>!!timeControlState[timeControl] === selected)\n}\nlet monthLabels = [\n    \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n]\nexport function getTimeframeSteps() {\n    let steps = [{\n        year:2007,\n        value:0\n    }]\n    let value = 1;\n    let startYear = 2010\n    let currentYear = new Date().getFullYear()\n    let currentMonth = new Date().getMonth()\n    while(startYear < currentYear-1) {\n        steps.push({\n            toLongLabel:`${monthLabels[11]} ${startYear}`,\n            fromLongLabel:`${monthLabels[0]} ${startYear}`,\n            year:startYear,\n            value:value\n        })\n        startYear++\n        value++\n    }\n    for(let i=11;i>0;i--) {\n\n        let month = (currentMonth+12-i)%12\n        let year = month<currentMonth?currentYear:currentYear-1\n        steps.push({\n            fromLongLabel: `${monthLabels[month]} ${year}`,\n            toLongLabel: `${monthLabels[month]} ${year}`,\n            month:month,\n            year: year,\n            value:value\n        })\n        value++\n    }\n    steps.push({\n        month:12,\n        year: currentYear,\n        value:value\n    })\n    return steps\n}\n\nexport function getSelectedTimeFrameData(timeframe, timeframeSteps) {\n    let fromIndex = timeframe[0]\n    let toIndex = timeframe[1]\n    let fromTimeframe = timeframeSteps[fromIndex]\n    let toTimeframe = timeframeSteps[toIndex]\n    \n    if(fromIndex === timeframeSteps.length-1 && toIndex === timeframeSteps.length-1) {\n        let currentDate = new Date()\n        return {\n            label:\"Current month\",\n            fromMonth:currentDate.getMonth(),\n            fromYear:currentDate.getFullYear(),\n            fromTimeStamp:getTimeStampInfoFor(currentDate.getMonth(), currentDate.getFullYear(), \"min\")\n        }\n    }\n    if(fromIndex === 0 && toIndex === 0) {\n        return {label:\"Anytime\"}\n    }\n    if(fromIndex === 0 && toIndex === timeframeSteps.length-1) {\n        return {label:\"Anytime\"}\n    }\n    if(toIndex === timeframeSteps.length-1) {\n        let month = fromTimeframe.month ? fromTimeframe.month : 0\n        return {\n            label:`Since ${fromTimeframe.fromLongLabel}`,\n            fromYear: fromTimeframe.year,\n            fromMonth: month,\n            fromTimeStamp: getTimeStampInfoFor(month, fromTimeframe.year, \"min\")\n        }\n    }\n    if(fromIndex === 0) {\n        let month = toTimeframe.month ? toTimeframe.month : 11\n        return {\n            label:`Until ${toTimeframe.toLongLabel}`,\n            toYear: toTimeframe.year,\n            toMonth: month,\n            toTimeStamp: getTimeStampInfoFor(month, toTimeframe.year, \"max\")\n        }\n    }\n    let fromMonth = fromTimeframe.month ? fromTimeframe.month : 0\n    let toMonth = toTimeframe.month ? toTimeframe.month : 11\n    return {\n        label:`From ${fromTimeframe.fromLongLabel} to ${toTimeframe.toLongLabel}`,\n        fromYear: fromTimeframe.year,\n        fromMonth: fromMonth,\n        fromTimeStamp: getTimeStampInfoFor(fromMonth, fromTimeframe.year, \"min\"),\n        toYear: toTimeframe.year,\n        toMonth: toMonth,\n        toTimeStamp: getTimeStampInfoFor(toMonth, toTimeframe.year, \"max\")\n    }\n}\n\nfunction getTimeStampInfoFor(month, year, minOrMax) {\n    if(minOrMax === \"min\") {\n        return new Date(year, month).getTime()\n    } else {\n        return new Date(year,month,getDaysInMonth(year, month)).getTime()\n    }\n}\n\nfunction getDaysInMonth(year,month) {\n    return new Date(year, month + 1, 0).getDate();\n}\n\nexport function getPerformanceDetails(totalElo, white, draws, black, playerColor) {\n    let totalGames = white + draws + black\n    let averageElo = Math.round(totalElo/totalGames)\n    let playerWins = playerColor === Constants.PLAYER_COLOR_WHITE?white:black\n    let playerLosses = playerColor !== Constants.PLAYER_COLOR_WHITE?white:black\n    let score = playerWins+(draws/2)\n    let scorePercentage = Math.round(score*100/totalGames)\n    let ratingChange = Common.DP_TABLE[scorePercentage]\n    return {\n        results:`+${playerWins}-${playerLosses}=${draws}`,\n        performanceRating:averageElo+ratingChange,\n        averageElo: averageElo,\n        score:`${Number.isInteger(score)?score:score.toFixed(1)}/${totalGames}`,\n        ratingChange:`${ratingChange===0?'':(ratingChange>0?'+':'-')}${Math.abs(ratingChange)}`\n    }\n}\n\nexport function isOpponentEloInSelectedRange(elo, range) {\n    if(range[1]===Constants.MAX_ELO_RATING) {\n        return elo>=range[0]\n    }\n    return elo<=range[1] && elo>=range[0]\n}\n\nexport function isDateMoreRecentThan(date, than) {\n    // give priority to game which has a date\n    if(!than) {\n        return false\n    }\n    if(!date) {\n        return true\n    } \n    return new Date(date)>new Date(than)\n}","import React from 'react'\nimport {getNumberIcon} from './Common'\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport Divider from '@material-ui/core/Divider';\nimport ExpansionPanelActions from '@material-ui/core/ExpansionPanelActions';\nimport {ExpansionPanel} from './Common'\nimport * as Constants from '../../app/Constants'\nimport { Collapse } from 'reactstrap'\nimport { trackEvent } from '../../app/Analytics'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button as MaterialUIButton } from '@material-ui/core'\nimport { faCaretDown, faCaretUp} from '@fortawesome/free-solid-svg-icons'\nimport AdvancedFilters from './AdvancedFilters'\nimport {advancedFilters} from './Common'\nimport MuiCollapse from '@material-ui/core/Collapse';\nimport * as SitePolicy from '../../app/SitePolicy'\nimport { Radio, FormControlLabel, RadioGroup, FormHelperText, FormControl, FormLabel} from '@material-ui/core';\nimport deepEqual from 'deep-equal'\n\nexport default class User extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            playerColor: this.props.playerColor,\n            isAdvancedFiltersOpen: false\n        }\n        this.timeframeSteps=this.props.timeframeSteps\n        Object.assign(this.state, this.props.advancedFilters)\n        this.defaultAdvancedFilters = this.props.advancedFilters\n    }\n\n    toggleRated() {\n        if (this.state.rated === 'all') {\n            this.setState({ rated: 'rated' })\n        } else if (this.state.rated === 'rated') {\n            this.setState({ rated: 'casual' })\n        } else {\n            this.setState({ rated: 'all' })\n        }\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"AdvancedFilterChange\", \"rated\")\n    }\n    toggleState(property) {\n        return () => {\n            let newState = {}\n            newState[property] = !this.state[property]\n            this.setState(newState)\n            trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ToggleAdvancedFilters\", this.state.site)\n        }\n    }\n    playerColorChange(event) {\n        let playerColor = event.target.value\n        this.setState({ playerColor: playerColor })\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ColorChange\", playerColor)\n        if(!SitePolicy.isAdvancedFiltersEnabled(this.props.site)) {\n            setImmediate(this.setFilters.bind(this))\n        }\n}\n    handleTimeControlChange(event) {\n        this.setState({ [event.target.name]: event.target.checked });\n    }\n    handleTimeframeChange(event, newValue) {\n        this.setState({ [Constants.FILTER_NAME_SELECTED_TIMEFRAME]: newValue });\n    }\n    handleEloRangeChange(event, newValue) {\n        this.setState({ [Constants.FILTER_NAME_ELO_RANGE]: newValue });\n    }\n    handleDownloadLimitChange(event, newValue) {\n        this.setState({ [Constants.FILTER_NAME_DOWNLOAD_LIMIT]: newValue });\n    }\n\n    setFilters(){\n        if(!this.state.playerColor) {\n            this.setState({colorError:\"Please select a color\"})\n            return\n        }\n        this.setState({colorError:\"\", isAdvancedFiltersOpen:false})\n        this.props.filtersChange(this.state)\n    }\n    getSummary(isDisabled) {\n        if(this.props.playerColor && !isDisabled) {\n            return <span>\n                {getNumberIcon('done')}\n                Color: <b>{this.props.playerColor===Constants.PLAYER_COLOR_WHITE?\"White\":\"Black\"} </b>\n                {this.areAdvancedFiltersApplied()?<span className=\"smallText\">(Filters applied)</span>:null}</span>\n\n        }\n        return <span>{getNumberIcon(3)} Color and filters</span>\n    }\n    componentWillReceiveProps(newProps) {\n        this.setState({...newProps.advancedFilters, playerColor:newProps.playerColor})\n    }\n\n    areAdvancedFiltersApplied(){\n        for (let [key, value] of Object.entries(this.defaultAdvancedFilters)) {\n            if(this.props.advancedFilters[key]===value) {\n                continue\n            }\n            if(!deepEqual(this.props.advancedFilters[key], value)) {\n                return true\n            } \n        }\n        return false\n    }\n\n    \n    render(){\n        let isDisabled = !SitePolicy.isFilterPanelEnabled(this.props.site, this.props.playerName, this.props.selectedNotablePlayer)\n        return <ExpansionPanel expanded={this.props.expandedPanel === 'filters'}\n                    TransitionComponent={MuiCollapse}\n                    TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n            onChange={this.props.handleExpansionChange}\n            disabled={isDisabled}>\n            <ExpansionPanelSummary expandIcon={<ExpandMoreIcon />}>{this.getSummary(isDisabled)}</ExpansionPanelSummary>\n            <ExpansionPanelDetails>\n                <div className=\"pgnloaderfirstsection\">\n                <FormControl component=\"fieldset\" error={!!this.state.colorError}>\n                    <FormLabel component=\"legend\">Games where <b>{this.props.playerName}</b> is playing as:</FormLabel>\n                    <RadioGroup onChange={this.playerColorChange.bind(this)} value={this.state.playerColor}>\n                        <FormControlLabel className=\"whitelabel\" control={<Radio color=\"primary\" />} value={Constants.PLAYER_COLOR_WHITE} label={this.state.playerColor === Constants.PLAYER_COLOR_WHITE?<b>White</b>:\"White\"}/>\n                        <FormControlLabel className=\"blacklabel\" control={<Radio color=\"primary\" />} value={Constants.PLAYER_COLOR_BLACK} label={this.state.playerColor === Constants.PLAYER_COLOR_BLACK?<b>Black</b>:\"Black\"}/>\n                    </RadioGroup>\n                    <FormHelperText>{this.state.colorError}</FormHelperText>\n                </FormControl>\n                </div>\n                {SitePolicy.isAdvancedFiltersEnabled(this.props.site)?<div className=\"pgnloadersection\"><span className=\"linkStyle\" onClick={this.toggleState('isAdvancedFiltersOpen').bind(this)}>Advanced filters <FontAwesomeIcon icon={this.state.isAdvancedFiltersOpen ? faCaretUp : faCaretDown} /></span>\n                    <Collapse isOpen={this.state.isAdvancedFiltersOpen}>\n                            <AdvancedFilters\n                                site={this.props.site}\n                                toggleRated={this.toggleRated.bind(this)}\n                                handleTimeControlChange={this.handleTimeControlChange.bind(this)}\n                                handleTimeframeChange={this.handleTimeframeChange.bind(this)}\n                                handleEloRangeChange={this.handleEloRangeChange.bind(this)}\n                                timeframeSteps={this.timeframeSteps}\n                                handleDownloadLimitChange={this.handleDownloadLimitChange.bind(this)}\n                                advancedFilters={advancedFilters(this.state)}\n                            />\n                    </Collapse>\n                </div>:null}\n                </ExpansionPanelDetails>\n                <Divider />\n                <ExpansionPanelActions>\n                    <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.setFilters.bind(this)}>Continue</MaterialUIButton>\n                </ExpansionPanelActions></ExpansionPanel>\n    \n    }\n}","import React from 'react'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { Button as MaterialUIButton } from '@material-ui/core'\nimport PGNReader from '../../app/PGNReader'\nimport { faList} from '@fortawesome/free-solid-svg-icons'\nimport GetApp from '@material-ui/icons/GetApp'\nimport Equalizer from '@material-ui/icons/Equalizer'\nimport Fade from '@material-ui/core/Fade'\nimport Save from '@material-ui/icons/Save';\nimport * as SitePolicy from '../../app/SitePolicy'\nimport {Tooltip} from '@material-ui/core'\nimport HourglassEmptyIcon from '@material-ui/icons/HourglassEmpty';\nimport {serializeOpeningTree, deserializeOpeningTree} from '../../app/OpeningTreeSerializer'\n\nexport default class Actions extends React.Component {\n    constructor(props) {\n        super(props) \n        this.state = {\n            isGamesSubsectionOpen : false,\n            exportingInProgress : false\n        }\n    }\n    unload = () => {\n        if (this.pgnReader) {\n            this.pgnReader.stopDownloading()\n        }\n    }\n    componentDidMount() {\n        window.addEventListener(\"beforeunload\", this.unload);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener(\"beforeunload\", this.unload);\n    }\n    importTreeClicked() {\n        this.setState({exportingInProgress:true})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"LoadTree\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n        setImmediate(this.importOpeningTree.bind(this))\n    }\n    importOpeningTree() {\n        deserializeOpeningTree(this.props.files[0], \n            (err,data, subMesage)=> {\n                if(err) {\n                    this.props.showError(err, null, subMesage)\n                    this.setState({exportingInProgress:false})\n                    return\n                }\n                let success = this.props.importOpeningTreeObject(data)\n                this.setState({exportingInProgress:false})\n                if(success) {\n                    this.props.showInfo(\"Successfuly loaded openingtree\")                \n                }\n            })\n    }\n    exportTreeClicked() {\n        this.setState({exportingInProgress:true})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"SaveTree\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n        setImmediate(this.exportOpeningTree.bind(this))\n    }\n    exportOpeningTree() {\n        serializeOpeningTree(this.props.exportOpeningTreeObject(), \n            SitePolicy.exportFileName(this.props.site, this.props.playerName, this.props.playerColor, null, \"tree\"), \n            (err, info) => {\n                if(err) {\n                    this.props.showError(err)                    \n                } else {\n                    this.props.showInfo(info)\n                }\n                this.setState({exportingInProgress:false})\n            })\n    }\n\n\n    readPgn(shouldDownloadToFile) {\n        this.pgnReader = new PGNReader()\n        this.pgnReader.fetchPGNFromSite(this.props.playerName,\n            this.props.playerColor,\n            this.props.site,\n            this.props.selectedNotablePlayer,\n            this.props.selectedNotableEvent,\n            shouldDownloadToFile,\n            this.props.advancedFilters,\n            this.props.notify,\n            this.props.showError,\n            this.stopDownloading.bind(this),\n            this.props.files)\n    }\n\n    download() {\n        this.readPgn(true)\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"Download\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n\n    }\n\n    getPlayerName() {\n        if(this.props.site === Constants.SITE_PLAYER_DB) {\n            return this.props.selectedNotablePlayer.name\n        }\n        return this.props.playerName\n    }\n    componentWillReceiveProps(newProps) {\n        if(newProps.gamesProcessed>0) {\n            this.setState({isGamesSubsectionOpen:true})\n        }\n    }\n\n    load() {\n        this.props.clear()\n        this.setState({ isGamesSubsectionOpen: true, loadedSite:this.props.site })\n        // set the player name and color in the global state\n        this.props.onChange(\"playerName\", this.props.playerName)\n        this.props.onChange(\"playerColor\", this.props.playerColor)\n        this.readPgn(false)\n        this.props.setDownloading(true)\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"Load\", this.props.site, this.props.playerColor === Constants.PLAYER_COLOR_WHITE ? 1 : 0)\n    }\n    stopDownloading() {\n        this.props.setDownloading(false)\n    }\n    stopDownloadingAction() {\n        this.stopDownloading()\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"StopDownloading\", this.props.site)\n    }\n    openingTreeLoadActions() {\n        return <div className=\"pgnloadersection\">\n            <MaterialUIButton\n            onClick={this.importTreeClicked.bind(this)}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={this.state.exportingInProgress?<HourglassEmptyIcon/>:<GetApp/>}\n            className=\"mainButton\" disableElevation\n            disabled={this.state.exportingInProgress}\n            >\n                {this.state.exportingInProgress?\"Loading from file\":\"Load openingtree\"}\n        </MaterialUIButton></div>\n    }\n    regularActions() {\n        let downloadDisabledReason = SitePolicy.treeSaveDisabledReason(\n                                        this.state.loadedSite, \n                                        this.props.site,\n                                        this.props.gamesProcessed, \n                                        this.props.isDownloading)\n        return <div>\n        <div className=\"pgnloadersection\"><MaterialUIButton\n            onClick={this.load.bind(this)}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<Equalizer />}\n            className=\"mainButton\" disableElevation\n        >\n            Analyze games\n        </MaterialUIButton></div>\n        <div className=\"pgnloadersection\"><MaterialUIButton\n            onClick={this.download.bind(this)}\n            variant=\"contained\"\n            color=\"default\"\n            startIcon={<GetApp />}\n            className=\"mainButton\" disableElevation\n        >\n            Export as PGN\n        </MaterialUIButton></div>\n        {\n            <div className=\"pgnloadersection\"><Tooltip placement=\"top\" title={downloadDisabledReason||\"Save a .tree file locally for faster reload later\"}>\n                <span><MaterialUIButton\n                onClick={this.exportTreeClicked.bind(this)}\n                variant=\"contained\"\n                color=\"default\"\n                startIcon={this.state.exportingInProgress?<HourglassEmptyIcon/>:<Save/>}\n                className=\"mainButton\" disableElevation\n                disabled={!!downloadDisabledReason || this.state.exportingInProgress}\n                >\n                    {this.state.exportingInProgress?\"Saving to file\":\"Save openingtree\"}\n                </MaterialUIButton></span></Tooltip></div>\n            }\n        {\n            this.state.isGamesSubsectionOpen ?\n                <div>\n                    <div className=\"pgnloadersection\">\n                        {!this.props.playerColor?\"Games\":this.props.playerColor === Constants.PLAYER_COLOR_WHITE?\"White games\":\"Black games\"}{` loaded: ${this.props.gamesProcessed} `}{this.props.isDownloading ? <span className=\"stopDownloading\">[<span className=\"linkStyle\" onClick={this.stopDownloadingAction.bind(this)}><img alt=\"loading spinner\" src=\"./spinner.gif\" height=\"15\" />stop</span>]</span> : \"\"}\n                    </div>\n                    <div onClick={() => this.props.switchToMovesTab()} className=\"navLinkButton pgnloadersection\">\n                        <FontAwesomeIcon icon={faList} /> View Moves>>\n                </div>\n                </div>\n                : \"\"\n        }\n        </div>\n    }\n    mainComponent() {\n        if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            return this.openingTreeLoadActions()\n        }\n        return this.regularActions()\n    }\n    render(){\n        if(this.props.expandedPanel) {\n            return <Fade timeout={Constants.LOADER_ANIMATION_DURATION_MS*2}>\n            {this.mainComponent()}\n        </Fade>\n        }\n        return <Fade in timeout={Constants.LOADER_ANIMATION_DURATION_MS*3}>\n            {this.mainComponent()}\n        </Fade>\n    }\n}","import normalizeNewLine from 'normalize-newline'\n\nexport function normalizePGN(pgnString) {\n    // parser cannot handle \\r characters\n    // normalize newlines coverts everything to \\n\n    let dataString = normalizeNewLine(pgnString)\n\n    // Remove Single line commments because parser does not handle them\n    dataString = dataString.replace(/^;.*$/gm, '')\n\n    // Remove escaped quotes from headers\n    dataString = dataString.replace(/\\\\\"/gm, '')\n    \n    // some pgn files dont have triple \\n separating games\n    // so converting all double \\n with triple \\n if it happens before a [\n    // this separates games with atleast a triple \\n\n    dataString = dataString.replace(/\\n\\n+\\[/g, `\\n\\n\\n[`);\n\n    // some pgn files have the result in a separate line instead of \n    // at the end of the moves this moves those results to the end of the moves\n    // $1 replaces the first captured group which is the result\n    dataString = dataString.replace(/\\s*\\n+(1-0|0-1|1\\/2-1\\/2)/g, ` $1`);\n\n    return dataString\n}\n","import request from 'request'\nimport {normalizePGN} from './IteratorUtils'\nimport {trimString} from '../Common'\n\nexport default class BaseUrlIterator {\n\n    constructor(url, shouldNormalizePGN, responseCodeCallback, errorCallback, dataCallback, endCallback) {\n        let remainingBody=''\n\n        let requestObject = request.get(\n                url, \n                { json: false }).on('error', errorCallback)\n            .on('response',(response)=>{\n                return responseCodeCallback(response.statusCode)\n            }).on('data', (data) => {\n                let newBody = shouldNormalizePGN? \n                    normalizePGN(remainingBody + data.toString()):\n                    remainingBody + data.toString()\n                let lastValidPGN = newBody.lastIndexOf(`\\n\\n\\n`)\n                let body = newBody.slice(0, lastValidPGN)\n\n                remainingBody = newBody.slice(lastValidPGN)\n                if(!this.callDataCallback(body, dataCallback)) {\n                    requestObject.abort()\n                }\n            }).on('end', () => {\n                this.callDataCallback(remainingBody, dataCallback)\n                endCallback()\n            })\n    }\n\n    callDataCallback(body, dataCallback) {\n        let pgnArray = body.split(`\\n\\n\\n`)\n            .map(\n                pgnString=> trimString(pgnString)\n            )\n        return dataCallback(pgnArray)\n\n    }\n}","import { parse }  from '../PGNParser'\nimport {getTimeControlsArray, getTimeframeSteps, getSelectedTimeFrameData, isOpponentEloInSelectedRange} from '../util'\nimport * as Constants from '../Constants'\nimport {trackEvent} from '../Analytics'\nimport BaseUrlIterator from './BaseUrlIterator'\n\nexport default class LichessIterator {\n\n    constructor(playerName, playerColor, advancedFilters, ready, showError) {\n        let lichessBaseURL = `https://lichess.org/api/games/user/`\n        let playerNameFilter = encodeURIComponent(playerName)\n        let colorFilter = `?color=${playerColor}`\n        let ratedFilter = `${advancedFilters[Constants.FILTER_NAME_RATED]===\"all\"?\"\":`&rated=${advancedFilters[Constants.FILTER_NAME_RATED]===\"rated\"?\"true\":\"false\"}`}`\n        let selectedTimeFrameData = getSelectedTimeFrameData(advancedFilters[Constants.FILTER_NAME_SELECTED_TIMEFRAME], getTimeframeSteps())\n        let timeSinceFilter = `${selectedTimeFrameData.fromTimeStamp?`&since=${selectedTimeFrameData.fromTimeStamp}`:\"\"}`\n        let timeUntilFilter = `${selectedTimeFrameData.toTimeStamp?`&until=${selectedTimeFrameData.toTimeStamp}`:\"\"}`\n        let selectedTimeControls = getTimeControlsArray(Constants.SITE_LICHESS, advancedFilters, true)\n        let perfFilter = selectedTimeControls.length === 0 || selectedTimeControls.length === 6?\n                \"\" : `&perfType=${selectedTimeControls.join(\",\")}`\n        new BaseUrlIterator(lichessBaseURL+playerNameFilter+colorFilter+ratedFilter+perfFilter+timeSinceFilter+timeUntilFilter, false,\n            (responseCode)=>{\n                if(responseCode === 404) {\n                    showError('Could not find lichess user ' + playerName)\n                } else if (responseCode !== 200) {\n                    showError('Could not load games of lichess user ' + playerName)\n                }\n            }, (error)=> {\n                showError('Failed to connect to lichess.org. Lichess might be down right now', null, \"Some addons like 'Piracy Badger' can also cause this.\")\n                ready([], false)\n            }, (pgnStringArray) => {\n                let parsedPGNs = pgnStringArray.map((pgnString)=> {\n                    try {\n                        return parse(pgnString)[0]\n                    } catch (e) {\n                        console.log(\"Failed to parse pgn\", pgnString)\n                        console.log(e)\n                        trackEvent(Constants.EVENT_CATEGORY_ERROR, \"parseFailedLichess\", playerName)\n                        return null\n                    }\n                })\n    \n                let continueProcessing = ready(parsedPGNs.filter((pgn)=>{\n                    if(!pgn || pgn.headers.Variant !== \"Standard\") {\n                        return false\n                    }\n                    let opponentElo = playerColor === Constants.PLAYER_COLOR_WHITE?pgn.headers.BlackElo:pgn.headers.WhiteElo\n                    if(!isOpponentEloInSelectedRange(opponentElo, advancedFilters[Constants.FILTER_NAME_ELO_RANGE])) {\n                        return false\n                    }\n                    return true\n                }), true)\n                return continueProcessing\n            }, ()=>{\n                ready([], false)\n            })\n    }\n}\n","import ChessWebAPI from 'chess-web-api'\nimport { parse }  from '../PGNParser'\nimport request from 'request'\nimport * as Constants from '../Constants'\nimport {isOpponentEloInSelectedRange, getTimeframeSteps, getSelectedTimeFrameData} from '../util'\nimport {trackEvent} from '../Analytics'\nimport {normalizePGN} from './IteratorUtils'\n\nexport default class ChessComIterator {\n\n    constructor(playerName, playerColor, advancedFilters, ready, showError) {\n        let chessAPI = new ChessWebAPI({\n            queue: true,\n        });\n        let pendingRequests = 0;\n        let parseGames= (archiveResponse)=>{\n            pendingRequests--\n            let continueProcessing = ready(archiveResponse.body.games.filter(\n                game=>{\n                    if(game.rules!==\"chess\" || game[playerColor].username.toLowerCase() !== playerName.toLowerCase()) {\n                        return false\n                    }\n                    let ratedMode = advancedFilters[Constants.FILTER_NAME_RATED]\n                    if(ratedMode === 'rated' && !game.rated) {\n                        return false\n                    } else if (ratedMode === 'casual' && game.rated) {\n                        return false\n                    }\n                    if(!advancedFilters[game.time_class]) {\n                        return false\n                    }\n                    let opponentElo = playerColor === Constants.PLAYER_COLOR_WHITE?game.black.rating:game.white.rating\n                    if(!isOpponentEloInSelectedRange(opponentElo, advancedFilters[Constants.FILTER_NAME_ELO_RANGE])) {\n                        return false\n                    }\n                    return true \n                }).map(\n                    game=> {\n                        try {\n                            return parse(normalizePGN(game.pgn))[0]\n                        } catch (e) {\n                            console.log(\"failed to parse pgn\", game)\n                            console.log(e)\n                            trackEvent(Constants.EVENT_CATEGORY_ERROR, \"parseFailedChessCom\", `${playerName}:${playerColor}`)\n                            return null\n                        }\n                    }).filter(game=> game !== null), pendingRequests>0)\n            if(!continueProcessing) {\n                //cancel all pending requests\n                while(chessAPI.dequeue()){}\n                pendingRequests = 0\n                ready([],false)\n            }\n        }\n        let shouldFetchGamesFromArchive = (archiveMonth,archiveYear, selectedTimeFrameData) => {\n            let fromYear = selectedTimeFrameData.fromYear || 1970\n            let toYear = selectedTimeFrameData.toYear || 10000\n            let fromMonth = selectedTimeFrameData.fromYear || 0\n            let toMonth = selectedTimeFrameData.toYear || 11\n    \n            if(archiveYear>fromYear && archiveYear<toYear) {\n                return true\n            }\n            if(archiveYear<fromYear || archiveYear>toYear) {\n                return false\n            }\n            if(archiveYear === fromYear) {\n                return archiveMonth >= fromMonth\n            }\n            if(archiveYear === toYear) {\n                return archiveMonth <= toMonth\n            }\n            console.log(\"should not happen\")\n            return true\n        }\n        let selectedTimeFrameData = getSelectedTimeFrameData(advancedFilters[Constants.FILTER_NAME_SELECTED_TIMEFRAME], getTimeframeSteps())\n        let fetchAllGames = function(responseBody) {\n            responseBody.archives.reverse().forEach((archiveUrl)=>{\n\n                let components=archiveUrl.split('/')\n                let year=components[components.length-2]\n                let month=components[components.length-1]\n                if(shouldFetchGamesFromArchive(month,year, selectedTimeFrameData)) {\n                    pendingRequests++\n                    chessAPI.dispatch(chessAPI.getPlayerCompleteMonthlyArchives, parseGames, [playerName, year, month]);\n                }\n            })\n            if(pendingRequests === 0) {\n                showError('Could not find games for chess.com user '+playerName)\n                ready([], false)\n            }\n        }\n\n        request(`https://api.chess.com/pub/player/${playerName}/games/archives`, function (error, response, body) {\n            if(error) {\n                showError('Failed to connect to chess.com. chess.com might be down at the moment', null, \"Some addons like 'Piracy Badger' can also cause this.\")\n                ready([], false)\n            } else if(response.statusCode === 404) {\n                showError('Could not find chess.com user '+playerName)\n                ready([], false)\n            } else if (response.statusCode !== 200) {\n                showError('Could not load games for chess.com user '+playerName)\n                ready([], false)\n            } else {\n                if(response.body) {\n                    try{\n                        let jsonBody = JSON.parse(response.body)\n                        fetchAllGames(jsonBody)\n                    }catch(e) {\n                        showError('Could not find games for chess.com user '+playerName)\n                        ready([], false)\n                    }\n                }\n            }\n        });\n    }\n\n\n}","import { parse }  from '../PGNParser'\nimport * as Constants from '../Constants'\nimport {trackEvent} from '../Analytics'\nimport {normalizePGN} from './IteratorUtils'\nimport {trimString} from '../Common'\n\nexport default class LichessIterator {\n\n    constructor(playerName, files, playerColor, advancedFilters, ready, showError) {\n        files.forEach((file)=>{\n            let reader = this.setupReader(playerName, playerColor, advancedFilters, ready, showError)\n            reader.readAsText(file)\n        })\n    }\n\n    setupReader(playerName, playerColor, advancedFilters, ready, showError) {\n        let reader = new FileReader()\n        let playerColorHeaderName = playerColor === Constants.PLAYER_COLOR_WHITE? 'White': 'Black'\n        let lowerCasePlayerName = playerName? playerName.toLowerCase() : null\n        reader.onload = function(evt) {\n            let fileData = normalizePGN(evt.target.result);\n            let pgnsArray = fileData.split(\"\\n\\n\\n\")\n\n            let parsedPGNs = pgnsArray.map((pgnString)=> {\n                try {\n                    let parsedPGN =  parse(trimString(pgnString))[0]\n                    let playerColorHeaderValue = parsedPGN.headers[playerColorHeaderName]\n                    if(playerName && playerColorHeaderValue && !playerColorHeaderValue.toLowerCase().includes(lowerCasePlayerName)) {\n                        // filter out games not from selected player\n                        return null\n                    }\n                    return parsedPGN\n                } catch (e) {\n                    console.log(\"failed to parse pgn\", pgnString)\n                    console.log(e)\n                    trackEvent(Constants.EVENT_CATEGORY_ERROR, \"parseFailedPGNFile\", playerName)\n                    return null\n                }\n            })\n            ready(parsedPGNs.filter(pgn=>!!pgn), true)\n        };\n        reader.onerror = function(e) {\n            showError(\"Failed to load pgn file\", null, e.target.error.name+\":\"+e.target.error.message)\n            ready([], false)\n        }\n        reader.onloadend = function() {\n            ready([], false)\n        }\n        return reader\n    }\n}","import { parse }  from '../PGNParser'\nimport * as Constants from '../Constants'\nimport {trackEvent} from '../Analytics'\nimport BaseUrlIterator from './BaseUrlIterator'\n\nexport default class PGNUrlIterator {\n\n    constructor(url, lowerCasePlayerNames, playerColor, advancedFilters, ready, showError) {\n        let playerColorHeaderName = playerColor === Constants.PLAYER_COLOR_WHITE? 'White': 'Black'\n        new BaseUrlIterator(url, true, \n            (responseCode)=>{\n                if (responseCode !== 200) {\n                    showError('Could not load url')\n                }\n            }, (error)=> {\n                showError('Could not connect to url')\n                ready([], false)\n            }, (pgnStringArray) => {\n                let parsedPGNs = pgnStringArray.map((pgnString)=> {\n                    try {\n\n                        return parse(pgnString)[0]\n                    } catch (e) {\n                        console.log(\"Failed to parse pgn\", pgnString)\n                        console.log(e)\n                        trackEvent(Constants.EVENT_CATEGORY_ERROR, \"parseFailedPGNUrl\")\n                        return null\n                    }\n                })\n    \n                let continueProcessing = ready(parsedPGNs.filter((game)=>{\n                    if(!game) {\n                        return false\n                    }\n                    if(lowerCasePlayerNames && !lowerCasePlayerNames.includes(game.headers[playerColorHeaderName].toLowerCase())) {\n                        return false\n                    }\n                    return true\n                }), true)\n                return continueProcessing\n            }, ()=>{\n                ready([], false)\n            })\n    }\n\n}\n","import PGNUrlIterator from './PGNUrlIterator'\n\nexport default class NotablePlayerIterator {\n\n    constructor(selectedPlayer, playerColor, advancedFilters, ready, showError) {\n        let lowerCaseAliases = selectedPlayer.pgnAliases?selectedPlayer.pgnAliases.map(alias=>alias.toLowerCase()):null\n        new PGNUrlIterator(selectedPlayer.pgnUrl, lowerCaseAliases, playerColor, advancedFilters, ready, showError)\n    }\n\n}\n","import Chess from 'chess.js'\nimport LichessIterator from './iterator/LichessIterator'\nimport ChessComIterator from './iterator/ChessComIterator'\nimport PGNFileIterator from './iterator/PGNFileIterator'\nimport * as Constants from './Constants'\nimport streamsaver from 'streamsaver'\nimport NotablePlayerIterator from './iterator/NotablePlayerIterator'\nimport * as SitePolicy from './SitePolicy'\n\nexport default class PGNReader {\n    constructor() {\n        this.totalGames = 0;\n        this.pendingGames = 0;\n        this.pendingDownloads = true;\n        streamsaver.mitm = \"download/download-mitm.html\"\n        this.fileWriter = null\n    }\n\n    stopDownloading() {\n        if(this.fileWriter) {\n            this.fileWriter.close()\n            this.fileWriter = null\n        }\n    }\n\n    getPgnString(game){\n        return `${Object.entries(game.headers).map(header=>`[${header[0]} \"${header[1]}\"]`).join(\"\\n\")}\n                \\n${game.moves.map((moveObject, index)=>{\n                    return `${index%2!==0?'':index/2+1+\".\"} ${moveObject.move}`\n                }).join(' ')} ${game.result}\\n\\n\\n`\n    }\n\n    fetchPGNFromSite(playerName, playerColor, site, selectedNotablePlayer,\n        selectedNotableEvent, shouldDownloadToFile, advancedFilters, notify, \n        showError, stopDownloading, files) {\n        this.continueProcessingGames = true\n        if(shouldDownloadToFile) {\n            let fileStream =  streamsaver.createWriteStream(SitePolicy.exportFileName(site, playerName, playerColor, selectedNotableEvent, \"pgn\"))\n            this.fileWriter = fileStream.getWriter()\n        }\n        let encoder = new TextEncoder()\n        let downloadResponse = (result, pendingDownloads) => {\n            this.fileWriter.write(encoder.encode(result.map(game=>this.getPgnString(game)).join(\"\"))).then(()=>{\n                if(!pendingDownloads) {\n                    this.stopDownloading()\n                }\n            })\n            return true\n        }\n        let handleResponse = (result, pendingDownloads) => {\n            if(!result) {\n                return this.continueProcessingGames\n            }\n            this.totalGames += result.length\n            this.pendingGames += result.length\n            this.pendingDownloads = pendingDownloads\n            \n\n            setTimeout(() => {\n                this.parsePGNTimed(site, result, advancedFilters, playerColor, 0, playerName, notify, showError, stopDownloading)\n            } ,1)\n            return this.continueProcessingGames\n        }\n        let processor = shouldDownloadToFile? downloadResponse: handleResponse\n        if (site === Constants.SITE_LICHESS) {\n            new LichessIterator(playerName, playerColor, advancedFilters, processor, showError)\n        } else if (site === Constants.SITE_CHESS_DOT_COM) {\n            new ChessComIterator(playerName, playerColor, advancedFilters, processor, showError)\n        } else if (site === Constants.SITE_PGN_FILE) {\n            new PGNFileIterator(playerName, files, playerColor, advancedFilters, processor, showError)\n        } else if (site === Constants.SITE_PLAYER_DB) {\n            new NotablePlayerIterator(selectedNotablePlayer, playerColor, advancedFilters, processor, showError)\n        } else if (site === Constants.SITE_EVENT_DB) {\n            new NotablePlayerIterator(selectedNotableEvent, playerColor, advancedFilters, processor, showError)\n        } \n\n        \n    }\n\n    parsePGNTimed(site, pgnArray, advancedFilters, playerColor, index,  playerName, notify, showError, stopDownloading) {\n        if(index< pgnArray.length) {\n            this.pendingGames--\n        }\n        if(!this.pendingDownloads && this.pendingGames <= 0) {\n            stopDownloading()\n        }\n\n        if(index>= pgnArray.length || !this.continueProcessingGames) {\n            return\n        }\n\n        var pgn = pgnArray[index]\n\n        if(pgn.moves[0] && pgn.moves[0].move_number === 1) {\n            let chess = new Chess()\n            let pgnParseFailed = false;\n            let parsedMoves = []\n            pgn.moves.forEach(element => {\n                let sourceFen = chess.fen()\n                let move = chess.move(element.move, {sloppy: true})\n                let targetFen = chess.fen()\n                if(!move){\n                    pgnParseFailed=true\n                    return\n                }\n                parsedMoves.push({\n                    sourceFen:sourceFen,\n                    targetFen:targetFen,\n                    moveSan:move.san\n                })\n            })\n            if(pgnParseFailed) {\n                console.log('failed to load game ',  pgn)\n                showError(\"Failed to load a game\", `${playerName}:${playerColor}`)\n            } else {\n                let fen = chess.fen()\n                let parsedPGNDetails = {\n                    pgnStats:this.gameResult(pgn,site),\n                    parsedMoves:parsedMoves,\n                    latestFen:fen,\n                    playerColor:playerColor\n                }\n                this.continueProcessingGames = notify(advancedFilters[Constants.FILTER_NAME_DOWNLOAD_LIMIT],1, parsedPGNDetails)\n            }\n        }\n        setTimeout(()=>{this.parsePGNTimed(site, pgnArray, advancedFilters, playerColor, index+1, playerName, notify, showError, stopDownloading)},1)\n    }\n\n    gameResult(pgn, site) {\n        let url= null \n        if (site === Constants.SITE_CHESS_DOT_COM) {\n            url = pgn.headers.Link\n        } else if(site === Constants.SITE_LICHESS) {\n            url = pgn.headers.Site\n        }\n        let headers=null\n        if(!url) {\n            headers = pgn.headers\n        }\n        return {\n            result:pgn.result,\n            white:pgn.headers.White,\n            black:pgn.headers.Black,\n            whiteElo:pgn.headers.WhiteElo,\n            blackElo:pgn.headers.BlackElo,\n            url:url,\n            date:pgn.headers.Date,\n            headers:headers\n        }\n    }\n}","import * as Constants from '../../app/Constants'\nimport * as Common from '../../app/Common'\nimport {getTimeControlsArray} from '../../app/util'\n\nlet timeClasses = [\n    {\n        label:\"Fast time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ]\n    },\n    {\n        label:\"Slow time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ\n        ]\n    },\n    {\n        label:\"Reasonable time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BLITZ,\n            Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET\n        ]\n    },\n    {\n        label:\"Exclude slow time controls\",\n        selectedTimeControls:[\n            Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_ULTRA_BULLET,\n            Constants.TIME_CONTROL_BLITZ,\n            Constants.TIME_CONTROL_RAPID\n        ],\n        unselectedTimeControls:[\n            Constants.TIME_CONTROL_CLASSICAL,\n            Constants.TIME_CONTROL_CORRESPONDENCE\n        ]\n    }\n]\n        \n\n\nexport function timeControlLabel(site, timeControlState) {\n    let selectedTimeControls = getTimeControlsArray(site, timeControlState, true)\n    let unselectedTimeControls = getTimeControlsArray(site, timeControlState, false)\n    if(unselectedTimeControls.length === 0 || selectedTimeControls.length === 0) {\n        return \"All time controls\"\n    }\n    if(selectedTimeControls.length === 1) {\n        return Common.TIME_CONTROL_LABELS[selectedTimeControls[0]]\n    }\n    if(unselectedTimeControls.length === 1) {\n        return `All except ${Common.TIME_CONTROL_LABELS[unselectedTimeControls[0]]}`\n    }\n    if(selectedTimeControls.length === 2) {\n        return `${Common.TIME_CONTROL_LABELS[selectedTimeControls[0]]} and ${Common.TIME_CONTROL_LABELS[selectedTimeControls[1]]}`\n    }\n\n    return lichessTimeControlLabel(selectedTimeControls, unselectedTimeControls)\n}\n\nfunction lichessTimeControlLabel(selectedTimeControls, unselectedTimeControls) {\n    let timeClass = timeClasses.filter(\n        (timeClass) => {\n            return includesAll(unselectedTimeControls,timeClass.unselectedTimeControls)\n                && includesAll(selectedTimeControls,timeClass.selectedTimeControls)\n    })\n    if(timeClass.length) {\n        return timeClass[0].label\n    } \n    return selectedTimeControls.map(control=>Common.TIME_CONTROL_LABELS[control]).join(', ')\n}\n\nfunction includesAll(arr, subArray) {\n    return subArray.every(v => arr.includes(v));\n}\n","import {timeControlLabel} from './TimeControlLabels'\nimport {getSelectedTimeFrameData} from '../../app/util'\nimport * as Constants from '../../app/Constants'\n\nexport const getTimeControlLabel = timeControlLabel\n\nexport function getRatedLabel(rated) {\n    if(rated === 'all') {\n        return \"Rated and casual\"\n    } else if (rated === 'rated') {\n        return \"Rated only\"\n    } else if (rated === 'casual') {\n        return \"Casual only\"\n    }\n}\n\nexport function getWhenPlayedLabel(timeframe, timeframeSteps) {\n    return getSelectedTimeFrameData(timeframe, timeframeSteps).label\n}\n\nexport function getELORangeLabel(selectedEloRange) {\n    if(selectedEloRange[0] === 0 && selectedEloRange[1]===Constants.MAX_ELO_RATING) {\n        return \"All elo ratings\"\n    } else if (selectedEloRange[0] === 0) {\n        return `Below ${selectedEloRange[1]}`\n    } else if (selectedEloRange[1] === Constants.MAX_ELO_RATING) {\n        return `Above ${selectedEloRange[0]}`\n    } else {\n        return `Between ${selectedEloRange[0]} and ${selectedEloRange[1]}`\n    }\n}\nexport function getDownloadLimitLabel(downloadLimit) {\n    return downloadLimit>= Constants.MAX_DOWNLOAD_LIMIT?\"No limit\":`${downloadLimit} games`\n}\n","import FormControl from '@material-ui/core/FormControl';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport React from 'react'\nimport {Collapse, Container, Row, Col} from 'reactstrap'\nimport { FormControlLabel,Slider } from '@material-ui/core';\nimport * as Constants from '../../app/Constants'\nimport {getTimeControlLabel, getELORangeLabel, getRatedLabel, getWhenPlayedLabel, getDownloadLimitLabel} from './FilterLabels'\nimport * as Common from '../../app/Common'\nimport {trackEvent} from '../../app/Analytics'\n\nexport default class AdvancedFilters extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            currentlyOpenAdvancedFilter:'',\n        }\n        this.timeframeMarks=[\n            {\n                value:0,\n                label:\"Big bang\"\n            }, {\n                value:props.timeframeSteps.length-1,\n                label:\"Now\"\n            }]\n        this.downloadLimitMarks=[\n            {\n                value:0,\n                label:\"0\"\n            }, {\n                value:Constants.MAX_DOWNLOAD_LIMIT,\n                label:`No limit`\n            }]\n        this.eloRangeMarks=[\n            {\n                value:0,\n                label:\"0\"\n            }, {\n                value:Constants.MAX_ELO_RATING,\n                label:`No limit`\n            }]\n    \n    }\n    setCurrentlyOpenAdvancedFilter(filterName) {\n        return () => {\n            if(this.state.currentlyOpenAdvancedFilter === filterName) {\n                //close if already open\n                filterName = ''\n            }\n            this.setState({currentlyOpenAdvancedFilter:filterName})\n            trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"AdvancedFilterChange\", filterName)\n        }\n    }\n\n    getFilters(site){\n        return <div>\n            {this.subSectionComponent('Mode', getRatedLabel(this.props.advancedFilters.rated), this.props.toggleRated)}\n            {this.subSectionComponent('Time control', getTimeControlLabel(this.props.site, this.props.advancedFilters), \n                    this.setCurrentlyOpenAdvancedFilter('timeControl').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'timeControl'}>\n                    {this.getTimeControlFilters(site, 4)}\n                </Collapse>\n            )}\n            {this.subSectionComponent('When played', getWhenPlayedLabel(this.props.advancedFilters[Constants.FILTER_NAME_SELECTED_TIMEFRAME], this.props.timeframeSteps), \n                this.setCurrentlyOpenAdvancedFilter('whenPlayed').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'whenPlayed'}>\n                    {this.getTimeFrameFilters()}\n                </Collapse>)}\n            {this.subSectionComponent('Opponent elo range', getELORangeLabel(this.props.advancedFilters[Constants.FILTER_NAME_ELO_RANGE]), \n                this.setCurrentlyOpenAdvancedFilter('eloRange').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'eloRange'}>\n                    {this.getEloRangeFilters()}\n                </Collapse>)}\n            {this.subSectionComponent('Download limit', getDownloadLimitLabel(this.props.advancedFilters[Constants.FILTER_NAME_DOWNLOAD_LIMIT]), \n                this.setCurrentlyOpenAdvancedFilter('downloadLimit').bind(this),\n                <Collapse isOpen={this.state.currentlyOpenAdvancedFilter === 'downloadLimit'}>\n                    {this.getDownloadLimitFilters()}\n                </Collapse>)}\n      </div>\n    }\n\n    getDownloadLimitFilters() {\n        return <Slider className = \"sliderCustom\"\n            value={this.props.advancedFilters[Constants.FILTER_NAME_DOWNLOAD_LIMIT]}\n            onChange={this.props.handleDownloadLimitChange}\n            valueLabelDisplay=\"auto\"\n            valueLabelFormat={(val)=>val>=Constants.MAX_DOWNLOAD_LIMIT?\"All\":val}\n            step={100}\n            min={0}\n            marks={this.downloadLimitMarks}\n            max={Constants.MAX_DOWNLOAD_LIMIT}\n        />\n    }\n\n    getTimeFrameFilters() {\n        return <Slider className = \"sliderCustom\"\n            value={this.props.advancedFilters[Constants.FILTER_NAME_SELECTED_TIMEFRAME]}\n            onChange={this.props.handleTimeframeChange}\n            valueLabelDisplay=\"off\"\n            valueLabelFormat={(val)=>this.props.timeframeSteps[val].label}\n            step={1}\n            marks={this.timeframeMarks}\n            min={0}\n            max={this.props.timeframeSteps.length-1}\n        />\n    }\n\n    getEloRangeFilters() {\n        return <Slider className = \"sliderCustom\"\n            value={this.props.advancedFilters[Constants.FILTER_NAME_ELO_RANGE]}\n            onChange={this.props.handleEloRangeChange}\n            valueLabelDisplay=\"off\"\n            marks={this.eloRangeMarks}\n            min={0}\n            max={Constants.MAX_ELO_RATING}\n        />\n    }\n\n    getTimeControlFilters(site){\n        let firstRow = null, middleRow = null, lastRow = null\n        let colWidth = null\n        if(site === 'lichess') {\n            firstRow = [Constants.TIME_CONTROL_BULLET,\n                        Constants.TIME_CONTROL_ULTRA_BULLET]\n            middleRow = [Constants.TIME_CONTROL_BLITZ,\n                        Constants.TIME_CONTROL_CLASSICAL]\n            lastRow = [Constants.TIME_CONTROL_RAPID,\n                        Constants.TIME_CONTROL_CORRESPONDENCE]\n            colWidth = '4'\n                    \n        } else {\n            firstRow = [Constants.TIME_CONTROL_BULLET,\n                        Constants.TIME_CONTROL_BLITZ]\n            lastRow = [Constants.TIME_CONTROL_RAPID, \n                        Constants.TIME_CONTROL_DAILY]\n            colWidth = '6'\n        }\n        return <FormControl><FormGroup><Container>\n            {this.getTimeControlFilterRow(firstRow,colWidth,'first')}\n            {middleRow?this.getTimeControlFilterRow(middleRow,colWidth,'middle'):null}\n            {this.getTimeControlFilterRow(lastRow,colWidth,'last')}\n          </Container>\n        </FormGroup></FormControl>\n      \n    }\n\n    getTimeControlFilterRow(controls,firstColumnWidth, position){\n        let clsName = 'topBottomNegativeMargin'\n        if(position === \"first\") {\n            clsName = 'bottomNegativeMargin'\n        } else if (position === \"last\") {\n            clsName = 'topNegativeMargin'\n        } \n        return <Row className={clsName}>\n            {controls.map((control) => \n            <Col sm={firstColumnWidth} key={`ctrl${control}`}>\n                \n            <FormControlLabel className = \"nomargin\"\n                control={<Checkbox checked={this.props.advancedFilters[control]} color=\"primary\" \n                onChange={this.props.handleTimeControlChange} name={control} />}\n                label={Common.TIME_CONTROL_LABELS[control]}\n          /></Col>)}</Row>\n    }\n\n    subSectionComponent(title, label, changeCallback, children) {\n        return <div className=\"pgnloadersection\">{title}: <span className=\"smallText\">[<span className=\"linkStyle\" onClick={changeCallback}>change</span>]</span>\n        <div><b>{label}</b></div>{children}\n        </div>\n    }\n\n\n    render() {\n        return this.getFilters(this.props.site)\n    }\n\n}","import * as Constants from './Constants'\n\nexport const LICHESS_TIME_CONTROLS = [\n    Constants.TIME_CONTROL_ULTRA_BULLET,\n    Constants.TIME_CONTROL_BULLET,\n    Constants.TIME_CONTROL_BLITZ,\n    Constants.TIME_CONTROL_RAPID,\n    Constants.TIME_CONTROL_CLASSICAL,\n    Constants.TIME_CONTROL_CORRESPONDENCE\n]\nexport const CHESS_DOT_COM_TIME_CONTROLS = [\n    Constants.TIME_CONTROL_BULLET,\n    Constants.TIME_CONTROL_BLITZ,\n    Constants.TIME_CONTROL_RAPID,\n    Constants.TIME_CONTROL_DAILY,\n]\n\nexport const TIME_CONTROL_LABELS = {\n    [Constants.TIME_CONTROL_ULTRA_BULLET]: \"Ultrabullet\",\n    [Constants.TIME_CONTROL_BULLET]: \"Bullet\",\n    [Constants.TIME_CONTROL_BLITZ]: \"Blitz\",\n    [Constants.TIME_CONTROL_RAPID]: \"Rapid\",\n    [Constants.TIME_CONTROL_CLASSICAL]: \"Classical\",\n    [Constants.TIME_CONTROL_CORRESPONDENCE]: \"Correspondence\",\n    [Constants.TIME_CONTROL_DAILY]: \"Daily\"\n}\n\nexport function trimString(str) {\n    return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nexport const DP_TABLE = {\n    \"100\":800,   \"99\":677,    \"98\":589,    \"97\":538,\n    \"96\":501,    \"95\":470,    \"94\":444,    \"93\":422,\n    \"92\":401,    \"91\":383,    \"90\":366,    \"89\":351,\n    \"88\":336,    \"87\":322,    \"86\":309,    \"85\":296,\n    \"84\":284,    \"83\":273,    \"82\":262,    \"81\":251,\n    \"80\":240,    \"79\":230,    \"78\":220,    \"77\":211,\n    \"76\":202,    \"75\":193,    \"74\":184,    \"73\":175,\n    \"72\":166,    \"71\":158,    \"70\":149,    \"69\":141,\n    \"68\":133,    \"67\":125,    \"66\":117,    \"65\":110,\n    \"64\":102,    \"63\":95,     \"62\":87,     \"61\":80,\n    \"60\":72,     \"59\":65,     \"58\":57,     \"57\":50,\n    \"56\":43,     \"55\":36,     \"54\":29,     \"53\":21,\n    \"52\":14,     \"51\":7,      \"50\":0,      \"49\":-7,\n    \"48\":-14,    \"47\":-21,    \"46\":-29,    \"45\":-36,\n    \"44\":-43,    \"43\":-50,    \"42\":-57,    \"41\":-65,\n    \"40\":-72,    \"39\":-80,    \"38\":-87,    \"37\":-95,\n    \"36\":-102,   \"35\":-110,   \"34\":-117,   \"33\":-125,\n    \"32\":-133,   \"31\":-141,   \"30\":-149,   \"29\":-158,\n    \"28\":-166,   \"27\":-175,   \"26\":-184,   \"25\":-193,\n    \"24\":-202,   \"23\":-211,   \"22\":-220,   \"21\":-230,\n    \"20\":-240,   \"19\":-251,   \"18\":-262,   \"17\":-273,\n    \"16\":-284,   \"15\":-296,   \"14\":-309,   \"13\":-322,\n    \"12\":-336,   \"11\":-351,   \"10\":-366,   \"9\":-383,\n    \"8\":-401,    \"7\":-422,    \"6\":-444,    \"5\":-470,\n    \"4\":-501,    \"3\":-538,    \"2\":-589,    \"1\":-677,\n    \"0\":-800,\n}","import {simplifiedFen, isDateMoreRecentThan} from './util'\nimport * as Constants from './Constants'\nimport Chess from 'chess.js'\n\nclass OpeningGraph {\n    constructor() {\n        this.graph=new Graph()\n        this.hasMoves = false\n    }\n    setEntries(arrayEntries, pgnStats){\n        this.graph=new Graph(arrayEntries, pgnStats)\n        this.hasMoves = true\n    }\n\n    clear() {\n        this.graph = new Graph()\n        this.hasMoves = false\n    }\n\n    addPGN(pgnStats, parsedMoves, lastFen, playerColor) {\n        pgnStats.index = this.graph.pgnStats.length\n        this.graph.pgnStats.push(pgnStats)\n        this.graph.playerColor = playerColor\n        this.hasMoves = true\n        parsedMoves.forEach(parsedMove => {\n            this.addMoveForFen(parsedMove.sourceFen, parsedMove.targetFen, parsedMove.moveSan, pgnStats)\n        })\n        this.addGameResultOnFen(lastFen, pgnStats.index)\n        this.addStatsToRoot(pgnStats)\n    }\n\n    addGameResultOnFen(fullFen, resultIndex) {\n        var currNode = this.getNodeFromGraph(fullFen)\n        if(!currNode.gameResults) {\n            currNode.gameResults = []\n        }\n        currNode.gameResults.push(resultIndex)\n    }\n    addStatsToRoot(pgnStats) {\n        var targetNode = this.getNodeFromGraph(Constants.ROOT_FEN)\n        if(!targetNode.details) {\n            targetNode.details = emptyDetails()\n        }\n        let newDetails = this.getUpdatedMoveDetails(targetNode.details, pgnStats)\n        targetNode.details = newDetails\n    }\n\n    getDetailsForFen(fullFen) {\n        let details = this.getNodeFromGraph(simplifiedFen(fullFen)).details\n        if (Number.isInteger(details)) {\n            details = this.getUpdatedMoveDetails(emptyDetails(), this.graph.pgnStats[details])\n        } else if(!details) {\n            return emptyDetails()\n        }\n        details = this.updateCalculatedValues(details)   \n        return details\n    }\n\n    updateCalculatedValues(details) {\n        if(Number.isInteger(details.bestWin)) {\n            details.bestWinGame = this.graph.pgnStats[details.bestWin]\n            details.bestWinElo = this.getOpponentElo(this.graph.playerColor,details.bestWinGame)\n        }\n        if(Number.isInteger(details.worstLoss)) {\n            details.worstLossGame = this.graph.pgnStats[details.worstLoss]\n            details.worstLossElo = this.getOpponentElo(this.graph.playerColor,details.worstLossGame)\n        }\n        if(Number.isInteger(details.lastPlayed)) {\n            details.lastPlayedGame = this.graph.pgnStats[details.lastPlayed]\n        }\n        details.count = details.whiteWins+details.blackWins+details.draws\n        return details\n\n    }\n\n    addMoveForFen(fullSourceFen, fullTargetFen, move, resultObject) {\n        var targetNode = this.getNodeFromGraph(fullTargetFen)\n        let newDetails = this.getUpdatedMoveDetails(targetNode.details, resultObject)\n        targetNode.details = newDetails\n\n        var currNode = this.getNodeFromGraph(fullSourceFen)\n        currNode.playedByMax = Math.max(currNode.playedByMax, this.getTargetDetailsCount(targetNode.details))\n        if(!currNode.playedBy) {\n            currNode.playedBy = {}\n        }\n        currNode.playedBy[move] = ''\n    }\n\n    getTargetDetailsCount(targetDetails) {\n        if(!targetDetails) {\n            return 0\n        }\n        if(Number.isInteger(targetDetails)) {\n            //if details is an integer, then this has been played once\n            return 1\n        }\n        return targetDetails.draws+targetDetails.blackWins+targetDetails.whiteWins\n    }\n\n    getNodeFromGraph(fullFen) {\n        let fen = simplifiedFen(fullFen)\n        var currNode = this.graph.nodes.get(fen)\n        if(!currNode) {\n            currNode = new GraphNode()\n            currNode.fen = fen\n            this.graph.nodes.set(fen, currNode)\n        }\n        return currNode\n    }\n\n    getUpdatedMoveDetails(currentMoveDetails, resultObject) {\n        if(Number.isInteger(currentMoveDetails)) {\n            // if this is the second stat object being added\n            // calculate the first move details and then merge it with the second one\n            currentMoveDetails = this.getUpdatedMoveDetails(emptyDetails(),\n                            this.graph.pgnStats[currentMoveDetails])\n        } else if(!currentMoveDetails) {\n            // if this is the first stat being added to this node,\n            // just write the index to calculate the stats later\n            return resultObject.index\n        }\n        \n        let whiteWin = 0, blackWin = 0, draw = 0, resultInt = 0;\n        let playerColor = this.graph.playerColor\n        if(resultObject.result === '1-0') {\n            whiteWin = 1\n            resultInt = playerColor === Constants.PLAYER_COLOR_WHITE? 1 : -1\n        } else if (resultObject.result === '0-1') {\n            blackWin = 1\n            resultInt = playerColor === Constants.PLAYER_COLOR_BLACK? 1 : -1\n        } else {\n            draw = 1\n        }\n\n        let opponentElo = this.getOpponentElo(playerColor, resultObject)\n        if(resultInt === 1) {\n            let currentBestWinGame = null\n            if(Number.isInteger(currentMoveDetails.bestWin)) {\n                currentBestWinGame = this.graph.pgnStats[currentMoveDetails.bestWin]\n            }\n            if(!currentBestWinGame || parseInt(opponentElo)>parseInt(this.getOpponentElo(playerColor, currentBestWinGame))) {\n                currentMoveDetails.bestWin = resultObject.index\n            }\n        }\n        if(resultInt === -1) {\n            let currentWorstLossGame = null\n            if(Number.isInteger(currentMoveDetails.worstLoss)) {\n                currentWorstLossGame = this.graph.pgnStats[currentMoveDetails.worstLoss]\n            }\n            if(!currentWorstLossGame || parseInt(opponentElo)<parseInt(this.getOpponentElo(playerColor, currentWorstLossGame))) {\n                currentMoveDetails.worstLoss = resultObject.index\n            }\n        }\n        let currentLastPlayedGame = null\n        if(Number.isInteger(currentMoveDetails.lastPlayed)) {\n            currentLastPlayedGame = this.graph.pgnStats[currentMoveDetails.lastPlayed]\n        }\n        if(!currentLastPlayedGame || \n            isDateMoreRecentThan(resultObject.date, currentLastPlayedGame.date)) {\n                currentMoveDetails.lastPlayed = resultObject.index\n        }\n        currentMoveDetails.blackWins += blackWin\n        currentMoveDetails.whiteWins += whiteWin\n        currentMoveDetails.draws += draw\n        currentMoveDetails.totalOpponentElo += parseInt(opponentElo)\n        return currentMoveDetails\n    }\n\n    getOpponentElo(playerColor, resultObject) {\n        if(playerColor === Constants.PLAYER_COLOR_WHITE) {\n            return resultObject.blackElo\n        }\n        return resultObject.whiteElo\n    }\n\n    gameResultsForFen(fullFen) {\n        let fen = simplifiedFen(fullFen)\n\n        var currNode = this.graph.nodes.get(fen)\n        if(currNode && currNode.gameResults) {\n            return currNode.gameResults.map((index)=>this.graph.pgnStats[index])\n        }\n        return null\n    }\n    movesForFen(fullFen) {\n        let fen = simplifiedFen(fullFen)\n\n        var currNode = this.graph.nodes.get(fen)\n        if(currNode) {\n            return Array.from(Object.entries(currNode.playedBy)).map((entry)=> {\n                let chess = new Chess(fullFen)\n                let move = chess.move(entry[0], {sloppy: true})\n                let targetNodeDetails = this.getDetailsForFen(chess.fen())\n                return {\n                    orig:move.from,\n                    dest:move.to,\n                    level:this.levelFor(targetNodeDetails.count, currNode.playedByMax),\n                    san:move.san,\n                    details:targetNodeDetails\n                }\n            })\n        }        \n        return null\n    }\n\n    levelFor(moveCount, maxCount){\n        if(maxCount <= 0 ||moveCount/maxCount > 0.8) {\n            return 2\n        }\n        if(moveCount/maxCount>0.3) {\n            return 1\n        }\n        return 0\n    }\n\n}\n\n\nclass Graph {\n    constructor(arrayEntries, pgnStats){\n        this.nodes = new Map()\n        this.pgnStats = []\n        this.playerColor = ''\n        if(arrayEntries) {\n            arrayEntries.forEach((entry)=> {\n                this.nodes.set(entry[0],entry[1])\n            })\n        }\n        if(pgnStats) {\n            this.pgnStats = pgnStats\n        }\n    }\n}\n\nclass GraphNode {\n            playedByMax = 0 // used to keep track of how many times the most frequent move is played for ease of calculation later\n            //playedBy = {}\n            //gameResults = []\n}\n\nfunction emptyDetails() {\n    return {\n//        count: 0,\n        blackWins: 0,\n        whiteWins: 0,\n        draws: 0,\n        totalOpponentElo: 0,\n//        bestWin:null,\n//        bestWinGame:null,\n//        worstLoss:null,\n//        worstLossGame:null,\n        lastPlayed:null\n//        lastPlayedGame:null\n    }\n}\n\nexport const openingGraph = new OpeningGraph()","import * as Constants from './Constants'\n\nexport default class OpeningManager {\n    plys = [{pgn:'', fen:Constants.ROOT_FEN, move:null}]\n    currentIndex = 0\n    addPly(fen,move) {\n        if(this.currentIndex<this.plys.length-1 && this.plys[this.currentIndex+1].move.san === move.san) {\n            this.moveForward()\n            return\n        }\n        this.plys = this.plys.slice(0,this.currentIndex+1)\n        this.plys.push({\n            pgnAsList:this.pgnAsList(move.san),\n            fen: fen,\n            move: move\n        })\n        this.currentIndex++;\n        return this.plys[this.currentIndex]\n    }\n\n    pgnAsList(san) {\n        let pgnSoFar = this.pgnListSoFar()\n        let pgnList\n        if (!pgnSoFar) {\n            pgnList = []\n        } else {\n            pgnList = [...pgnSoFar]\n        }\n        let numPlys = this.plys.length\n        if(numPlys%2 !== 0) {\n            pgnList.push({\n                moveNumber:pgnList.length+1,\n                whitePly:san,\n                blackPly:''\n            })\n        } else {\n            let currMove = pgnList[pgnList.length-1]\n            currMove.blackPly = san\n            pgnList[pgnList.length-1] = currMove\n        }\n        return pgnList\n    }\n\n    currentMove() {\n        return Math.floor((this.currentIndex-1)/2);\n    }\n\n    pgnListSoFar(){\n        return this.plys[this.plys.length-1].pgnAsList\n    }\n\n    fen(){\n        return this.plys[this.currentIndex].fen\n    }\n\n    moveForward() {\n        return this.moveTo(this.currentIndex+1)\n    }\n    moveBack() {\n        return this.moveTo(this.currentIndex-1)\n    }\n    moveTo(index) {\n        if(index>=0 && index<this.plys.length) {\n            this.currentIndex = index\n        }\n        return this.plys[this.currentIndex]\n    }\n\n}","import React from 'react'\nimport ChessEcoCodes from 'chess-eco-codes'\nimport OpeningManager from '../app/OpeningManager'\nimport {Container, Row, Col, Button} from 'reactstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faStepForward, faStepBackward } from '@fortawesome/free-solid-svg-icons'\nimport * as Constants from '../app/Constants'\nimport {trackEvent} from '../app/Analytics'\n\nexport default class Navigator extends React.Component {\n    \n    constructor(props){\n        super(props)\n        this.openingManager = new OpeningManager()\n        this.state = {\n            currentMove:0,\n          }      \n          window.addEventListener(\"keydown\",this.keyHandler.bind(this))\n  \n    }\n    keyHandler(e){\n        switch(e.keyCode) {\n          case 37:\n            this.previous(e, \"keyboard\")\n          break\n          case 39:\n            this.next(e, \"keyboard\")\n            break\n          default:\n            break\n\n        }\n      }\n    \n    shouldComponentUpdate(newProps) {\n        //console.log(newProps)\n        if(newProps.fen !== this.openingManager.fen()) {\n            if(newProps.move === null) {\n                this.openingManager = new OpeningManager()\n                return true\n            }\n            this.openingManager.addPly(newProps.fen, newProps.move)\n            return true\n        }\n        return true\n    }\n\n    previous(e, device) {\n        let newState = this.openingManager.moveBack()\n        this.props.onChange(newState.fen, newState.move)\n        this.setState({currentMove:this.openingManager.currentMove()})\n        trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"Previous\", device?device:\"mouse\")\n    }\n\n    next(e, device) {\n        let newState = this.openingManager.moveForward()\n        this.props.onChange(newState.fen, newState.move)\n        this.setState({currentMove:this.openingManager.currentMove()})\n        trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"Next\", device?device:\"mouse\")\n    }\n\n    moveTo(index) {\n        return () => {\n            let newState = this.openingManager.moveTo(index*2+1)\n            this.props.onChange(newState.fen, newState.move)\n            this.setState({currentMove:this.openingManager.currentMove()})\n            trackEvent(Constants.EVENT_CATEGORY_NAVIGATOR, \"move\", null, index)\n        }\n    }\n\n    render(){\n        let opening = ChessEcoCodes(this.openingManager.fen())\n        if (opening) {\n            this.opening = opening.name\n            this.openingCode = opening.code\n        }\n        if(!this.openingManager.pgnListSoFar()) {\n            return <div></div>\n        }\n        return <Container>\n            <Row>\n            <Col lg=\"6\" className=\"navSection\"><Button color=\"\" className= \"settingButton\" onClick= {this.previous.bind(this)}><FontAwesomeIcon icon={faStepBackward} /> prev</Button> </Col>\n            <Col lg=\"6\" className=\"navSection\"><Button color=\"\" className= \"settingButton\" onClick = {this.next.bind(this)}>next <FontAwesomeIcon icon={faStepForward} /></Button></Col></Row>\n            <Row className=\"greyText\">{this.openingCode}: {this.opening}</Row>\n            {\n                this.openingManager.pgnListSoFar().map((move, index)=>\n                    <Row key={`${move.moveNumber}`} onClick={this.moveTo(index).bind(this)} className={`navCol ${this.openingManager.currentMove() === index? 'selectedMove':''}`}>\n                        <Col sm=\"12\" className = \"navMove border\">{`${move.moveNumber}. ${move.whitePly} ${move.blackPly}`}</Col>\n                    </Row>)\n            }\n        </Container>\n    }\n}","import React, { useState } from 'react'\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {faComments, faCaretDown} from '@fortawesome/free-solid-svg-icons'\nimport { faDiscord } from '@fortawesome/free-brands-svg-icons'\nimport * as Constants from '../app/Constants'\n\nimport {\n  Navbar,\n  NavbarBrand,\n  NavbarToggler,\n  Collapse,\n  Nav,\n  UncontrolledDropdown,\n  DropdownToggle,\n  DropdownMenu,\n  DropdownItem,\n  Modal,\n  ModalHeader,\n  ModalFooter,\n  Button,\n  ListGroup,\n  ListGroupItem,\n  NavItem, NavLink\n} from 'reactstrap'\n\nconst GlobalHeader = (props) => {\n  const [isOpen, setIsOpen] = useState(false)\n  const [modal, setModal] = useState(false);\n\n  const toggle = () => setIsOpen(!isOpen)\n  const toggleModal = () => setModal(!modal)\n\n  const launch = (url) => {\n    return () => {\n      window.open(url, \"_blank\")\n    }\n  }\n  return (\n    <div>\n      <Navbar color=\"light\" light expand=\"md\">\n        <img src=\"/opening-tree-logo.png\" height=\"32px\" width=\"32px\" alt=\"Logo\"/>\n        <NavbarBrand href=\"/\">&nbsp;OpeningTree.com</NavbarBrand>\n        <NavbarToggler onClick={toggle}/>\n        <Collapse isOpen={isOpen} navbar>\n          <Nav className=\"mr-auto\" navbar>\n          <NavItem><NavLink className=\"navLinkButton\" onClick={launch(\"https://www.youtube.com/watch?v=AJ66-HqdpXE\")}>\"It's so powerful\" - IM Eric Rosen <span className=\"smallText\">[Watch video]</span></NavLink></NavItem>\n          </Nav>\n          <Nav className=\"ml-auto\" navbar>\n          <NavItem><NavLink className=\"navLinkButton\" onClick={launch(Constants.OPENING_TREE_DISCORD)}><FontAwesomeIcon icon={faDiscord} className=\"discordIcon\"/> Join our discord</NavLink></NavItem>\n          </Nav>\n          <Nav className=\"\" navbar>\n          <NavItem><NavLink className=\"navLinkButton\" onClick={props.toggleFeedback}><FontAwesomeIcon icon={faComments} className=\"feedbackIcon\"/> Send feedback</NavLink></NavItem>\n          </Nav>\n          <UncontrolledDropdown>\n              <DropdownToggle className=\"bootNavColor\" nav>\n              <FontAwesomeIcon icon={faCaretDown} className=\"moreIcon\"/>More\n              </DropdownToggle>\n              <DropdownMenu right>\n                <DropdownItem onClick={toggleModal}>\n                  Acknowledgements\n                </DropdownItem>\n                <DropdownItem onClick={launch(\"https://www.openingtree.com/old\")}>\n                  Old version\n                </DropdownItem>\n                <DropdownItem divider />\n                <DropdownItem onClick={launch(\"https://lichess.org/\")}>\n                  Lichess\n                </DropdownItem>\n                <DropdownItem onClick={launch(\"https://www.lichess4545.com/\")}>\n                  Lichess4545\n                </DropdownItem>\n                <DropdownItem onClick={launch(\"https://www.chess.com\")}>\n                  Chess.com\n                </DropdownItem>\n              </DropdownMenu>\n            </UncontrolledDropdown>\n        </Collapse>\n      </Navbar>\n      \n      <Modal isOpen={modal} toggle={toggleModal}>\n        <ModalHeader toggle={toggleModal}>Acknowledgements</ModalHeader>\n        <ListGroup className=\"acknowledgement\">\n        <ListGroupItem tag=\"a\" href=\"https://lichess.org/api\" target=\"_blank\" action>Lichess API</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.chess.com/club/chess-com-developer-community\" target=\"_blank\" action>Chess.com API</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/ruilisi/react-chessground\" target=\"_blank\" action>ChessGround</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/jhlywa/chess.js\" target=\"_blank\" action>Chess.js</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/niklasf/eco\" target=\"_blank\" action>Eco</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/jimmywarting/StreamSaver.js\" target=\"_blank\" action>StreamSaver.js</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.flaticon.com/authors/google/\" target=\"_blank\" action>Icons made by google</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.flaticon.com/\" target=\"_blank\" action>FlatIcons.com</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.freelogodesign.org\" target=\"_blank\" action>Free logo design</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://github.com/kevinludwig/pgn-parser\" target=\"_blank\" action>PGN Parser</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.npmjs.com/package/material-ui-dropzone\" target=\"_blank\" action>Dropzone</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.pgnmentor.com\" target=\"_blank\" action>PGN Mentor</ListGroupItem>\n        <ListGroupItem tag=\"a\" href=\"https://www.twitch.tv/imrosen\" target=\"_blank\" action>IM Eric Rosen</ListGroupItem>\n        </ListGroup>\n        <ModalFooter>\n          <Button color=\"secondary\" onClick={toggleModal}>Done</Button>\n        </ModalFooter>\n      </Modal>\n    </div>\n  )\n}\n\nexport default GlobalHeader\n","import React from 'react'\nimport {getNumberIcon} from './Common'\nimport { Radio, FormControlLabel, RadioGroup } from '@material-ui/core';\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport Collapse from '@material-ui/core/Collapse';\nimport {ExpansionPanel} from './Common'\nimport * as Constants from '../../app/Constants'\nimport Backup from '@material-ui/icons/Backup';\nimport People from '@material-ui/icons/People';\nimport Save from '@material-ui/icons/Save';\nimport Divider from '@material-ui/core/Divider';\nimport DateRange from '@material-ui/icons/DateRange';\nimport {Badge} from 'reactstrap'\n\nexport default class Source extends React.Component {\n    getSourceOption(source, addNumber) {\n        if (source === Constants.SITE_LICHESS) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<img alt=\"lichess\" className=\"siteimage\" src=\"./lichesslogo.png\" /><span className=\"sourceName\"> lichess.org </span></span>\n        } else if (source === Constants.SITE_CHESS_DOT_COM) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<img alt=\"chess.com\" className=\"siteimage\" src=\"./chesscomlogo.png\" /></span>\n        } else if (source === Constants.SITE_PGN_FILE) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<Backup className=\"lowOpacity\"/><span className=\"sourceName\"> Upload PGN file</span></span>\n        } else if (source === Constants.SITE_EVENT_DB) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<DateRange className=\"lowOpacity\"/><span className=\"sourceName\"> Notable chess events</span></span>\n        } else if (source === Constants.SITE_PLAYER_DB) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<People className=\"lowOpacity\"/><span className=\"sourceName\"> Notable chess players</span></span>\n        }  else if (source === Constants.SITE_OPENING_TREE_FILE) {\n            return <span>{addNumber?getNumberIcon('done', addNumber):null}<Save className=\"lowOpacity\"/><span className=\"sourceName\"> Openingtree file <Badge className=\"sourceName\" color=\"secondary\">New</Badge></span></span>\n        }\n        return <span>{getNumberIcon(1, addNumber)}Select a source</span>\n    }\n\n    render() {\n        return <ExpansionPanel TransitionComponent={Collapse}\n            TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n            expanded={this.props.expandedPanel === 'source'}\n            onChange={this.props.handleExpansionChange}>\n            <ExpansionPanelSummary\n                expandIcon={<ExpandMoreIcon />}\n                aria-controls=\"panel1c-content\"\n                id=\"panel1c-header\"\n            >\n                <div>\n                    {this.getSourceOption(this.props.site, true)}\n                </div>\n            </ExpansionPanelSummary>\n            <ExpansionPanelDetails>\n                <RadioGroup onChange={this.props.siteChange} value={this.props.site}>\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_LICHESS} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_LICHESS)} />\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_CHESS_DOT_COM} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_CHESS_DOT_COM)} />\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_OPENING_TREE_FILE} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_OPENING_TREE_FILE)} />\n                    <Divider className=\"dividerMargin\"/>\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_PLAYER_DB} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_PLAYER_DB)} />\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_EVENT_DB} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_EVENT_DB)} />\n                    <FormControlLabel className=\"sitelabel\" value={Constants.SITE_PGN_FILE} control={<Radio color=\"primary\" />} label={this.getSourceOption(Constants.SITE_PGN_FILE)} />\n               </RadioGroup>\n            </ExpansionPanelDetails>\n        </ExpansionPanel>\n        \n    }\n}","import React from 'react'\nimport {DropzoneArea} from 'material-ui-dropzone'\nimport { trackEvent } from '../../app/Analytics'\nimport * as Constants from '../../app/Constants'\n\nexport default class Dropzone extends React.Component{\n    handleFileChange(newFiles) {\n      trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"FileSaved\", newFiles.length>0?newFiles[0].name:null)\n      this.props.filesChange(newFiles)\n    }\n    render(){\n      return (\n        <DropzoneArea \n        acceptedFiles={[]}\n        dropzoneText={this.props.dropzoneText}\n          onChange={this.handleFileChange.bind(this)}\n          dropzoneParagraphClass=\"dropzonetext\"\n          showFileNames={true}\n          useChipsForPreview={true}\n          previewChipProps={{className:\"previewChip\"}}\n          dropzoneClass=\"dropzone\"\n          filesLimit={this.props.filesLimit}\n          maxFileSize={3000000000000}\n          />\n      )  \n    }\n  } ","import SelectSearch from 'react-select-search';\nimport React from 'react'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics';\nimport { LazyLoadImage } from 'react-lazy-load-image-component';\n\nexport default class NotableChessGames extends React.Component {\n\n    updateDetails = (value) => {\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"NotableGameSelected\", value.value)\n        this.props.onChange(value)\n    }\n    \n    renderDetails(option) {\n        return (<div>\n                <span><LazyLoadImage alt={option.name} className=\"profilePicture\" width=\"40\" height=\"40\" src={option.profile.imageUrl} /></span>\n                <div>{option.name}</div>\n                <div className=\"smallText\">{option.profile.subText}</div>\n                </div>);\n    }\n    render() {\n        if(!this.props.list) {\n            return <div className=\"lowOpacity textCenter\"><img alt=\"loading\" width='25' height='25' src=\"./spinner.gif\"/> Loading List</div>\n        } else if(!this.props.list.length) {\n            return <div className=\"lowOpacity textCenter\"> Could not fetch list</div>\n        }\n        let options = this.props.list.map(option=>{return {...option, value:option.name}})\n        return <SelectSearch\n            name=\"goatPlayers\"\n            value={this.props.selectedDetail.value}\n            options={options}\n            placeholder={this.props.placeholder}\n            renderOption={this.renderDetails}\n            onChange={this.updateDetails}\n        />\n    }\n}\n","import React from 'react'\nimport {getNumberIcon} from './Common'\nimport ExpansionPanelDetails from '@material-ui/core/ExpansionPanelDetails';\nimport ExpansionPanelSummary from '@material-ui/core/ExpansionPanelSummary';\nimport { Button as MaterialUIButton, TextField } from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faInfoCircle } from '@fortawesome/free-solid-svg-icons'\nimport Divider from '@material-ui/core/Divider';\nimport ExpansionPanelActions from '@material-ui/core/ExpansionPanelActions';\nimport {ExpansionPanel} from './Common'\nimport * as Constants from '../../app/Constants'\nimport Collapse from '@material-ui/core/Collapse';\nimport Dropzone from './Dropzone'\nimport NotableChessGames from './NotableChessGames';\nimport {Card, CardBody, CardText, CardTitle} from 'reactstrap'\n\nexport default class User extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            playerName:'',\n            files:[],\n            selectedPlayer:{},\n            selectedEvent:{}\n        }\n    }\n\n    editPlayerName(event) {\n        this.setState({\n            playerName: event.target.value,\n            playerNameError:''\n        })\n    }\n\n    filesChange(files) {\n        this.setState({files:files})\n    }\n\n    notablePlayerChange(player) {\n        this.setState({\n            selectedPlayer:player})\n    }\n    notableEventChange(event) {\n        this.setState({\n            selectedEvent:event})\n    }\n\n    componentWillReceiveProps() {\n        this.setState({playerNameError:''})\n    }\n\n    validateInputDetailsSet() {\n        if(this.props.site === Constants.SITE_EVENT_DB){\n            if(!this.state.selectedEvent){\n                this.props.showError(\"Please select an event\")\n                return false\n            } \n        } else if(this.props.site === Constants.SITE_PLAYER_DB){\n            if(!this.state.selectedPlayer){\n                this.props.showError(\"Please select a player\")\n                return false\n            } \n        } else if(this.props.site === Constants.SITE_LICHESS ||\n            this.props.site === Constants.SITE_CHESS_DOT_COM) {\n                if(!this.state.playerName){\n                    this.setState({\n                        playerNameError:'Please enter a username'\n                    })\n                    return false\n                } \n        } else if(this.props.site === Constants.SITE_PGN_FILE) {\n            if(this.state.files.length === 0) {\n                this.props.showError(\"Please upload a PGN file\")\n                return false\n            }\n        } else if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            if(this.state.files.length === 0) {\n                this.props.showError(\"Please upload an openingtree file\")\n                return false\n            }\n        } \n        return true\n    }\n    finalPlayerName(source, playerName, selectedNotablePlayer) {\n        if(source === Constants.SITE_PLAYER_DB) {\n            return selectedNotablePlayer.name\n        }\n        if(source === Constants.SITE_EVENT_DB) {\n            return ''\n        }\n        return playerName\n    }\n    setPlayerDetails() {\n         if(this.validateInputDetailsSet()) {\n            this.props.playerDetailsChange(\n                this.finalPlayerName(\n                    this.props.site, \n                    this.state.playerName,\n                    this.state.selectedPlayer), \n                this.state.files, \n                this.state.selectedEvent, \n                this.state.selectedPlayer)\n        }\n    }\n    \n    getSummary() {\n        if(this.props.site === Constants.SITE_PLAYER_DB){\n            if(this.props.selectedPlayer && this.props.selectedPlayer.name) {\n                return <span>\n                        {getNumberIcon('done')}\n                        {this.props.selectedPlayer.profile.title}{'\\u00A0'}\n                        <b>{this.props.selectedPlayer.name}</b>\n                    </span>\n            }\n        } else if(this.props.site === Constants.SITE_LICHESS || \n            this.props.site === Constants.SITE_CHESS_DOT_COM){\n            if(this.props.playerName) {\n                return <span>{getNumberIcon('done')}User: <b>{this.props.playerName}</b></span>\n            }\n        } else if(this.props.site === Constants.SITE_PGN_FILE || \n            this.props.site === Constants.SITE_OPENING_TREE_FILE){\n            if(this.props.files.length===1) {\n                return <span>{getNumberIcon('done')}File: <b>{this.props.files[0].name}</b></span>\n            }\n            if(this.props.files.length>1) {\n                return <span>{getNumberIcon('done')}{this.props.files.length} PGN files uploaded</span>\n            }\n        } else if(this.props.site === Constants.SITE_EVENT_DB) {\n            if(this.props.selectedEvent && this.props.selectedEvent.name) {\n                return <span>{getNumberIcon('done')}{this.props.selectedEvent.name}</span>\n            }\n        }\n        return <span>{getNumberIcon(2)}Player details</span>\n    }\n\n    getPlayerNameInput(label, helperText) {\n        return <TextField\n            className=\"playernameField\" name=\"playerName\" id=\"playerNameTextBox\" \n            margin=\"dense\" onChange={this.editPlayerName.bind(this)}\n            label={label} variant=\"outlined\" value={this.state.playerName}\n            helperText={this.state.playerNameError? this.state.playerNameError:helperText}\n            error={this.state.playerNameError?true:false} onKeyUp={this.playerNameKeyUp.bind(this)}/>\n    }\n\n    playerNameKeyUp(evt) {\n        if(evt.keyCode === 13) { // enter key pressed\n            this.setPlayerDetails()\n        }\n    }\n    getGoatDBSelection(){\n        return <NotableChessGames \n            list={this.props.notablePlayers} \n            placeholder=\"Select a player\"\n            onChange={this.notablePlayerChange.bind(this)}\n            selectedDetail={this.state.selectedPlayer}/>\n    }\n    getGoatDBEventSelection(){\n        return <NotableChessGames \n            list={this.props.notableEvents} \n            placeholder=\"Select an event\"\n            onChange={this.notableEventChange.bind(this)}\n            selectedDetail={this.state.selectedEvent}/>\n    }\n\n    getPgnFileSelection() {\n        return <div><Dropzone filesChange={this.filesChange.bind(this)} filesLimit={10}\n        dropzoneText=\"Drag and drop up to 10 pgn files here or click here to select files\"\n                />\n                {this.getPlayerNameInput('player name in PGN', 'Leave blank to load all games')}\n                </div>\n    }\n\n    getOpeningTreeSelection() {\n        return <div>\n            <Card>\n                <CardBody className=\"singlePadding\">\n                <CardTitle className=\"smallBottomMargin\"><FontAwesomeIcon icon={faInfoCircle} className=\"lowOpacity\"/> How it works</CardTitle>\n                <CardText className=\"smallText\">\n                    If you plan to revisit the same player, you can save a <b>.tree</b> file locally by loading a tree and then clicking <i>\"Save Openingtree\"</i>.\n                    To reload the same tree, drop the <b>.tree</b> file in the dropzone below.\n                </CardText>\n                </CardBody>\n                </Card><br/>\n            <Dropzone filesChange={this.filesChange.bind(this)} filesLimit={1}\n                    dropzoneText=\"Drag and drop openingtree save file here or click here to select a file\"\n                />\n        </div>\n    }\n\n    getInputsToShow() {\n        if(this.props.site === Constants.SITE_PGN_FILE) {\n            return this.getPgnFileSelection()\n        } else if (this.props.site === Constants.SITE_LICHESS) {\n            return this.getPlayerNameInput('lichess username')\n        } else if (this.props.site === Constants.SITE_CHESS_DOT_COM) {\n            return this.getPlayerNameInput('chess.com username')\n        } else if (this.props.site === Constants.SITE_EVENT_DB) {\n            return this.getGoatDBEventSelection()\n        } else if (this.props.site === Constants.SITE_PLAYER_DB) {\n            return this.getGoatDBSelection()\n        } else if(this.props.site === Constants.SITE_OPENING_TREE_FILE) {\n            return this.getOpeningTreeSelection()\n        }\n        return <div/>\n    }\n\n    render() {\n        return <ExpansionPanel expanded={this.props.expandedPanel === 'user'}\n                TransitionComponent={Collapse}\n                TransitionProps={{timeout:Constants.LOADER_ANIMATION_DURATION_MS}}\n                onChange={this.props.handleExpansionChange} \n                disabled={this.props.site===''}>\n                <ExpansionPanelSummary expandIcon={<ExpandMoreIcon />}>{this.getSummary()}</ExpansionPanelSummary>\n                <ExpansionPanelDetails>\n                        {this.getInputsToShow()}\n                </ExpansionPanelDetails>\n                <Divider />\n                <ExpansionPanelActions>\n                    <MaterialUIButton size=\"small\" color=\"primary\" onClick={this.setPlayerDetails.bind(this)}>Continue</MaterialUIButton>\n                </ExpansionPanelActions></ExpansionPanel>\n            \n    }\n}","import React from 'react'\nimport { createSubObjectWithProperties, getTimeframeSteps } from '../../app/util'\nimport * as Constants from '../../app/Constants'\nimport { trackEvent } from '../../app/Analytics'\nimport Source from './Source'\nimport User from './User'\nimport Filters from './Filters'\nimport Actions from './Actions'\nimport request from 'request'\nimport * as SitePolicy from '../../app/SitePolicy'\nimport {openingGraph} from '../../app/OpeningGraph'\n\nexport default class PGNLoader extends React.Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            playerName: '',\n            site: '',\n            playerColor: this.props.settings.playerColor,\n            isAdvancedFiltersOpen: false,\n            isGamesSubsectionOpen: false,\n            expandedPanel: 'source',\n            notablePlayers:null,\n            notableEvents:null,\n            files:[],\n            selectedNotableEvent:{},\n            selectedNotablePlayer:{}\n\n        }\n        this.timeframeSteps = getTimeframeSteps()\n        this.state[Constants.FILTER_NAME_SELECTED_TIMEFRAME] = [0, this.timeframeSteps.length - 1]\n        this.state[Constants.FILTER_NAME_DOWNLOAD_LIMIT] = Constants.MAX_DOWNLOAD_LIMIT\n        this.state[Constants.TIME_CONTROL_ULTRA_BULLET] = true\n        this.state[Constants.TIME_CONTROL_BULLET] = true\n        this.state[Constants.TIME_CONTROL_BLITZ] = true\n        this.state[Constants.TIME_CONTROL_RAPID] = true\n        this.state[Constants.TIME_CONTROL_CLASSICAL] = true\n        this.state[Constants.TIME_CONTROL_CORRESPONDENCE] = true\n        this.state[Constants.TIME_CONTROL_DAILY] = true\n        this.state[Constants.FILTER_NAME_RATED] = \"all\"\n        this.state[Constants.FILTER_NAME_ELO_RANGE] = [0, Constants.MAX_ELO_RATING]\n    }\n\n\n    advancedFilters() {\n        return createSubObjectWithProperties(this.state,\n            [Constants.TIME_CONTROL_ULTRA_BULLET, Constants.TIME_CONTROL_BULLET,\n            Constants.TIME_CONTROL_BLITZ, Constants.TIME_CONTROL_RAPID,\n            Constants.TIME_CONTROL_CORRESPONDENCE, Constants.TIME_CONTROL_DAILY,\n            Constants.TIME_CONTROL_CLASSICAL, Constants.FILTER_NAME_RATED,\n            Constants.FILTER_NAME_SELECTED_TIMEFRAME, Constants.FILTER_NAME_DOWNLOAD_LIMIT,\n            Constants.FILTER_NAME_ELO_RANGE])\n    }\n\n\n    handleExpansionChange(panel) {\n        return (event, newExpanded) => {\n            this.setState({ expandedPanel: newExpanded ? panel : false });\n        };\n    }\n\n    exportOpeningTreeObject(){\n        return {\n            header:{\n                version:2,// current openingtree file version. used to check compatibility of files\n                timestamp:Math.floor(Date.now() / 1000),\n                gamesProcessed:this.props.gamesProcessed,\n                settings:this.props.settings,\n                playerName:this.state.playername,\n                site: this.state.site,\n                advancedFilters:this.advancedFilters()\n            },\n            arrays: [[...this.props.openingGraph.graph.nodes.entries()],\n                        [...this.props.openingGraph.graph.pgnStats]]\n        }\n    }\n\n    importOpeningTreeObject(openingTreeSave) {\n        let saveVersion = 1;\n        if(openingTreeSave.header.version) {\n            saveVersion = openingTreeSave.header.version\n        }\n        if(saveVersion < Constants.OPENING_TREE_FILE_CURRENT_VERSION) {\n            this.props.showError(\"This is an old format of openingtree file.\", null, \n                \"You can try loading it by visiting the old website\", Constants.ERROR_ACTION_VISIT_OLD_SITE)\n            return false\n        }\n        this.setState({\n            ...openingTreeSave.header.advancedFilters,\n            playerColor:openingTreeSave.header.settings.playerColor,\n            site:openingTreeSave.header.site,\n            playerName:openingTreeSave.header.settings.playerName\n        })\n        openingGraph.setEntries(openingTreeSave.arrays[0], openingTreeSave.arrays[1])\n        this.props.importCallback({\n            settings:openingTreeSave.header.settings,\n            gamesProcessed:openingTreeSave.header.gamesProcessed,\n            openingGraph:openingGraph\n        })\n        return true\n    }\n\n    playerDetailsChange(playerName, files, selectedNotableEvent, selectedNotablePlayer) {\n        this.setState({\n            playerName: playerName,\n            expandedPanel:SitePolicy.isFilterPanelEnabled(this.state.site, playerName, selectedNotablePlayer)?'filters':'',\n            files:files,\n            selectedNotableEvent:selectedNotableEvent,\n            selectedNotablePlayer:selectedNotablePlayer,\n            playerColor:''\n        })\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"PlayerNameSaved\")\n    }\n    fetchGOATGames(url, callback){\n        request.get(url, (error, response) =>{\n            if(error) {\n                this.props.showError(\"Could not fetch player list. Failed to connect to DB.\")\n                callback([])\n                return \n            }\n            let gamesDetails\n            try{\n                gamesDetails = JSON.parse(response.body).list\n            } catch (e) {\n                console.log(e)\n            }\n            if(!gamesDetails) {\n                this.props.showError(\"Failed to load games.\")\n                callback([])\n            } else {\n                callback(gamesDetails)\n            }\n        })\n    }\n\n    siteChange(event) {\n        let newSite = event.target.value\n        if(newSite === Constants.SITE_PLAYER_DB && !this.state.notablePlayers) {\n            this.fetchGOATGames('https://goatchess.github.io/list.json', (gamesDetails)=>{\n                this.setState({notablePlayers:gamesDetails})\n            })\n        }\n        if(newSite === Constants.SITE_EVENT_DB && !this.state.notableEvents) {\n            this.fetchGOATGames('https://goatevents.github.io/list.json', (gamesDetails)=>{\n                this.setState({notableEvents:gamesDetails})\n            })\n        }\n        this.setState({ site: newSite, expandedPanel:'user'})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"ChangeSite\", newSite)\n    }\n\n    filtersChange(filters) {\n        this.setState({...filters, expandedPanel:''})\n        trackEvent(Constants.EVENT_CATEGORY_PGN_LOADER, \"FitlersSaved\", this.state.site)\n    }\n\n    render() {\n        return <div><div className=\"pgnloadersection\">\n            <Source expandedPanel={this.state.expandedPanel}\n                handleExpansionChange={this.handleExpansionChange('source').bind(this)}\n                site={this.state.site} siteChange={this.siteChange.bind(this)}/>\n            <User expandedPanel={this.state.expandedPanel} playerName={this.state.playerName}\n                handleExpansionChange={this.handleExpansionChange('user').bind(this)} \n                showError={this.props.showError} files={this.state.files} notablePlayers={this.state.notablePlayers}\n                notableEvents={this.state.notableEvents} site={this.state.site} playerDetailsChange={this.playerDetailsChange.bind(this)}\n                pgnUrl={this.state.pgnUrl} selectedPlayer={this.state.selectedNotablePlayer} selectedEvent={this.state.selectedNotableEvent}/>\n            <Filters expandedPanel={this.state.expandedPanel} playerColor={this.state.playerColor}\n                handleExpansionChange={this.handleExpansionChange('filters').bind(this)}\n                site={this.state.site} playerName={this.state.playerName} advancedFilters={this.advancedFilters()}\n                timeframeSteps={this.timeframeSteps} filtersChange={this.filtersChange.bind(this)}\n                selectedNotablePlayer={this.state.selectedNotablePlayer} />\n            </div>\n            <Actions expandedPanel={this.state.expandedPanel} playerColor={this.state.playerColor} files={this.state.files}\n                playerName={this.state.playerName} site={this.state.site} advancedFilters={this.advancedFilters()}\n                notify={this.props.notify} showError={this.props.showError} onChange={this.props.onChange}\n                setDownloading={this.props.setDownloading} clear={this.props.clear} isDownloading={this.props.isDownloading}\n                switchToMovesTab={this.props.switchToMovesTab} gamesProcessed={this.props.gamesProcessed} \n                selectedNotablePlayer={this.state.selectedNotablePlayer} selectedNotableEvent={this.state.selectedNotableEvent}\n                exportOpeningTreeObject={this.exportOpeningTreeObject.bind(this)} showInfo={this.props.showInfo}\n                importOpeningTreeObject={this.importOpeningTreeObject.bind(this)}/>\n        </div>\n    }\n\n}","import React from 'react'\nimport {Button} from 'reactstrap'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faRetweet, faTrashAlt, faFastBackward, faDesktop } from '@fortawesome/free-solid-svg-icons'\nimport {Container, Row, Col} from 'reactstrap'\nimport {trackEvent} from '../app/Analytics'\nimport * as Constants from '../app/Constants'\n\nexport default class SettingsView extends React.Component {\n    toggle(eventName){\n        return (()=> {\n            let newValue = this.props.settings[eventName] === Constants.PLAYER_COLOR_WHITE ? Constants.PLAYER_COLOR_BLACK:Constants.PLAYER_COLOR_WHITE\n            this.props.onChange(eventName, newValue)\n            trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"ChangeOrientation\")\n        })\n    }\n    analyse() {\n        window.open(`https://www.lichess.org/analysis/standard/${this.props.fen}`, '_blank');\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"AnalyzeGame\")\n\n    }\n    resetAction() {\n        this.props.reset()\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"Reset\")\n    }\n    clearAction() {\n        this.props.clear()\n        trackEvent(Constants.EVENT_CATEGORY_CONTROLS, \"Clear\")\n    }\n\n    render() {\n        return <div>\n            <Container>\n                <Row sm=\"12\">\n                    <Col sm=\"6\">\n                        <Button className=\"settingButton\" onClick = {this.toggle('orientation')} color=\"\"><h3><FontAwesomeIcon icon={faRetweet} /></h3> Flip board</Button>\n                    </Col>\n                    <Col sm=\"6\">\n                        <Button className=\"settingButton\" onClick = {this.clearAction.bind(this)} color=\"\"><h3><FontAwesomeIcon icon={faTrashAlt} /></h3> Clear games</Button>\n                    </Col>\n                    <Col sm=\"6\">\n                        <Button className=\"settingButton\" onClick = {this.resetAction.bind(this)} color=\"\"><h3><FontAwesomeIcon icon={faFastBackward} /></h3> Starting position</Button>\n                    </Col>\n                    <Col sm=\"6\">\n                        <Button className=\"settingButton\" onClick = {this.analyse.bind(this)} color=\"\"><h3><FontAwesomeIcon icon={faDesktop} /></h3> Computer analysis</Button>\n                    </Col>\n                </Row>\n            </Container>\n        </div>\n    }\n}","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faExternalLinkAlt, faUser } from '@fortawesome/free-solid-svg-icons'\nimport { Table, TableRow, TableHead, TableBody, TableCell, TableFooter, TextField } from '@material-ui/core';\nimport React from 'react'\nimport {getPerformanceDetails} from '../app/util'\nimport {copyText} from './loader/Common'\n\nexport default class ControlsContainer extends React.Component {\n    eatClicks(e) {\n        e.stopPropagation()\n    }\n\n    copyFen() {\n        copyText(\"fenField\")/* Get the text field */\n        /* Alert the copied text */\n        this.props.showInfo(\"FEN copied\");\n    }\n\n    getFenField() {\n        return this.props.simplifiedView?null:\n            <div className=\"fenDiv\">\n            <TextField\n                id=\"fenField\"\n                multiline\n                label=\"FEN\"\n                rowsMax=\"2\"\n                value={this.props.fen} \n                inputProps={{\n                    style: {fontSize: 12},\n                    spellCheck: false,\n                  }} \n                  variant=\"outlined\"\n                className=\"fenField\"\n                margin=\"dense\"\n                onClick = {this.copyFen.bind(this)}\n                /></div>\n    }\n\n      \n    render() {\n        if(!this.props.moveDetails.lastPlayedGame) {\n            return <div>{this.getFenField()}<div className = \"infoMessage\" >No data to show. Please enter a lichess or chess.com user name in the \n                <span className = \"navLinkButton\" onClick={()=>this.props.switchToUserTab()}> <FontAwesomeIcon icon={faUser} /> User</span> tab and click \"Load\"</div>\n                </div>\n        }\n        let performanceDetails = {}\n        if(this.props.isOpen) {\n            performanceDetails = getPerformanceDetails(this.props.moveDetails.totalOpponentElo, \n                                                        this.props.moveDetails.whiteWins, \n                                                        this.props.moveDetails.draws, \n                                                        this.props.moveDetails.blackWins, \n                                                        this.props.settings.playerColor)\n        } \n\n        return <div>\n            {this.getFenField()}\n            <Table onClick={this.eatClicks}>\n            {isNaN(performanceDetails.performanceRating)?null:            <TableHead className={`performanceRatingRow${this.props.simplifiedView?\" performanceHeader\":\"\"}`}><TableRow>\n                <TableCell className=\"performanceRatingRow\"><b>Performance</b></TableCell>\n                <TableCell className=\"performanceRatingRow\"><b>{performanceDetails.performanceRating}</b></TableCell>\n                </TableRow></TableHead>}\n            <TableBody>\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Results</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.results}</TableCell>\n            </TableRow>\n            {isNaN(performanceDetails.averageElo)?null:\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Avg opponent</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.averageElo}</TableCell>\n            </TableRow>}\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Score</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.score}</TableCell>\n            </TableRow>\n            {this.props.simplifiedView || isNaN(performanceDetails.averageElo)?null:\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Rating change</TableCell>\n                <TableCell className=\"performanceRatingRow\">{performanceDetails.ratingChange}</TableCell>\n            </TableRow>\n            }\n            {!this.props.simplifiedView && this.props.moveDetails.bestWinElo?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Best win</TableCell>\n                <TableCell className=\"performanceRatingRow\">{this.props.moveDetails.bestWinElo} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(this.props.moveDetails.bestWinGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            {!this.props.simplifiedView && this.props.moveDetails.worstLossElo?<TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Worst loss</TableCell>\n                <TableCell className=\"performanceRatingRow\">{this.props.moveDetails.worstLossElo} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(this.props.moveDetails.worstLossGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>:null}\n            <TableRow className=\"performanceRatingRow\">\n                <TableCell className=\"performanceRatingRow\">Last played</TableCell>\n                <TableCell className=\"performanceRatingRow\">{this.removeQuestionMarksFromDate(this.props.moveDetails.lastPlayedGame.date)} <FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(this.props.moveDetails.lastPlayedGame)} icon={faExternalLinkAlt}/></TableCell>\n            </TableRow>\n            </TableBody>\n            {this.props.simplifiedView?null:\n            <TableFooter>\n                <TableRow>\n                    <TableCell colSpan=\"2\">Calculated based on <a href=\"https://handbook.fide.com/chapter/B022017\" target=\"_blank\" rel=\"noopener noreferrer\">FIDE regulations</a></TableCell>\n                </TableRow>\n            </TableFooter>\n            }\n        </Table></div>\n    }\n\n    removeQuestionMarksFromDate(date) {\n        if(date.indexOf('?') === -1) {\n            return date\n        }\n        return date.slice(0, date.indexOf('.'))\n    }\n}","import {Progress, Popover } from \"reactstrap\"\nimport React from 'react'\nimport { Table, TableRow, TableHead, TableBody, TableCell, TableFooter } from '@material-ui/core';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faUser, faExternalLinkAlt, faInfoCircle } from '@fortawesome/free-solid-svg-icons'\nimport * as Constants from '../app/Constants'\nimport {trackEvent} from '../app/Analytics'\nimport ReportControls from './ReportControls'\n\nexport default class MovesList extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            openPerformanceIndex: null\n        }\n    }\n\n    move(from, to) {\n        return () => {\n            this.props.onMove(from, to)\n            trackEvent(Constants.EVENT_CATEGORY_MOVES_LIST, \"MoveClicked\")\n        }\n    }\n    componentDidUpdate(prevProps, prevState) {\n        if(prevProps.turnColor !== this.props.turnColor) {\n            this.setState({\n                openPerformanceIndex: null,\n            })\n        }\n    }\n    togglePerformancePopover(moveIndex) {\n        return (e) => {\n            if(this.state.openPerformanceIndex !== null) {\n                this.setState({openPerformanceIndex:null})\n            } else {\n                this.setState({openPerformanceIndex: moveIndex})\n            }\n            e.stopPropagation()\n        }\n    }\n    render(){\n        if(!this.props.movesToShow) {\n            return <div className = \"infoMessage\" >No moves to show. Please select a source from the \n                <span className = \"navLinkButton\" onClick={()=>this.props.switchToUserTab()}> <FontAwesomeIcon icon={faUser} /> User</span> tab and enter the details.</div>\n        }\n    return <div>{(this.props.gameResults && this.props.gameResults.length>0)?this.resultsTable():null}\n                {this.movesTable()}</div>\n    }\n    resultsTable() {\n        return <Table>\n            <TableBody>\n                {\n                this.props.gameResults.map(result => {\n                    let whitePlayer = this.player(result.white, result.whiteElo)\n                    let blackPlayer = this.player(result.black, result.blackElo)\n                    return <TableRow className=\"moveRow\" key = {`${result.url}`} onClick={this.props.launchGame(result)}>\n                        <TableCell>\n                            {result.result===\"1-0\"?<b>{whitePlayer}</b>:whitePlayer} {result.result} {result.result === \"0-1\"?<b>{blackPlayer}</b>:blackPlayer}\n                        </TableCell>\n                    </TableRow>\n                })}\n            </TableBody>\n        </Table>\n    }\n    player(name, elo) {\n        return `${name}${elo?`(${elo})`:''}`\n    }\n    getPopover(moveIndex) {\n        let performancePopoverOpen = this.state.openPerformanceIndex === moveIndex\n        let openMove = this.props.movesToShow[moveIndex]\n\n        return <Popover trigger=\"hover\" placement=\"right\" isOpen={performancePopoverOpen} target={`performancePopover${moveIndex}`} toggle={this.togglePerformancePopover(moveIndex)}>\n                <ReportControls moveDetails={openMove.details} simplifiedView={true} isOpen = {performancePopoverOpen} launchGame={this.props.launchGame} settings={this.props.settings}/>\n            </Popover>\n    }\n    movesTable() {\n        let hasMoves = (this.props.movesToShow && this.props.movesToShow.length>0)\n        return <Table>\n            {hasMoves?\n        <TableHead>\n        <TableRow>\n            <TableCell size=\"small\" className=\"smallCol\"><b>Move</b></TableCell>\n            <TableCell size=\"small\" className=\"smallCol\"><b>Games</b></TableCell>\n            <TableCell><b>Results</b></TableCell>\n        </TableRow></TableHead>  \n        :null}\n        {hasMoves?\n        <TableBody>\n        {\n        this.props.movesToShow.map((move, moveIndex) => {\n            let sampleResultWhite = this.player(move.details.lastPlayedGame.white, move.details.lastPlayedGame.whiteElo)\n            let sampleResultBlack = this.player(move.details.lastPlayedGame.black, move.details.lastPlayedGame.blackElo)\n            let sampleResult = move.details.lastPlayedGame.result\n\n            return move.details.count > 1?<TableRow className=\"moveRow\" key = {`${move.orig}${move.dest}`} onClick={this.move(move.orig, move.dest)}>\n                <TableCell size=\"small\" className=\"smallCol\">{move.san} </TableCell>\n                <TableCell size=\"small\" id={`performancePopover${moveIndex}`} className=\"smallCol\" onClick ={this.togglePerformancePopover(moveIndex)}>\n                    {move.details.count} <FontAwesomeIcon className=\"lowOpacity\" icon={faInfoCircle}/>\n                    {this.getPopover(moveIndex)}\n                </TableCell>\n                <TableCell>\n                    <Progress className = \"border\" multi>\n                        <Progress bar className=\"whiteMove\" value={`${move.details.whiteWins/move.details.count*100}`}>{move.details.whiteWins/move.details.count>0.1?move.details.whiteWins:''}</Progress>\n                        <Progress bar className=\"grayMove\" value={`${move.details.draws/move.details.count*100}`}>{move.details.draws/move.details.count>0.1?move.details.draws:''}</Progress>\n                        <Progress bar className=\"blackMove\" value={`${move.details.blackWins/move.details.count*100}`}>{move.details.blackWins/move.details.count>0.1?move.details.blackWins:''}</Progress>\n                    </Progress>\n                </TableCell>\n            </TableRow>:\n            <TableRow className=\"moveRow\" key = {`${move.orig}${move.dest}`} onClick={this.move(move.orig, move.dest)}>\n                <TableCell size=\"small\" className=\"smallCol\">{move.san}</TableCell>\n                <TableCell colSpan = \"2\">\n        {sampleResultWhite} {sampleResult} {sampleResultBlack} {<FontAwesomeIcon className=\"pointerExternalLink\" onClick ={this.props.launchGame(move.details.lastPlayedGame)} icon={faExternalLinkAlt}/>}\n                </TableCell>\n            </TableRow>\n            }\n        )}\n    </TableBody>\n    :null}\n        <TableFooter><TableRow>\n        {this.props.settings.playerName?\n\n            hasMoves?\n                <TableCell colSpan=\"3\">\n                Showing moves that have been \n                played {this.props.turnColor === this.props.settings.playerColor? \"by\" : \"by others against\"} <b>{this.props.settings.playerName}</b> in \n                this position. <b>{this.props.settings.playerName}</b> is playing as <b>{this.props.settings.playerColor}</b>.\n                </TableCell>:\n                <TableCell colSpan=\"3\">\n                No moves found played by {this.props.turnColor === this.props.settings.playerColor? \"by\" : \"by others against\"} <b>{this.props.settings.playerName}</b> in \n                this position. <b>{this.props.settings.playerName}</b> is playing as <b>{this.props.settings.playerColor}</b>.\n                </TableCell>\n            :\n            hasMoves?\n                <TableCell colSpan=\"3\">\n                Showing all moves that have been \n                played by <b>{this.props.turnColor}</b> in \n                this position.\n                </TableCell>:                \n                <TableCell colSpan=\"3\">\n                No moves found \n                played by <b>{this.props.turnColor}</b> in \n                this position.\n                </TableCell>\n\n\n        }</TableRow></TableFooter>\n    </Table>\n    }\n}","import React from 'react'\nimport PGNLoader from './loader/PGNLoader'\nimport SettingsView from './Settings'\nimport { TabContent, TabPane, Nav, NavItem, NavLink, Row, Col,Button } from 'reactstrap';\nimport classnames from 'classnames';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faUser, faList, faCog, faChartBar } from '@fortawesome/free-solid-svg-icons'\nimport MovesList from './MovesList';\nimport {trackEvent} from '../app/Analytics'\nimport * as Constants from '../app/Constants'\nimport ReportControls from './ReportControls'\nimport {Modal, ModalHeader, ModalFooter} from 'reactstrap'\nimport {Table, TableRow, TableBody, TableCell} from '@material-ui/core'\n\nexport default class ControlsContainer extends React.Component {\n    constructor(props){\n      super(props)\n      this.state = {\n          activeTab:'user',\n          activeGame:null\n      }\n      this.toggleModal = ()=>{\n        this.setState({activeGame:null})\n      }\n    }\n    \n\n    launchGame(game) {\n      if(game.url) {\n          return (e) => {\n              e.stopPropagation()\n              window.open(game.url, '_blank');\n              trackEvent(Constants.EVENT_CATEGORY_MOVES_LIST, \"ViewGameExternal\")\n          }\n      }\n      return ((e) => {\n        e.stopPropagation()\n        this.setState({activeGame:game})\n      })\n    }\n\n    toggle(tab) {\n        if(this.state.activeTab !== tab) {\n            this.setState({activeTab:tab})\n            trackEvent(Constants.EVENT_CATEGORY_CONTROLS,`activeTab:${tab}`)\n        }\n    }\n    switchToUserTab() {\n      this.toggle('user')\n    }\n    switchToMovesTab() {\n      this.toggle('moves')\n    }\n\n    render(){\n        return <div>\n              <Modal isOpen={this.state.activeGame} toggle={this.toggleModal}>\n              <ModalHeader toggle={this.toggleModal}>Game details</ModalHeader>\n              {!this.state.activeGame?null:\n              <Table>\n                \n                <TableBody>\n                  {\n                    Object.entries(this.state.activeGame.headers).map((entry)=>!entry[1]?null:<TableRow className=\"performanceRatingRow\">\n                        <TableCell className=\"performanceRatingRow\">{entry[0]}</TableCell>\n                        <TableCell className=\"performanceRatingRow\">{entry[1]}</TableCell>\n                    </TableRow>\n                    )}\n                  \n                </TableBody>\n              </Table>\n              }\n              <ModalFooter>\n          <Button color=\"secondary\" onClick={this.toggleModal}>Done</Button>\n        </ModalFooter>\n              </Modal>\n            <Nav tabs>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'user' })}\n            onClick={() => { this.toggle('user'); }}\n          >\n            <FontAwesomeIcon icon={faUser} /> {this.state.activeTab === 'user'?\"User\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'moves' })}\n            onClick={() => { this.toggle('moves'); }}\n          >\n            <FontAwesomeIcon icon={faList} /> {this.state.activeTab === 'moves'?\"Moves\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'report' })}\n            onClick={() => { this.toggle('report'); }}\n          >\n            <FontAwesomeIcon icon={faChartBar} /> {this.state.activeTab === 'report'?\"Report\":\"\"}\n          </NavLink>\n        </NavItem>\n        <NavItem>\n          <NavLink\n            className={classnames({ active: this.state.activeTab === 'settings' })}\n            onClick={() => { this.toggle('settings'); }}\n          >\n            <FontAwesomeIcon icon={faCog} /> {this.state.activeTab === 'settings'?\"Controls\":\"\"}\n          </NavLink>\n        </NavItem>\n      </Nav>\n      <TabContent activeTab={this.state.activeTab}>\n        <TabPane tabId=\"user\">\n            <PGNLoader \n              switchToMovesTab={this.switchToMovesTab.bind(this)} \n              clear = {this.props.clear} \n              gamesProcessed = {this.props.gamesProcessed} \n              settings = {this.props.settings} \n              onChange = {this.props.settingsChange} \n              notify = {this.props.updateProcessedGames}\n              showError = {this.props.showError}\n              showInfo = {this.props.showInfo}\n              setDownloading = {this.props.setDownloading}\n              isDownloading = {this.props.isDownloading}\n              openingGraph={this.props.openingGraph}\n              importCallback={this.props.importCallback}\n              />\n            </TabPane>\n        <TabPane tabId=\"moves\">\n            <MovesList \n              switchToUserTab={this.switchToUserTab.bind(this)} \n              movesToShow={this.props.movesToShow} \n              gameResults={this.props.gameResults}\n              onMove={this.props.onMove}\n              settings={this.props.settings}\n              turnColor={this.props.turnColor}\n              settingsChange={this.props.settingsChange}\n              launchGame = {this.launchGame.bind(this)}\n              />\n        </TabPane>\n        <TabPane tabId=\"report\">\n          <ReportControls fen={this.props.fen} simplifiedView = {false}\n            moveDetails = {this.props.openingGraph.getDetailsForFen(this.props.fen)}\n            launchGame={this.launchGame.bind(this)} settings={this.props.settings}\n            switchToUserTab={this.switchToUserTab.bind(this)} \n            isOpen = {this.state.activeTab === \"report\"}\n            showInfo = {this.props.showInfo}/>\n        </TabPane>\n        <TabPane tabId=\"settings\">\n          <Row>\n            <Col sm=\"6\">\n            <SettingsView fen={this.props.fen} settings={this.props.settings} isOpen = {true} clear = {this.props.clear} reset = {this.props.reset} onChange = {this.props.settingsChange}/>\n            \n            </Col>\n          </Row>\n        </TabPane>\n      </TabContent>\n        </div>\n    }\n}","import Chess from 'chess.js'\nimport * as Constants from '../app/Constants'\nimport {trackEvent} from '../app/Analytics'\nimport {copyText} from './loader/Common'\n\nfunction turnColor() {\n    return fullTurnName(this.chess.turn())\n}\n\nfunction fullTurnName(shortName) {\n    return shortName === 'w' ? Constants.PLAYER_COLOR_WHITE : Constants.PLAYER_COLOR_BLACK\n}\n\nfunction playerColor() {\n    return this.state.settings.playerColor\n}\n\nfunction brushes() {\n    if(this.playerColor() === this.turnColor()) {\n        return this.forBrushes\n    }\n    return this.againstBrushes\n}\n\nfunction calcMovable() {\nconst dests = {}\n    this.chess.SQUARES.forEach(s => {\n        const ms = this.chess.moves({square: s, verbose: true})\n        if (ms.length) dests[s] = ms.map(m => m.to)\n    })\n    return {\n        free: false,\n        dests,\n        color: this.turnColor()\n    }\n}\n\nfunction orientation() {\n    return this.state.settings.orientation\n}\n\nfunction onMove(from, to) {\n    const chess = this.chess\n    let move = chess.move({ from, to, promotion: 'q'})\n    this.setState({ fen: chess.fen(), lastMove: move})\n}\n\n\nfunction onMoveAction(from, to) {\n    this.onMove(from,to)\n    trackEvent(Constants.EVENT_CATEGORY_CHESSBOARD, \"Move\")\n}\n\nfunction navigateTo(fen, previousMove){\n    this.chess = new Chess(fen)\n    this.setState({fen:fen, lastMove:previousMove})\n}\nfunction updateProcessedGames(downloadLimit, n, parsedGame) {\n    let totalGamesProcessed = this.state.gamesProcessed+n\n    this.state.openingGraph.addPGN(parsedGame.pgnStats, parsedGame.parsedMoves,\n            parsedGame.latestFen,parsedGame.playerColor)\n    this.setState({\n        gamesProcessed: totalGamesProcessed,\n        downloadingGames: (totalGamesProcessed<downloadLimit || downloadLimit>=Constants.MAX_DOWNLOAD_LIMIT)?this.state.downloadingGames:false\n    })\n    // continue to download games if \n    // 1. we have not reached download limit OR\n    //    there is no download limit set (downloadLimit>MAX condition)\n    // 2. user did not hit stop button\n    return (totalGamesProcessed < downloadLimit || downloadLimit>=Constants.MAX_DOWNLOAD_LIMIT)&& this.state.downloadingGames\n}\nfunction moveToShape(move) {\n    return {\n        orig:move.orig,\n                    dest: move.dest,\n                    brush: this.brushes()[move.level]\n    }\n}\n\nfunction autoShapes() {\n    var moves = this.movesToShow()\n    if(moves) {\n        var shapes = moves.map(this.moveToShape.bind(this))\n        return this.fillArray(shapes,  25)\n    }\n    return this.fillArray([], 25) // dummy arrow to clear out existing arrows\n}\n\nfunction movesToShow() {\n    if(!this.state.openingGraph.hasMoves) {\n        return null;\n    }\n    var moves = this.state.openingGraph.movesForFen(this.chess.fen())\n    return moves?moves.sort((a,b)=>b.details.count-a.details.count):[]\n}\n\n\n\nfunction gameResults() {\n    return this.state.openingGraph.gameResultsForFen(this.chess.fen())\n}\n\nfunction fillArray(arr, len) {\n    for (var i = arr.length; i < len; i++) {\n        arr.push({'orig':'i'+i, 'dest':'i'+(i+1), brush:this.brushes()[0]});\n    }\n    return arr;\n}\n\nfunction reset() {\n    this.chess = new Chess()\n    this.setState({fen: this.chess.fen(), lastMove:null})\n}\n\nfunction clear() {\n    this.state.openingGraph.clear()\n    this.state.gamesProcessed = 0\n    this.reset()\n}\n\nfunction settingsChange(name, value) {\n    let settings = this.state.settings\n    settings[name] = value;\n    this.setState({\n        'settings':settings\n    })\n}\n\nfunction launch(url) {\n    return () => {\n      window.open(url, \"_blank\")\n    }\n  }\n\n\nfunction showError(message, trackingEvent, subMessage, action) {\n    let errorActionText, errorAction\n    if(action == Constants.ERROR_ACTION_VISIT_OLD_SITE) {\n        errorActionText=\"Visit old site\"\n        errorAction = launch(\"https://www.openingtree.com/old\")\n    } else {\n        errorActionText=\"Report this\"\n        errorAction = this.toggleFeedback(true)\n    }\n    this.setState({message:message, subMessage:subMessage,\n        errorAction:errorAction, errorActionText:errorActionText,\n        messageSeverity:\"error\"})\n    let eventName = \"errorShown\"\n    if(trackingEvent) {\n        eventName = eventName+\":\"+trackingEvent\n    }\n    trackEvent(Constants.EVENT_CATEGORY_MESSAGE_SHOWN,eventName, message)\n}\n\nfunction showInfo(message, trackingLabel) {\n    this.setState({message:message, messageSeverity:\"success\"})\n    trackEvent(Constants.EVENT_CATEGORY_MESSAGE_SHOWN,\"infoShown\",\n        trackingLabel?trackingLabel:message)\n}\n\n\nfunction closeError() {\n    this.setState({message:'', subMessage:''})\n}\n\nfunction toggleFeedback(diagnosticsOpen) {\n    return () => {\n        let feedbackOpen = this.state.feedbackOpen\n        this.closeError()\n        this.setState({feedbackOpen:!feedbackOpen,\n                diagnosticsDataOpen:diagnosticsOpen})\n    }\n}\n\nfunction setDownloading(val) {\n    this.setState({downloadingGames:val})\n}\n\nfunction toggleDiagnosticsData() {\n    this.setState({diagnosticsDataOpen:!this.state.diagnosticsDataOpen})\n}\n\nfunction copyDiagnostics() {\n    copyText(\"diagnosticsText\")\n    this.showInfo(\"Copied Diagnostics data\")\n}\n\n\nfunction importGameState(importState) {\n    this.setState({\n      settings:importState.settings,\n      openingGraph:importState.openingGraph,\n      gamesProcessed:importState.gamesProcessed\n    })\n  }\n  function getChessboardWidth(){\n    // have to manually set the width to pixels instead of \"vw\" value\n    // this is because chessground component does not behave well with \"vw\" values\n    if (window.innerWidth<=768) {\n      return `${Math.round(window.innerWidth*95/100)}px` //95vw\n    } else if ((window.innerWidth<=1024)) {\n      return `${Math.round(window.innerWidth*40/100)}px` // 40vw\n    } else {\n      return \"512px\"\n    }\n\n  }\n\nfunction getDiagnosticsValue() {\n  return `--------------------\n  ${navigator.userAgent}\n  -------------------\n  ${JSON.stringify(this.state)}\n  -------------------\n  `\n}\nfunction getRedditLink() {\n    return `https://www.reddit.com/message/compose/?to=${Constants.OPENNIG_TREE_REDDIT}&subject=${this.getSubject()}&message=%0D%0A%0D%0A%0D%0A${this.getBody()}`\n}\n\nfunction getEmailLink() {\n    return `mailto:${Constants.OPENING_TREE_EMAIL}?subject=${this.getSubject()}&body=%0D%0A%0D%0A%0D%0A${this.getBody()}`\n}\n\nfunction getSubject() {\n    return this.state.diagnosticsDataOpen?\"Possible Openingtree bug\":\"Feedback on Openingtree\"\n}\nfunction getBody() {\n    return this.state.diagnosticsDataOpen?this.getDiagnosticsValue():\"\"\n}\n\n\nfunction addStateManagement(obj){\n    obj.orientation  = orientation\n    obj.turnColor = turnColor\n    obj.calcMovable = calcMovable\n    obj.onMove = onMove\n    obj.onMoveAction = onMoveAction\n    obj.autoShapes = autoShapes\n    obj.updateProcessedGames = updateProcessedGames\n    obj.settingsChange = settingsChange\n    obj.reset = reset\n    obj.clear = clear\n    obj.navigateTo = navigateTo\n    obj.playerColor = playerColor\n    obj.fillArray = fillArray\n    obj.brushes = brushes\n    obj.moveToShape = moveToShape\n    obj.movesToShow = movesToShow\n    obj.gameResults = gameResults\n    obj.showError = showError\n    obj.showInfo = showInfo\n    obj.closeError = closeError\n    obj.toggleFeedback = toggleFeedback.bind(obj)\n    obj.setDownloading = setDownloading\n    obj.toggleDiagnosticsData = toggleDiagnosticsData.bind(obj)\n    obj.copyDiagnostics = copyDiagnostics.bind(obj)\n    obj.importGameState = importGameState\n    obj.getDiagnosticsValue = getDiagnosticsValue\n    obj.getChessboardWidth = getChessboardWidth\n    obj.getEmailLink = getEmailLink\n    obj.getSubject = getSubject\n    obj.getBody = getBody.bind(obj)\n    obj.getRedditLink = getRedditLink\n}\n\nexport {addStateManagement}","import green from '@material-ui/core/colors/green';\nimport amber from '@material-ui/core/colors/amber';\nimport IconButton from '@material-ui/core/IconButton';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport Button from '@material-ui/core/Button'\nimport {withStyles} from '@material-ui/core/styles';\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport CloseIcon from '@material-ui/icons/Close';\nimport ErrorIcon from '@material-ui/icons/Error';\nimport InfoIcon from '@material-ui/icons/Info';\nimport WarningIcon from '@material-ui/icons/Warning';\nimport clsx from 'clsx';\nimport PropTypes from 'prop-types';\nimport * as React from 'react';\n\nconst variantIcon = {\n    success: CheckCircleIcon,\n    warning: WarningIcon,\n    error: ErrorIcon,\n    info: InfoIcon,\n};\n\nconst styles = (theme) => ({\n    success: {\n        backgroundColor: green[600],\n    },\n    error: {\n        backgroundColor: theme.palette.error.dark,\n    },\n    info: {\n        backgroundColor: theme.palette.primary.dark,\n    },\n    warning: {\n        backgroundColor: amber[700],\n    },\n    icon: {\n        fontSize: 20,\n    },\n    iconVariant: {\n        opacity: 0.9,\n        marginRight: theme.spacing(1),\n    },\n    message: {\n        display: 'flex',\n        alignItems: 'center',\n    },\n});\n\nfunction SnackbarContentWrapper(props) {\n    const {classes, className, message, onClose, variant, subMessage, action, actionText, showReportButton, ...other} = props;\n    const Icon = variantIcon[variant];\n\n    return (\n        <SnackbarContent\n            className={clsx(classes[variant], className)}\n            aria-describedby=\"client-snackbar\"\n            message={\n                <div><span id=\"client-snackbar\" className={classes.message}>\n                    <Icon className={clsx(classes.icon, classes.iconVariant)} />\n                    {message} \n                    \n                </span>\n                {!subMessage?null:<div className=\"smallText\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{subMessage}</div>}\n                </div>\n            }\n            action={[ \n                !showReportButton?null:<Button key=\"report\" onClick = {action} color=\"inherit\" size=\"small\">\n                  {actionText}\n                </Button>,\n                <IconButton\n                    key=\"close\"\n                    aria-label=\"Close\"\n                    color=\"inherit\"\n                    className={classes.close}\n                    onClick={onClose}\n                >\n                    <CloseIcon className={classes.icon} />\n                </IconButton>\n            ]}\n            {...other}\n        />\n    );\n}\n\nSnackbarContentWrapper.propTypes = {\n    classes: PropTypes.object.isRequired,\n    className: PropTypes.string,\n    message: PropTypes.node,\n    onClose: PropTypes.func,\n    onReport: PropTypes.func,\n    subMessage: PropTypes.string,\n    showReportButton: PropTypes.bool,\n    variant: PropTypes.oneOf(['success', 'warning', 'error', 'info']).isRequired,\n};\n\nexport default withStyles(styles)(SnackbarContentWrapper);","import React from 'react'\nimport Chess from 'chess.js'\nimport Chessground from 'react-chessground'\nimport 'react-chessground/dist/styles/chessground.css'\nimport {openingGraph} from '../app/OpeningGraph'\nimport Navigator from './Navigator'\nimport GlobalHeader from './GlobalHeader'\nimport {Container, Row, Col} from 'reactstrap'\nimport ControlsContainer from './ControlsContainer'\nimport {addStateManagement} from './StateManagement'\nimport {Snackbar, TextField} from '@material-ui/core'\nimport SnackbarContentWrapper from './SnackbarContentWrapper'\nimport * as Constants from '../app/Constants'\nimport {  Modal, ModalBody,\n  ModalHeader,\n  ModalFooter,\n  Button,Collapse\n} from 'reactstrap'\n\nimport {FormControlLabel, Checkbox} from '@material-ui/core'\n\nexport default class MainContainer extends React.Component {\n  \n  constructor(props){\n    super(props)\n    this.chess = new Chess()\n    addStateManagement(this)\n    this.state = {\n        fen: this.chess.fen(),\n        lastMove: null,\n        gamesProcessed:0,\n        openingGraph:openingGraph,\n        settings:{\n          playerName:'',\n          orientation:Constants.PLAYER_COLOR_WHITE,\n          playerColor:''\n        },\n        message:'',\n        downloadingGames:false,\n        feedbackOpen:false,\n        diagnosticsDataOpen:false\n      }\n    this.chessboardWidth = this.getChessboardWidth()\n\n    this.forBrushes = ['paleGrey', 'paleGreen', 'green']\n    this.againstBrushes = ['paleRed', 'paleRed', 'red']\n\n  }\n\n  render() {\n    let lastMoveArray = this.state.lastMove ? [this.state.lastMove.from, this.state.lastMove.to] : null\n    let snackBarOpen = this.state.message?true:false\n    return <div className=\"rootView\"> \n        <GlobalHeader toggleFeedback = {this.toggleFeedback(false)}/>\n        <Container className=\"mainContainer\">\n          <Row><Col lg={{order:0, size:2}} xs={{order:2}}><Navigator fen = {this.state.fen} move={this.state.lastMove} onChange ={this.navigateTo.bind(this)}/>\n    </Col><Col lg=\"6\"><Chessground\n      height={this.chessboardWidth}\n      width={this.chessboardWidth}\n      orientation={this.orientation()}\n      turnColor={this.turnColor()}\n      movable={this.calcMovable()}\n      \n      lastMove={lastMoveArray}\n      fen={this.state.fen}\n      onMove={this.onMoveAction.bind(this)}\n      drawable ={{\n        enabled: true,\n        visible: true,\n        autoShapes: this.autoShapes()\n      }}\n      style={{ margin: 'auto' }}\n    />\n    </Col><Col lg=\"4\" className=\"paddingTop\"><ControlsContainer fen={this.state.fen}\n                gamesProcessed={this.state.gamesProcessed} \n                updateProcessedGames={this.updateProcessedGames.bind(this)}\n                settingsChange={this.settingsChange.bind(this)}\n                settings={this.state.settings}\n                reset={this.reset.bind(this)}\n                clear={this.clear.bind(this)}\n                movesToShow={this.movesToShow()}\n                gameResults={this.gameResults()}\n                onMove={this.onMove.bind(this)}\n                turnColor={this.turnColor()}\n                showError={this.showError.bind(this)}\n                showInfo={this.showInfo.bind(this)}\n                setDownloading={this.setDownloading.bind(this)}\n                isDownloading={this.state.downloadingGames}\n                openingGraph={this.state.openingGraph}\n                importCallback={this.importGameState.bind(this)}\n                /></Col>\n    </Row></Container>\n    <Snackbar anchorOrigin={{ vertical:'bottom', horizontal:\"left\" }} \n            open={snackBarOpen} autoHideDuration={6000} \n            onClose={this.closeError.bind(this)}\n    >\n    <SnackbarContentWrapper\n                            onClose={this.closeError.bind(this)}\n                            variant={this.state.messageSeverity}\n                            message={this.state.message}\n                            subMessage={this.state.subMessage}\n                            showReportButton={this.state.messageSeverity==='error'}\n                            action={this.state.errorAction}\n                            actionText={this.state.errorActionText}\n                        />\n    </Snackbar>\n\n    <Modal isOpen={this.state.feedbackOpen} toggle={this.toggleFeedback(false)}>\n        <ModalHeader toggle={this.toggleFeedback(false)}>Feedback</ModalHeader>\n        <ModalBody>\n          Your feedback is greatly appreciated. Reach out to me for feedback, suggestions, bug report or just a game of chess.\n          <ul>\n            <li>Email me: <a rel=\"noopener noreferrer\" href={this.getEmailLink()} target=\"_blank\">{Constants.OPENING_TREE_EMAIL}</a></li>\n            <li>Message me on reddit <a rel=\"noopener noreferrer\" href={this.getRedditLink()} target=\"_blank\">u/{Constants.OPENNIG_TREE_REDDIT}</a></li>\n            <li>Message me on lichess: <a rel=\"noopener noreferrer\" href={`https://lichess.org/inbox/${Constants.OPENING_TREE_LICHESS}`} target=\"_blank\">{Constants.OPENING_TREE_LICHESS}</a></li>\n            <li>Message me on chess.com: <a rel=\"noopener noreferrer\" href={`https://www.chess.com/messages/compose/${Constants.OPENING_TREE_CHESS_COM}`} target=\"_blank\">{Constants.OPENING_TREE_CHESS_COM}</a></li>\n            <li>Join my <a rel=\"noopener noreferrer\" href={Constants.OPENING_TREE_DISCORD}target=\"_blank\">discord server</a> to chat</li>\n          </ul>\n          <FormControlLabel\n        control={\n          <Checkbox\n            checked={this.state.diagnosticsDataOpen}\n            onChange={this.toggleDiagnosticsData}\n            name=\"diagnostics\"\n            color=\"primary\"\n          />\n        }\n        label=\"Add diagnostics data to message\"\n      />\n          <Collapse isOpen={this.state.diagnosticsDataOpen}>\n            <TextField id=\"diagnosticsText\" label=\"Click to copy.\" variant=\"outlined\" \n            className=\"fullWidth\" value={this.getDiagnosticsValue()} \n            rowsMax={4} onClick={this.copyDiagnostics} multiline/>\n            </Collapse>\n        </ModalBody>\n        <ModalFooter>\n          <Button color=\"secondary\" onClick={this.toggleFeedback(false)}>Done</Button>\n        </ModalFooter>\n      </Modal>\n    </div>\n  }\n}\n","import ReactDOM from 'react-dom'\nimport MainContainer from './pres/MainContainer'\nimport React from 'react'\nimport {trackPageView} from './app/Analytics'\n\nReactDOM.render(<MainContainer />, document.getElementById('root'))\ntrackPageView()","import * as Constants from './Constants'\n\nexport function isAdvancedFiltersEnabled(source) {\n    return source === Constants.SITE_CHESS_DOT_COM ||\n        source === Constants.SITE_LICHESS\n}\n\n\nexport function isFilterPanelEnabled(source, playerName) {\n    if(source === Constants.SITE_EVENT_DB ||\n        source === Constants.SITE_OPENING_TREE_FILE) {\n            return false\n    }\n    return !!playerName\n}\n\nexport function treeSaveDisabledReason(loadedSite, selectedSite, gamesProcessed, isDownloading){\n    if(selectedSite !== Constants.SITE_LICHESS && \n        selectedSite !== Constants.SITE_CHESS_DOT_COM) {\n        return \"Only supported for chess.com and lichess\"\n    }\n    if(loadedSite !== selectedSite || gamesProcessed<=0) {\n        return \"You need to analyze games before saving\"\n    }\n    if(isDownloading) {\n        return \"Action not supported while games are loading\"\n    }\n    return ''\n}\nexport function exportFileName(source, playerName, playerColor, selectedEvent, extension) {\n    if(source === Constants.SITE_EVENT_DB) {\n        return `${selectedEvent.name}.${extension}`\n    }\n    if(playerName) {\n        return `${playerName}-${playerColor}.${extension}`\n    }\n    return `openingtree-exportedgames.${extension}`\n}","/*\n * Generated by PEG.js 0.10.0.\n *\n * http://pegjs.org/\n */\n\n\"use strict\";\n\nfunction peg$subclass(child, parent) {\n  function ctor() { this.constructor = child; }\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  this.message  = message;\n  this.expected = expected;\n  this.found    = found;\n  this.location = location;\n  this.name     = \"SyntaxError\";\n\n  if (typeof Error.captureStackTrace === \"function\") {\n    Error.captureStackTrace(this, peg$SyntaxError);\n  }\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n        literal: function(expectation) {\n          return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n        },\n\n        \"class\": function(expectation) {\n          var escapedParts = \"\",\n              i;\n\n          for (i = 0; i < expectation.parts.length; i++) {\n            escapedParts += expectation.parts[i] instanceof Array\n              ? classEscape(expectation.parts[i][0]) + \"-\" + classEscape(expectation.parts[i][1])\n              : classEscape(expectation.parts[i]);\n          }\n\n          return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts + \"]\";\n        },\n\n        any: function(expectation) {\n          return \"any character\";\n        },\n\n        end: function(expectation) {\n          return \"end of input\";\n        },\n\n        other: function(expectation) {\n          return expectation.description;\n        }\n      };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, '\\\\\\\\')\n      .replace(/\"/g,  '\\\\\"')\n      .replace(/\\0/g, '\\\\0')\n      .replace(/\\t/g, '\\\\t')\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return '\\\\x0' + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return '\\\\x'  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, '\\\\\\\\')\n      .replace(/\\]/g, '\\\\]')\n      .replace(/\\^/g, '\\\\^')\n      .replace(/-/g,  '\\\\-')\n      .replace(/\\0/g, '\\\\0')\n      .replace(/\\t/g, '\\\\t')\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return '\\\\x0' + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return '\\\\x'  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = new Array(expected.length),\n        i, j;\n\n    for (i = 0; i < expected.length; i++) {\n      descriptions[i] = describeExpectation(expected[i]);\n    }\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== void 0 ? options : {};\n\n  var peg$FAILED = {},\n\n      peg$startRuleFunctions = { start: peg$parsestart },\n      peg$startRuleFunction  = peg$parsestart,\n\n      peg$c0 = function(gs) {return gs.map(function(g) { return g[0]})},\n      peg$c1 = function(h, c, m, r) {return [m, r]},\n      peg$c2 = function(h, c, r) {return [null, r]},\n      peg$c3 = function(h, c, mr) {return make_game(h, c, mr[0], mr[1])},\n      peg$c4 = peg$anyExpectation(),\n      peg$c5 = \"\\\"\",\n      peg$c6 = peg$literalExpectation(\"\\\"\", false),\n      peg$c7 = /^[^\"]/,\n      peg$c8 = peg$classExpectation([\"\\\"\"], true, false),\n      peg$c9 = function(str) {return str.join('')},\n      peg$c10 = /^[1-9]/,\n      peg$c11 = peg$classExpectation([[\"1\", \"9\"]], false, false),\n      peg$c12 = /^[0-9]/,\n      peg$c13 = peg$classExpectation([[\"0\", \"9\"]], false, false),\n      peg$c14 = function(a, b) {return parseInt(a+b.join(''), 10)},\n      peg$c15 = /^[A-Za-z0-9_\\-]/,\n      peg$c16 = peg$classExpectation([[\"A\", \"Z\"], [\"a\", \"z\"], [\"0\", \"9\"], \"_\", \"-\"], false, false),\n      peg$c17 = function(chars) {return chars.join('')},\n      peg$c18 = \" \",\n      peg$c19 = peg$literalExpectation(\" \", false),\n      peg$c20 = \"\\f\",\n      peg$c21 = peg$literalExpectation(\"\\f\", false),\n      peg$c22 = \"\\t\",\n      peg$c23 = peg$literalExpectation(\"\\t\", false),\n      peg$c24 = \"\\n\",\n      peg$c25 = peg$literalExpectation(\"\\n\", false),\n      peg$c26 = \"[\",\n      peg$c27 = peg$literalExpectation(\"[\", false),\n      peg$c28 = \"]\",\n      peg$c29 = peg$literalExpectation(\"]\", false),\n      peg$c30 = function(hn, hv) { return make_header(hn,hv) },\n      peg$c31 = function(hs) {return hs},\n      peg$c32 = /^[NKQRBP]/,\n      peg$c33 = peg$classExpectation([\"N\", \"K\", \"Q\", \"R\", \"B\", \"P\"], false, false),\n      peg$c34 = /^[a-h]/,\n      peg$c35 = peg$classExpectation([[\"a\", \"h\"]], false, false),\n      peg$c36 = /^[1-8]/,\n      peg$c37 = peg$classExpectation([[\"1\", \"8\"]], false, false),\n      peg$c38 = \"+\",\n      peg$c39 = peg$literalExpectation(\"+\", false),\n      peg$c40 = \"#\",\n      peg$c41 = peg$literalExpectation(\"#\", false),\n      peg$c42 = /^[x@]/,\n      peg$c43 = peg$classExpectation([\"x\", \"@\"], false, false),\n      peg$c44 = \".\",\n      peg$c45 = peg$literalExpectation(\".\", false),\n      peg$c46 = \"1-0\",\n      peg$c47 = peg$literalExpectation(\"1-0\", false),\n      peg$c48 = \"0-1\",\n      peg$c49 = peg$literalExpectation(\"0-1\", false),\n      peg$c50 = \"*\",\n      peg$c51 = peg$literalExpectation(\"*\", false),\n      peg$c52 = \"1/2-1/2\",\n      peg$c53 = peg$literalExpectation(\"1/2-1/2\", false),\n      peg$c54 = function(mn) {return mn},\n      peg$c55 = function(r, f) {return r+f},\n      peg$c56 = \"=\",\n      peg$c57 = peg$literalExpectation(\"=\", false),\n      peg$c58 = /^[QRBNK]/,\n      peg$c59 = peg$classExpectation([\"Q\", \"R\", \"B\", \"N\", \"K\"], false, false),\n      peg$c60 = \"$\",\n      peg$c61 = peg$literalExpectation(\"$\", false),\n      peg$c62 = \"!!\",\n      peg$c63 = peg$literalExpectation(\"!!\", false),\n      peg$c64 = \"??\",\n      peg$c65 = peg$literalExpectation(\"??\", false),\n      peg$c66 = \"!?\",\n      peg$c67 = peg$literalExpectation(\"!?\", false),\n      peg$c68 = \"?!\",\n      peg$c69 = peg$literalExpectation(\"?!\", false),\n      peg$c70 = \"!\",\n      peg$c71 = peg$literalExpectation(\"!\", false),\n      peg$c72 = \"?\",\n      peg$c73 = peg$literalExpectation(\"?\", false),\n      peg$c74 = /^[^}]/,\n      peg$c75 = peg$classExpectation([\"}\"], true, false),\n      peg$c76 = \"{\",\n      peg$c77 = peg$literalExpectation(\"{\", false),\n      peg$c78 = \"}\",\n      peg$c79 = peg$literalExpectation(\"}\", false),\n      peg$c80 = function(cc) {return cc.join('');},\n      peg$c81 = \"O-O-O\",\n      peg$c82 = peg$literalExpectation(\"O-O-O\", false),\n      peg$c83 = \"O-O\",\n      peg$c84 = peg$literalExpectation(\"O-O\", false),\n      peg$c85 = function(m) {return flatten(m).join('');},\n      peg$c86 = function(mn, m, n) {return n},\n      peg$c87 = function(mn, m, nags, c2) {return c2},\n      peg$c88 = function(mn, m, nags, com, r) {return r},\n      peg$c89 = function(mn, m, nags, com, ravs) {return make_move(mn, m, nags, ravs, com)},\n      peg$c90 = function(first, rest) {return first ? [first].concat(rest.map(function(m) {return m[1]})) : []},\n      peg$c91 = \"(\",\n      peg$c92 = peg$literalExpectation(\"(\", false),\n      peg$c93 = \")\",\n      peg$c94 = peg$literalExpectation(\")\", false),\n      peg$c95 = function(m, r) {return make_rav(m, r)},\n\n      peg$currPos          = 0,\n      peg$savedPos         = 0,\n      peg$posDetailsCache  = [{ line: 1, column: 1 }],\n      peg$maxFailPos       = 0,\n      peg$maxFailExpected  = [],\n      peg$silentFails      = 0,\n\n      peg$result;\n\n  if (\"startRule\" in options) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== void 0 ? location : peg$computeLocation(peg$savedPos, peg$currPos)\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== void 0 ? location : peg$computeLocation(peg$savedPos, peg$currPos)\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos], p;\n\n    if (details) {\n      return details;\n    } else {\n      p = pos - 1;\n      while (!peg$posDetailsCache[p]) {\n        p--;\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line:   details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos) {\n    var startPosDetails = peg$computePosDetails(startPos),\n        endPosDetails   = peg$computePosDetails(endPos);\n\n    return {\n      start: {\n        offset: startPos,\n        line:   startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line:   endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsestart() {\n    var s0, s1, s2, s3, s4, s5;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$currPos;\n    s3 = peg$parsegame();\n    if (s3 !== peg$FAILED) {\n      s4 = [];\n      s5 = peg$parsenewline();\n      while (s5 !== peg$FAILED) {\n        s4.push(s5);\n        s5 = peg$parsenewline();\n      }\n      if (s4 !== peg$FAILED) {\n        s3 = [s3, s4];\n        s2 = s3;\n      } else {\n        peg$currPos = s2;\n        s2 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s2;\n      s2 = peg$FAILED;\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$currPos;\n      s3 = peg$parsegame();\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsenewline();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsenewline();\n        }\n        if (s4 !== peg$FAILED) {\n          s3 = [s3, s4];\n          s2 = s3;\n        } else {\n          peg$currPos = s2;\n          s2 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s2;\n        s2 = peg$FAILED;\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseEOF();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c0(s1);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsegame() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    s1 = peg$parseheaders();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsecomment();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = [];\n        s4 = peg$parsewhitespace();\n        while (s4 !== peg$FAILED) {\n          s3.push(s4);\n          s4 = peg$parsewhitespace();\n        }\n        if (s3 !== peg$FAILED) {\n          s4 = peg$currPos;\n          s5 = peg$parsemovetext();\n          if (s5 !== peg$FAILED) {\n            s6 = [];\n            s7 = peg$parsewhitespace();\n            if (s7 !== peg$FAILED) {\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$parsewhitespace();\n              }\n            } else {\n              s6 = peg$FAILED;\n            }\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parseresult();\n              if (s7 !== peg$FAILED) {\n                peg$savedPos = s4;\n                s5 = peg$c1(s1, s2, s5, s7);\n                s4 = s5;\n              } else {\n                peg$currPos = s4;\n                s4 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s4;\n              s4 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s4;\n            s4 = peg$FAILED;\n          }\n          if (s4 === peg$FAILED) {\n            s4 = peg$currPos;\n            s5 = peg$parseresult();\n            if (s5 !== peg$FAILED) {\n              peg$savedPos = s4;\n              s5 = peg$c2(s1, s2, s5);\n            }\n            s4 = s5;\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = [];\n            s6 = peg$parsewhitespace();\n            while (s6 !== peg$FAILED) {\n              s5.push(s6);\n              s6 = peg$parsewhitespace();\n            }\n            if (s5 !== peg$FAILED) {\n              peg$savedPos = s0;\n              s1 = peg$c3(s1, s2, s4);\n              s0 = s1;\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseEOF() {\n    var s0, s1;\n\n    s0 = peg$currPos;\n    peg$silentFails++;\n    if (input.length > peg$currPos) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c4); }\n    }\n    peg$silentFails--;\n    if (s1 === peg$FAILED) {\n      s0 = void 0;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsedouble_quote() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 34) {\n      s0 = peg$c5;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c6); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsestring() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsedouble_quote();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      if (peg$c7.test(input.charAt(peg$currPos))) {\n        s3 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c8); }\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        if (peg$c7.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c8); }\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsedouble_quote();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s1 = peg$c9(s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseinteger() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    if (peg$c10.test(input.charAt(peg$currPos))) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c11); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      if (peg$c12.test(input.charAt(peg$currPos))) {\n        s3 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c13); }\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        if (peg$c12.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c13); }\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c14(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsesymbol() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = [];\n    if (peg$c15.test(input.charAt(peg$currPos))) {\n      s2 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c16); }\n    }\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        if (peg$c15.test(input.charAt(peg$currPos))) {\n          s2 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c16); }\n        }\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$c17(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsews() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 32) {\n      s0 = peg$c18;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c19); }\n    }\n    if (s0 === peg$FAILED) {\n      if (input.charCodeAt(peg$currPos) === 12) {\n        s0 = peg$c20;\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c21); }\n      }\n      if (s0 === peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 9) {\n          s0 = peg$c22;\n          peg$currPos++;\n        } else {\n          s0 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c23); }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsewhitespace() {\n    var s0;\n\n    s0 = peg$parsews();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsenewline();\n    }\n\n    return s0;\n  }\n\n  function peg$parsenewline() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 10) {\n      s0 = peg$c24;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c25); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseheader() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 91) {\n      s1 = peg$c26;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c27); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsesymbol();\n      if (s2 !== peg$FAILED) {\n        s3 = [];\n        s4 = peg$parsews();\n        if (s4 !== peg$FAILED) {\n          while (s4 !== peg$FAILED) {\n            s3.push(s4);\n            s4 = peg$parsews();\n          }\n        } else {\n          s3 = peg$FAILED;\n        }\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parsestring();\n          if (s4 !== peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 93) {\n              s5 = peg$c28;\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c29); }\n            }\n            if (s5 !== peg$FAILED) {\n              s6 = [];\n              s7 = peg$parsewhitespace();\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$parsewhitespace();\n              }\n              if (s6 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s1 = peg$c30(s2, s4);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseheaders() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parseheader();\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = peg$parseheader();\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$c31(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsepiece() {\n    var s0;\n\n    if (peg$c32.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c33); }\n    }\n\n    return s0;\n  }\n\n  function peg$parserank() {\n    var s0;\n\n    if (peg$c34.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c35); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsefile() {\n    var s0;\n\n    if (peg$c36.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c37); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecheck() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 43) {\n      s0 = peg$c38;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c39); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecheckmate() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 35) {\n      s0 = peg$c40;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c41); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecapture() {\n    var s0;\n\n    if (peg$c42.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c43); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseperiod() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s0 = peg$c44;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c45); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseresult() {\n    var s0;\n\n    if (input.substr(peg$currPos, 3) === peg$c46) {\n      s0 = peg$c46;\n      peg$currPos += 3;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c47); }\n    }\n    if (s0 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c48) {\n        s0 = peg$c48;\n        peg$currPos += 3;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c49); }\n      }\n      if (s0 === peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 42) {\n          s0 = peg$c50;\n          peg$currPos++;\n        } else {\n          s0 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c51); }\n        }\n        if (s0 === peg$FAILED) {\n          if (input.substr(peg$currPos, 7) === peg$c52) {\n            s0 = peg$c52;\n            peg$currPos += 7;\n          } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c53); }\n          }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsemove_number() {\n    var s0, s1, s2, s3, s4, s5;\n\n    s0 = peg$currPos;\n    s1 = peg$parseinteger();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseperiod();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$currPos;\n        s4 = peg$parseperiod();\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parseperiod();\n          if (s5 !== peg$FAILED) {\n            s4 = [s4, s5];\n            s3 = s4;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s1 = peg$c54(s1);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsesquare() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parserank();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsefile();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c55(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsepromotion() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 61) {\n      s1 = peg$c56;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c57); }\n    }\n    if (s1 !== peg$FAILED) {\n      if (peg$c58.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c59); }\n      }\n      if (s2 !== peg$FAILED) {\n        s1 = [s1, s2];\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsenag() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 36) {\n      s2 = peg$c60;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c61); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parseinteger();\n      if (s3 !== peg$FAILED) {\n        s2 = [s2, s3];\n        s1 = s2;\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$c17(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsenag_alts() {\n    var s0;\n\n    if (input.substr(peg$currPos, 2) === peg$c62) {\n      s0 = peg$c62;\n      peg$currPos += 2;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c63); }\n    }\n    if (s0 === peg$FAILED) {\n      if (input.substr(peg$currPos, 2) === peg$c64) {\n        s0 = peg$c64;\n        peg$currPos += 2;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c65); }\n      }\n      if (s0 === peg$FAILED) {\n        if (input.substr(peg$currPos, 2) === peg$c66) {\n          s0 = peg$c66;\n          peg$currPos += 2;\n        } else {\n          s0 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c67); }\n        }\n        if (s0 === peg$FAILED) {\n          if (input.substr(peg$currPos, 2) === peg$c68) {\n            s0 = peg$c68;\n            peg$currPos += 2;\n          } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c69); }\n          }\n          if (s0 === peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 33) {\n              s0 = peg$c70;\n              peg$currPos++;\n            } else {\n              s0 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c71); }\n            }\n            if (s0 === peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 63) {\n                s0 = peg$c72;\n                peg$currPos++;\n              } else {\n                s0 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c73); }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecontinuation() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parseperiod();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseperiod();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parseperiod();\n        if (s3 !== peg$FAILED) {\n          s1 = [s1, s2, s3];\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomment_chars() {\n    var s0;\n\n    if (peg$c74.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c75); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomment() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 123) {\n      s1 = peg$c76;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c77); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsecomment_chars();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsecomment_chars();\n      }\n      if (s2 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 125) {\n          s3 = peg$c78;\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c79); }\n        }\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s1 = peg$c80(s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsepawn_half_move() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$parserank();\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsecapture();\n      if (s3 !== peg$FAILED) {\n        s2 = [s2, s3];\n        s1 = s2;\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsesquare();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsepromotion();\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        if (s3 !== peg$FAILED) {\n          s1 = [s1, s2, s3];\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsepiece_half_move() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsepiece();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsecapture();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsesquare();\n        if (s3 !== peg$FAILED) {\n          s1 = [s1, s2, s3];\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsepiece_disambiguation_half_move() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parsepiece();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parserank();\n      if (s2 === peg$FAILED) {\n        s2 = peg$parsefile();\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsecapture();\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parsesquare();\n          if (s4 !== peg$FAILED) {\n            s1 = [s1, s2, s3, s4];\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecastle_half_move() {\n    var s0;\n\n    if (input.substr(peg$currPos, 5) === peg$c81) {\n      s0 = peg$c81;\n      peg$currPos += 5;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c82); }\n    }\n    if (s0 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c83) {\n        s0 = peg$c83;\n        peg$currPos += 3;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c84); }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsehalf_move() {\n    var s0, s1, s2, s3, s4, s5;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$parsecontinuation();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsecastle_half_move();\n      if (s3 === peg$FAILED) {\n        s3 = peg$parsepiece_disambiguation_half_move();\n        if (s3 === peg$FAILED) {\n          s3 = peg$parsepiece_half_move();\n          if (s3 === peg$FAILED) {\n            s3 = peg$parsepawn_half_move();\n          }\n        }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parsecheck();\n        if (s4 === peg$FAILED) {\n          s4 = peg$parsecheckmate();\n        }\n        if (s4 === peg$FAILED) {\n          s4 = null;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parsenag_alts();\n          if (s5 === peg$FAILED) {\n            s5 = null;\n          }\n          if (s5 !== peg$FAILED) {\n            s2 = [s2, s3, s4, s5];\n            s1 = s2;\n          } else {\n            peg$currPos = s1;\n            s1 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s1;\n          s1 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$c85(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsemove() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9;\n\n    s0 = peg$currPos;\n    s1 = peg$parsemove_number();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewhitespace();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewhitespace();\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsehalf_move();\n        if (s3 !== peg$FAILED) {\n          s4 = [];\n          s5 = peg$currPos;\n          s6 = [];\n          s7 = peg$parsewhitespace();\n          if (s7 !== peg$FAILED) {\n            while (s7 !== peg$FAILED) {\n              s6.push(s7);\n              s7 = peg$parsewhitespace();\n            }\n          } else {\n            s6 = peg$FAILED;\n          }\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsenag();\n            if (s7 !== peg$FAILED) {\n              peg$savedPos = s5;\n              s6 = peg$c86(s1, s3, s7);\n              s5 = s6;\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s5;\n            s5 = peg$FAILED;\n          }\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            s5 = peg$currPos;\n            s6 = [];\n            s7 = peg$parsewhitespace();\n            if (s7 !== peg$FAILED) {\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$parsewhitespace();\n              }\n            } else {\n              s6 = peg$FAILED;\n            }\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parsenag();\n              if (s7 !== peg$FAILED) {\n                peg$savedPos = s5;\n                s6 = peg$c86(s1, s3, s7);\n                s5 = s6;\n              } else {\n                peg$currPos = s5;\n                s5 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$currPos;\n            s6 = [];\n            s7 = peg$parsewhitespace();\n            if (s7 !== peg$FAILED) {\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$parsewhitespace();\n              }\n            } else {\n              s6 = peg$FAILED;\n            }\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parsecomment();\n              if (s7 !== peg$FAILED) {\n                peg$savedPos = s5;\n                s6 = peg$c87(s1, s3, s4, s7);\n                s5 = s6;\n              } else {\n                peg$currPos = s5;\n                s5 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s5;\n              s5 = peg$FAILED;\n            }\n            if (s5 === peg$FAILED) {\n              s5 = null;\n            }\n            if (s5 !== peg$FAILED) {\n              s6 = [];\n              s7 = peg$currPos;\n              s8 = [];\n              s9 = peg$parsewhitespace();\n              if (s9 !== peg$FAILED) {\n                while (s9 !== peg$FAILED) {\n                  s8.push(s9);\n                  s9 = peg$parsewhitespace();\n                }\n              } else {\n                s8 = peg$FAILED;\n              }\n              if (s8 !== peg$FAILED) {\n                s9 = peg$parserav();\n                if (s9 !== peg$FAILED) {\n                  peg$savedPos = s7;\n                  s8 = peg$c88(s1, s3, s4, s5, s9);\n                  s7 = s8;\n                } else {\n                  peg$currPos = s7;\n                  s7 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s7;\n                s7 = peg$FAILED;\n              }\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$currPos;\n                s8 = [];\n                s9 = peg$parsewhitespace();\n                if (s9 !== peg$FAILED) {\n                  while (s9 !== peg$FAILED) {\n                    s8.push(s9);\n                    s9 = peg$parsewhitespace();\n                  }\n                } else {\n                  s8 = peg$FAILED;\n                }\n                if (s8 !== peg$FAILED) {\n                  s9 = peg$parserav();\n                  if (s9 !== peg$FAILED) {\n                    peg$savedPos = s7;\n                    s8 = peg$c88(s1, s3, s4, s5, s9);\n                    s7 = s8;\n                  } else {\n                    peg$currPos = s7;\n                    s7 = peg$FAILED;\n                  }\n                } else {\n                  peg$currPos = s7;\n                  s7 = peg$FAILED;\n                }\n              }\n              if (s6 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s1 = peg$c89(s1, s3, s4, s5, s6);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsemovetext() {\n    var s0, s1, s2, s3, s4, s5;\n\n    s0 = peg$currPos;\n    s1 = peg$parsemove();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = [];\n      s5 = peg$parsewhitespace();\n      if (s5 !== peg$FAILED) {\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewhitespace();\n        }\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parsemove();\n        if (s5 !== peg$FAILED) {\n          s4 = [s4, s5];\n          s3 = s4;\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = [];\n        s5 = peg$parsewhitespace();\n        if (s5 !== peg$FAILED) {\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            s5 = peg$parsewhitespace();\n          }\n        } else {\n          s4 = peg$FAILED;\n        }\n        if (s4 !== peg$FAILED) {\n          s5 = peg$parsemove();\n          if (s5 !== peg$FAILED) {\n            s4 = [s4, s5];\n            s3 = s4;\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c90(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parserav() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c91;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c92); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewhitespace();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewhitespace();\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsemovetext();\n        if (s3 !== peg$FAILED) {\n          s4 = [];\n          s5 = peg$parsewhitespace();\n          while (s5 !== peg$FAILED) {\n            s4.push(s5);\n            s5 = peg$parsewhitespace();\n          }\n          if (s4 !== peg$FAILED) {\n            s5 = peg$parseresult();\n            if (s5 === peg$FAILED) {\n              s5 = null;\n            }\n            if (s5 !== peg$FAILED) {\n              s6 = [];\n              s7 = peg$parsewhitespace();\n              while (s7 !== peg$FAILED) {\n                s6.push(s7);\n                s7 = peg$parsewhitespace();\n              }\n              if (s6 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 41) {\n                  s7 = peg$c93;\n                  peg$currPos++;\n                } else {\n                  s7 = peg$FAILED;\n                  if (peg$silentFails === 0) { peg$fail(peg$c94); }\n                }\n                if (s7 !== peg$FAILED) {\n                  peg$savedPos = s0;\n                  s1 = peg$c95(s3, s5);\n                  s0 = s1;\n                } else {\n                  peg$currPos = s0;\n                  s0 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n\n      function flatten(a, acc = []) {\n          for (var i = 0; i < a.length; i++) {\n              if (Array.isArray(a[i])) {\n                  flatten(a[i], acc);\n              } else {\n                  acc.push(a[i]);\n              }\n          }\n          return acc;\n      }\n      function make_header(hn,hv) {\n          var m = {};\n          m[hn] = hv;\n          return m;\n      }\n      function make_move(move_number, move, nags, ravs, comment) {\n          var m = {};\n          if (move_number) m.move_number = move_number;\n          if (move) m.move = move;\n          if (nags && nags.length) m.nags = nags;\n          if (ravs && ravs.length) m.ravs = ravs;\n          if (comment) m.comment = comment;\n          return m;\n      }\n      function make_rav(moves, result) {\n          return {\n              moves, \n              result\n          };\n      }\n      function make_game(h, c, m, r) {\n          h = h || [];\n          return {\n              headers: h.reduce((acc, x) => Object.assign(acc, x), {}),\n              comment: c,\n              moves: m || [],\n              result: r\n          };\n      }\n\n\n  peg$result = peg$startRuleFunction();\n\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nmodule.exports = {\n  SyntaxError: peg$SyntaxError,\n  parse:       peg$parse\n};\n"],"sourceRoot":""}